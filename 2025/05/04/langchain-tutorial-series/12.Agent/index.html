<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="Peng Xia">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://example.com/2025/05/04/langchain-tutorial-series/12.agent/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
    
    
        
        <meta name="description" content="Hexo Theme Redefine, Redefine Your Hexo Journey.">
<meta property="og:type" content="article">
<meta property="og:title" content="Langchain 入门教程 - 12.智能体 agent">
<meta property="og:url" content="http://example.com/2025/05/04/langchain-tutorial-series/12.Agent/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Hexo Theme Redefine, Redefine Your Hexo Journey.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/redefine-og.webp">
<meta property="article:published_time" content="2025-05-04T14:43:57.515Z">
<meta property="article:modified_time" content="2025-05-04T14:51:24.616Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Langchain">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/redefine-og.webp">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/github-color-svgrepo-com.svg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/github-color-svgrepo-com.svg">
    <meta name="theme-color" content="#FFD700">
    <link rel="shortcut icon" href="/images/github-color-svgrepo-com.svg">
    <!--- Page Info-->
    
    <title>
        
            Langchain 入门教程 - 12.智能体 agent | Sharpen&#39;s Blogs
        
    </title>

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">


    <!--- Inject Part-->
    

    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/css/build/tailwind.css">

    

    
<link rel="stylesheet" href="/fonts/GeistMono/geist-mono.css">

    
<link rel="stylesheet" href="/fonts/Geist/geist.css">

    <!--- Font Part-->
    
        <link href="https://fonts.googleapis.com/css2?family=Lora" rel="stylesheet">
    
    
    
    
    
    

    <script id="hexo-configurations">
    window.config = {"hostname":"example.com","root":"/","language":"en","path":"search.json"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"delete_mask":false,"title_alignment":"left","headings_top_spacing":{"h1":"3.2rem","h2":"2.4rem","h3":"1.9rem","h4":"1.6rem","h5":"1.4rem","h6":"1.3rem"}},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":false,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","highlight_theme":{"light":"github","dark":"vs2015"},"font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":false,"default":"cc_by_nc_sa"},"lazyload":true,"pangu_js":false,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#FFD700","secondary":null,"default_mode":"light"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null},"title":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"website_counter":{"url":"https://cn.vercount.one/js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"preloader":{"enable":false,"custom_message":null},"open_graph":{"enable":true,"image":"/images/redefine-og.webp","description":"Hexo Theme Redefine, Redefine Your Hexo Journey."},"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/dune.jpg","dark":"/images/dune.jpg"},"title":"Sharpen's Blogs","subtitle":{"text":["Just regularly appending some blogs here, to keep my memory fresh and mind straight.","Here I am. ","Do not go gentle into that good night. "],"hitokoto":{"enable":false,"show_author":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":true,"family":"Lora","url":"https://fonts.googleapis.com/css2?family=Lora"},"social_links":{"enable":false,"style":"default","links":{"github":"https://github.com/shar-pen","instagram":null,"zhihu":null,"twitter":null,"email":"xiapeng21011@mail.ustc.edu.cn"},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null,"lrc":null}]},"mermaid":{"enable":false,"version":"11.4.1"}},"version":"2.8.2","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"width":{"home":"1200px","pages":"1000px"},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Categories":{"path":"/categories","icon":"fa-solid fa-folder"},"About":{"path":"/about","icon":"fa-regular fa-user"},"Links":{"icon":"fa-regular fa-link","submenus":{"Github":"https://github.com/shar-pen","Blog":"https://github.com/shar-pen.github.io","CSDN":"https://blog.csdn.net/the_3rd_bomb"}}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":":)","show_on_mobile":true,"links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"path":"/tags","icon":"fa-regular fa-tags"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"}}},"article_date_format":"YYYY-MM-DD","excerpt_length":200,"categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":null};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 7.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>



<body>
	<div class="progress-bar-container">
	

	
	<span class="pjax-progress-bar"></span>
	<!--        <span class="swup-progress-icon">-->
	<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
	<!--        </span>-->
	
</div>

<main class="page-container" id="swup">

	

	<div class="main-content-container flex flex-col justify-between min-h-dvh">
		<div class="main-content-header">
			<header class="navbar-container px-6 md:px-12">
    <div class="navbar-content transition-navbar ">
        <div class="left">
            
                <a class="logo-image h-8 w-8 sm:w-10 sm:h-10 mr-3" href="/">
                    <img src="/images/github-color-svgrepo-com.svg" class="w-full h-full rounded-sm">
                </a>
            
            <a class="logo-title" href="/">
                
                Sharpen&#39;s Blogs
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    HOME
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/archives"
                                        >
                                    <i class="fa-regular fa-archive fa-fw"></i>
                                    ARCHIVES
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/categories"
                                        >
                                    <i class="fa-solid fa-folder fa-fw"></i>
                                    CATEGORIES
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/about"
                                        >
                                    <i class="fa-regular fa-user fa-fw"></i>
                                    ABOUT
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown"
                                   href="#"
                                        onClick=&#34;return false;&#34;>
                                    <i class="fa-regular fa-link fa-fw"></i>
                                    LINKS
                                    <i class="fa-solid fa-chevron-down fa-fw"></i>
                                </a>

                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://github.com/shar-pen">
                                                    GITHUB
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://github.com/shar-pen.github.io">
                                                    BLOG
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://blog.csdn.net/the_3rd_bomb">
                                                    CSDN
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i>
                    </div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                HOME
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/archives"
                        >
                            <span>
                                ARCHIVES
                            </span>
                            
                                <i class="fa-regular fa-archive fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/categories"
                        >
                            <span>
                                CATEGORIES
                            </span>
                            
                                <i class="fa-solid fa-folder fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/about"
                        >
                            <span>
                                ABOUT
                            </span>
                            
                                <i class="fa-regular fa-user fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item-sub text-base my-1.5 flex flex-col w-full">
                        
                        <div class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary cursor-pointer text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                             navbar-data-toggle="submenu-Links"
                        >
                            <span>
                                LINKS
                            </span>
                            
                                <i class="fa-solid fa-chevron-right fa-sm fa-fw transition-all"></i>
                            
                        </div>
                        

                        
                            <div class="flex-col items-start px-2 py-2 hidden" data-target="submenu-Links">
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://github.com/shar-pen">GITHUB</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://github.com/shar-pen.github.io">BLOG</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://blog.csdn.net/the_3rd_bomb">CSDN</a>
                                    </div>
                                
                            </div>
                        
                    </li>
            

            
            
                
                    
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/tags"
                        >
                            <span>Tags</span>
                            <i class="fa-regular fa-tags fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">9</div>
        <div class="label text-third-text-color text-sm">Tags</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">11</div>
        <div class="label text-third-text-color text-sm">Categories</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">45</div>
        <div class="label text-third-text-color text-sm">Posts</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


		</div>

		<div class="main-content-body transition-fade-up">
			

			<div class="main-content">
				<div class="post-page-container flex relative justify-between box-border w-full h-full">
	<div class="article-content-container">

		<div class="article-title relative w-full">
			
			<div class="w-full flex items-center pt-6 justify-start">
				<h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">Langchain 入门教程 - 12.智能体 agent</h1>
			</div>
			
		</div>

		
		<div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
			<div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
				<img src="/images/avatar.jpg">
			</div>
			<div class="info flex flex-col justify-between">
				<div class="author flex items-center">
					<span class="name text-default-text-color text-lg font-semibold">Peng Xia</span>
					
				</div>
				<div class="meta-info">
					<div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2025-05-04 22:43:57</span>
        <span class="mobile">2025-05-04 22:43:57</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2025-05-04 22:51:24</span>
            <span class="mobile">2025-05-04 22:51:24</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/Langchain-%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/">Langchain 入门教程</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Langchain/">Langchain</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>9.9k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>54 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

				</div>
			</div>
		</div>
		

		


		<div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
			<h1 id="Tool"><a href="#Tool" class="headerlink" title="Tool"></a>Tool</h1><p>工具是一个接口，允许代理、链条或大语言模型与外部世界互动。</p>
<p>LangChain 提供了易于使用的内置工具，并且还允许用户轻松构建自定义工具。</p>
<p><strong>你可以在下面的链接中找到集成到 LangChain 中的工具列表。</strong></p>
<ul>
<li><a class="link" target="_blank" rel="noopener" href="https://python.langchain.com/docs/integrations/tools/">集成到 LangChain 中的工具列表<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></li>
</ul>
<h2 id="内置工具-Built-in-tools"><a href="#内置工具-Built-in-tools" class="headerlink" title="内置工具 Built-in tools"></a>内置工具 Built-in tools</h2><p>你可以使用 LangChain 提供的预定义工具和工具包。</p>
<p>工具指的是单一的实用工具，而工具包将多个工具组合成一个单元供使用。</p>
<p>你可以在下面的链接中找到相关的工具。</p>
<p><strong>注意</strong></p>
<ul>
<li><a class="link" target="_blank" rel="noopener" href="https://python.langchain.com/docs/integrations/tools/">LangChain 工具/工具包<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></li>
</ul>
<p>web 检索工具</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.utilities <span class="keyword">import</span> GoogleSerperAPIWrapper</span><br><span class="line"></span><br><span class="line">search = GoogleSerperAPIWrapper()</span><br><span class="line">search.run(<span class="string">"Obama's first name?"</span>)</span><br></pre></td></tr></table></figure></div>

<p>图片生成工具</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.output_parsers <span class="keyword">import</span> StrOutputParser</span><br><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> PromptTemplate</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"></span><br><span class="line"><span class="comment"># Initialize the ChatOpenAI model</span></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">	base_url=<span class="string">'http://localhost:5551/v1'</span>,</span><br><span class="line">	api_key=<span class="string">'EMPTY'</span>,</span><br><span class="line">	model_name=<span class="string">'Qwen2.5-7B-Instruct'</span>,</span><br><span class="line">	temperature=<span class="number">0.2</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define a prompt template for DALL-E image generation</span></span><br><span class="line">prompt = PromptTemplate.from_template(</span><br><span class="line">    <span class="string">"Generate a detailed IMAGE GENERATION prompt for DALL-E based on the following description. "</span></span><br><span class="line">    <span class="string">"Return only the prompt, no intro, no explanation, no chatty, no markdown, no code block, no nothing. Just the prompt"</span></span><br><span class="line">    <span class="string">"Output should be less than 1000 characters. Write in English only."</span></span><br><span class="line">    <span class="string">"Image Description: \n{image_desc}"</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a chain connecting the prompt, LLM, and output parser</span></span><br><span class="line">chain = prompt | llm | StrOutputParser()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Execute the chain</span></span><br><span class="line">image_prompt = chain.invoke(</span><br><span class="line">    {<span class="string">"image_desc"</span>: <span class="string">"A Neo-Classicism painting satirizing people looking at their smartphones."</span>}</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output the image prompt</span></span><br><span class="line"><span class="built_in">print</span>(image_prompt)</span><br></pre></td></tr></table></figure></div>

<p>几乎所有 tool 都是需要 api key 的</p>
<h2 id="Python-REPL-工具"><a href="#Python-REPL-工具" class="headerlink" title="Python REPL 工具"></a>Python REPL 工具</h2><p>此工具提供一个类，用于在 <strong>REPL (Read-Eval-Print Loop)</strong> 环境中执行 Python 代码。</p>
<ul>
<li><a class="link" target="_blank" rel="noopener" href="https://python.langchain.com/docs/integrations/tools/python/">PythonREPLTool<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></li>
</ul>
<p><strong>描述</strong></p>
<ul>
<li>提供一个 Python shell 环境。</li>
<li>执行有效的 Python 命令作为输入。</li>
<li>使用 <code>print(...)</code> 函数查看结果。</li>
</ul>
<p><strong>主要特点</strong></p>
<ul>
<li>sanitize_input：可选项，用于清理输入（默认：True）</li>
<li>python_repl：<strong>PythonREPL</strong> 的实例（默认：在全局作用域中执行）</li>
</ul>
<p><strong>使用方法</strong></p>
<ul>
<li>创建 <code>PythonREPLTool</code> 的实例。</li>
<li>使用 <code>run</code>、<code>arun</code> 或 <code>invoke</code> 方法执行 Python 代码。</li>
</ul>
<p><strong>输入清理</strong></p>
<ul>
<li>从输入字符串中移除不必要的空格、反引号、关键字 “python” 和其他多余的元素。</li>
</ul>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_experimental.tools <span class="keyword">import</span> PythonREPLTool</span><br><span class="line"></span><br><span class="line"><span class="comment"># Creates a tool for executing Python code.</span></span><br><span class="line">python_tool = PythonREPLTool()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Executes Python code and returns the results.</span></span><br><span class="line"><span class="built_in">print</span>(python_tool.invoke(<span class="string">"print(100 + 200)"</span>))</span><br></pre></td></tr></table></figure></div>

<p>下面是请求大语言模型编写 Python 代码并返回结果的示例。</p>
<p><strong>工作流程概述</strong></p>
<ol>
<li>请求大语言模型为特定任务编写 Python 代码。</li>
<li>执行生成的代码以获取结果。</li>
<li>输出结果。</li>
</ol>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> ChatPromptTemplate</span><br><span class="line"><span class="keyword">from</span> langchain_core.output_parsers <span class="keyword">import</span> StrOutputParser</span><br><span class="line"><span class="keyword">from</span> langchain_core.runnables <span class="keyword">import</span> RunnableLambda</span><br><span class="line"></span><br><span class="line">python_tool = PythonREPLTool()</span><br><span class="line"><span class="comment"># A function that executes Python code, outputs intermediate steps, and returns the tool execution results.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_and_execute</span>(<span class="params">code, debug=<span class="literal">True</span></span>):</span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"CODE:"</span>)</span><br><span class="line">        <span class="built_in">print</span>(code)</span><br><span class="line">    <span class="keyword">return</span> python_tool.invoke(code)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># A prompt requesting Python code to be written.</span></span><br><span class="line">prompt = ChatPromptTemplate.from_messages(</span><br><span class="line">    [</span><br><span class="line">        (</span><br><span class="line">            <span class="string">"system"</span>,</span><br><span class="line">            <span class="string">"You are Raymond Hetting, an expert python programmer, well versed in meta-programming and elegant, concise and short but well documented code. You follow the PEP8 style guide. "</span></span><br><span class="line">            <span class="string">"Return only the code, no intro, no explanation, no chatty, no markdown, no code block, no nothing. Just the code."</span>,</span><br><span class="line">        ),</span><br><span class="line">        (<span class="string">"human"</span>, <span class="string">"{input}"</span>),</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line"><span class="comment"># Create LLM model.</span></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">	base_url=<span class="string">'http://localhost:5551/v1'</span>,</span><br><span class="line">	api_key=<span class="string">'EMPTY'</span>,</span><br><span class="line">	model_name=<span class="string">'Qwen2.5-7B-Instruct'</span>,</span><br><span class="line">	temperature=<span class="number">0.2</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a chain using the prompt and the LLM model.</span></span><br><span class="line">chain = prompt | llm | StrOutputParser() | RunnableLambda(print_and_execute)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Outputting the results.</span></span><br><span class="line"><span class="built_in">print</span>(chain.invoke(<span class="string">"Write code to generate Powerball numbers."</span>))</span><br></pre></td></tr></table></figure></div>

<h2 id="自定义工具"><a href="#自定义工具" class="headerlink" title="自定义工具"></a>自定义工具</h2><p>除了 LangChain 提供的内置工具外，你还可以定义和使用自己的自定义工具。</p>
<p>为此，可以使用 <code>langchain.tools</code> 模块提供的 <code>@tool</code> 装饰器将一个函数转换为工具。</p>
<p>@tool 装饰器: 这个装饰器允许你将一个函数转换为工具。它提供了各种选项来定制工具的行为。</p>
<p><strong>使用方法</strong></p>
<ol>
<li>在函数上方应用 <code>@tool</code> 装饰器。</li>
<li>根据需要设置装饰器参数。</li>
</ol>
<p>使用这个装饰器，你可以轻松地将常规 Python 函数转换为强大的工具，从而实现自动化文档生成和灵活的接口创建。</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.tools <span class="keyword">import</span> tool</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Convert a function into a tool using a decorator.</span></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_numbers</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">"""Add two numbers"""</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">multiply_numbers</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">"""Multiply two numbers"""</span></span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line"></span><br><span class="line"><span class="comment"># Execute tool.</span></span><br><span class="line"><span class="built_in">print</span>(add_numbers.invoke({<span class="string">"a"</span>: <span class="number">3</span>, <span class="string">"b"</span>: <span class="number">4</span>}))</span><br><span class="line"><span class="built_in">print</span>(multiply_numbers.invoke({<span class="string">"a"</span>: <span class="number">3</span>, <span class="string">"b"</span>: <span class="number">4</span>}))</span><br></pre></td></tr></table></figure></div>

<h2 id="创建一个用于-Google-新闻文章搜索的自定义工具"><a href="#创建一个用于-Google-新闻文章搜索的自定义工具" class="headerlink" title="创建一个用于 Google 新闻文章搜索的自定义工具"></a>创建一个用于 Google 新闻文章搜索的自定义工具</h2><p>定义 <code>GoogleNews</code> 类，该类将作为一个工具，用于搜索 Google 新闻文章。</p>
<p><strong>注意</strong></p>
<ul>
<li>不需要 API 密钥（因为它使用 RSS 源）。</li>
</ul>
<p>此工具用于搜索由 <strong>news.google.com</strong> 提供的新闻文章。</p>
<p><strong>描述</strong></p>
<ul>
<li>使用 Google 新闻搜索 API 来检索最新的新闻。</li>
<li>允许基于关键词搜索新闻。</li>
</ul>
<p><strong>主要参数</strong></p>
<ul>
<li><code>k</code> (int)：返回的最大搜索结果数（默认：5）。</li>
</ul>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hl: 语言, gl: 区域, ceid: 区域和语言代码</span></span><br><span class="line">url = <span class="string">f"<span class="subst">{self.base_url}</span>?hl=en&amp;gl=US&amp;ceid=US:en"</span> </span><br></pre></td></tr></table></figure></div>

<p>在代码中，你可以通过修改语言 (hl)、区域 (gl) 和区域与语言代码 (ceid) 来调整搜索结果的语言和区域。</p>
<p><strong>注意</strong></p>
<p>将提供的代码保存为 <code>google_news.py</code>，然后你可以在其他文件中使用 <code>from google_news import GoogleNews</code> 进行导入。</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> feedparser</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Dict</span>, <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GoogleNews</span>:</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    This is a class for searching Google News and returning the results.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Initializes the GoogleNews class.</span></span><br><span class="line"><span class="string">        Sets the base_url attribute.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="variable language_">self</span>.base_url = <span class="string">"https://news.google.com/rss"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_fetch_news</span>(<span class="params">self, url: <span class="built_in">str</span>, k: <span class="built_in">int</span> = <span class="number">3</span></span>) -&gt; <span class="type">List</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">str</span>]]:</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Fetches news from the given URL.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            url (str): The URL to fetch the news from.</span></span><br><span class="line"><span class="string">            k (int): The maximum number of news articles to fetch (default: 3).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            List[Dict[str, str]]: A list of dictionaries containing news titles and links.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        news_data = feedparser.parse(url)</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            {<span class="string">"title"</span>: entry.title, <span class="string">"link"</span>: entry.link}</span><br><span class="line">            <span class="keyword">for</span> entry <span class="keyword">in</span> news_data.entries[:k]</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_collect_news</span>(<span class="params">self, news_list: <span class="type">List</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">str</span>]]</span>) -&gt; <span class="type">List</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">str</span>]]:</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Formats and returns the list of news articles.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            news_list (List[Dict[str, str]]): A list of dictionaries containing news information.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            List[Dict[str, str]]: A list of dictionaries containing URLs and content.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> news_list:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"No news available for the given keyword."</span>)</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">        result = []</span><br><span class="line">        <span class="keyword">for</span> news <span class="keyword">in</span> news_list:</span><br><span class="line">            result.append({<span class="string">"url"</span>: news[<span class="string">"link"</span>], <span class="string">"content"</span>: news[<span class="string">"title"</span>]})</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">search_latest</span>(<span class="params">self, k: <span class="built_in">int</span> = <span class="number">3</span></span>) -&gt; <span class="type">List</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">str</span>]]:</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Searches for the latest news.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            k (int): The maximum number of news articles to search for (default: 3).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            List[Dict[str, str]]: A list of dictionaries containing URLs and content.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment">#url = f"{self.base_url}?hl=ko&amp;gl=KR&amp;ceid=KR:ko"</span></span><br><span class="line">        url = <span class="string">f"<span class="subst">{self.base_url}</span>?hl=en&amp;gl=US&amp;ceid=US:en"</span> <span class="comment"># hl: 언어, gl: 지역, ceid: 지역 및 언어 코드</span></span><br><span class="line">        news_list = <span class="variable language_">self</span>._fetch_news(url, k)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._collect_news(news_list)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">search_by_keyword</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self, keyword: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span>, k: <span class="built_in">int</span> = <span class="number">3</span></span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="type">List</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">str</span>]]:</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Searches for news using a keyword.  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            keyword (Optional[str]): The keyword to search for (default: None).</span></span><br><span class="line"><span class="string">            k (int): The maximum number of news articles to search for (default: 3).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            List[Dict[str, str]]: A list of dictionaries containing URLs and content.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> keyword:</span><br><span class="line">            encoded_keyword = quote(keyword)</span><br><span class="line">            url = <span class="string">f"<span class="subst">{self.base_url}</span>/search?q=<span class="subst">{encoded_keyword}</span>"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            url = <span class="string">f"<span class="subst">{self.base_url}</span>?hl=en&amp;gl=US&amp;ceid=US:en"</span></span><br><span class="line">        news_list = <span class="variable language_">self</span>._fetch_news(url, k)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._collect_news(news_list)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">google_tool = GoogleNews()</span><br></pre></td></tr></table></figure></div>


<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">google_tool.search_by_keyword(<span class="string">"AI Investment"</span>)</span><br></pre></td></tr></table></figure></div>

<p>地址是 google 的, 得翻墙, 以下是示例结果  </p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><figcaption><span>'https://news.google.com/rss/articles/CBMimAFBVV95cUxPNkFrLURMdEZWOV9zdmRrTUhNbVFkdWswZWx2Qmh4cTJlMmFIdmpsQ3doaVluenA3TEJaT0U3RWVmanl3TTQ5V3RfS3kyYVpydEloNWZXbjBmSF85MGR5cjNFSFI5eFhtTGdIVlNXX3UxNmxwMnVIb2NkTXA5WFVZR2hKLUw5RU9iT3k1Zno2UG10N2h1b2g5Sw?oc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> 'content': 'Nvidia Calls China\'s DeepSeek an "Excellent AI Advancement": Should Investors Press the Buy Button? - The Motley Fool'},</span><br><span class="line">{'url': 'https://news.google.com/rss/articles/CBMikwFBVV95cUxPd2ZnMnNwSWo2ZGhVSUJuNHd5S1Y3WUNWSkM4a0h5aHZQWU8tdzdlaW9pb25RUnI2cEwyZGtTemo5VUgwTDNHLVppNkw2MXdsbTRnb0UteHhtaHgxV043ZE9ZeG5aLUlCTzBGSHc1TFJzaHJsZENObzMxdTlvaEcyaG9vSjlRSTFWYXJEelF6RkRETnc?oc=5',</span><br><span class="line"> 'content': 'How DeepSeek is upending AI innovation and investment after sending tech leaders reeling - New York Post'},</span><br><span class="line">{'url': 'https://news.google.com/rss/articles/CBMivwFBVV95cUxNUGdjLVE5dFpLaVZOcFY1djBRQXBLeTNZalptNmstNXlWRkpvX1U2aTJ5cDNiS3RNT2JzeGI1SnlzTXIyS2dWcEdieDB4R1kxSEo2eXUydlRkVWlzOGdUTnVCQ2NwNjNjaFpCdVpxQkphZXYxLU9BaXhBWmdVYWVjQnY1N3Q1aUtqaER5LV9WVlNWZ3BXMk5WR0gwWnlIU3RIazJZelZJQUM1ek12ZDFodEg1eDFaRm56eTR5UEh3VQ?oc=5',</span><br><span class="line"> 'content': 'DeepSeek Marks The End Of The First Phase Of The AI Investment Boom - Forbes'}]</span><br></pre></td></tr></table></figure></div>



<p>再用 tool 装饰器</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.tools <span class="keyword">import</span> tool</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Dict</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a tool for searching news by keyword</span></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search_keyword</span>(<span class="params">query: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">str</span>]]:</span><br><span class="line">    <span class="string">"""Look up news by keyword"""</span></span><br><span class="line">    <span class="built_in">print</span>(query)</span><br><span class="line">    news_tool = GoogleNews()</span><br><span class="line">    <span class="keyword">return</span> news_tool.search_by_keyword(query, k=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"><span class="comment"># Execution Results</span></span><br><span class="line">search_keyword.invoke({<span class="string">"query"</span>: <span class="string">"LangChain AI"</span>})</span><br></pre></td></tr></table></figure></div>

<h1 id="bind-tools"><a href="#bind-tools" class="headerlink" title="bind_tools"></a>bind_tools</h1><p><code>bind_tools</code> 是 LangChain 中的一个强大功能，用于将自定义工具与大语言模型 (LLMs) 集成，从而实现增强的 AI 工作流。</p>
<p>接下来展示如何创建、绑定工具、解析并执行输出，并将它们集成到 <code>AgentExecutor</code> 中。</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/12.Agent/tool_calling_components-bef9d2bcb9d3706c2fe58b57bf8ccb60.png"></p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">from</span> langchain_core.tools <span class="keyword">import</span> tool</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define the tools</span></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_word_length</span>(<span class="params">word: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">"""Return the length of the given text"""</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(word)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_function</span>(<span class="params">a: <span class="built_in">float</span>, b: <span class="built_in">float</span></span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">    <span class="string">"""Add two numbers together"""</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">tools = [get_word_length, add_function]</span><br></pre></td></tr></table></figure></div>

<p>现在，让我们使用 <code>bind_tools</code> 函数将定义的工具与特定的大语言模型 (LLM) 关联起来。</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a model</span></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">	base_url=<span class="string">'http://localhost:5551/v1'</span>,</span><br><span class="line">	api_key=<span class="string">'EMPTY'</span>,</span><br><span class="line">	model_name=<span class="string">'Qwen2.5-3B-Instruct'</span>,</span><br><span class="line">	temperature=<span class="number">0.2</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Tool binding</span></span><br><span class="line">llm_with_tools = llm.bind_tools(tools)</span><br></pre></td></tr></table></figure></div>

<p>这是绑定函数的说明</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(json.dumps(llm_with_tools.kwargs, indent=<span class="number">2</span>))</span><br></pre></td></tr></table></figure></div>


<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">llm_with_tools.invoke(</span><br><span class="line">    <span class="string">"What is the length of the given text 'LangChain OpenTutorial'?"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>

<p>结果存储在 <code>tool_calls</code> 中。让我们打印 <code>tool_calls</code>。</p>
<p>[注意]</p>
<ul>
<li><code>name</code> 表示工具的名称。</li>
<li><code>args</code> 包含传递给工具的参数。</li>
</ul>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line"><span class="comment"># Execution result</span></span><br><span class="line">ret = llm_with_tools.invoke(</span><br><span class="line">    <span class="string">"What is the length of the given text 'LangChain OpenTutorial'?"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">pprint(ret.__dict__)</span><br><span class="line"><span class="built_in">print</span>(<span class="number">20</span>*<span class="string">'-'</span>)</span><br><span class="line">pprint(ret.tool_calls)</span><br></pre></td></tr></table></figure></div>

<h2 id="tool-输出解析-JsonOutputToolsParser"><a href="#tool-输出解析-JsonOutputToolsParser" class="headerlink" title="tool 输出解析 JsonOutputToolsParser"></a>tool 输出解析 JsonOutputToolsParser</h2><p>接下来，我们将把 <code>llm_with_tools</code> 与 <code>JsonOutputToolsParser</code> 连接起来，以解析 <code>tool_calls</code> 并查看结果。</p>
<ul>
<li><code>type</code> 表示工具的类型。</li>
<li><code>args</code> 包含传递给工具的参数。</li>
</ul>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.output_parsers.openai_tools <span class="keyword">import</span> JsonOutputToolsParser</span><br><span class="line"></span><br><span class="line"><span class="comment"># Tool Binding + Tool Parser</span></span><br><span class="line">chain = llm_with_tools | JsonOutputToolsParser(tools=tools)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Execution Result</span></span><br><span class="line">tool_call_results = chain.invoke(</span><br><span class="line">    <span class="string">"What is the length of the given text 'LangChain OpenTutorial'?"</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(tool_call_results)</span><br></pre></td></tr></table></figure></div>

<p><code>execute_tool_calls</code> 函数识别合适的工具，传递相应的 <code>args</code>，然后执行该工具。</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">execute_tool_calls</span>(<span class="params">tool_call_results</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Function to execute the tool call results.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param tool_call_results: List of the tool call results</span></span><br><span class="line"><span class="string">    :param tools: List of available tools</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Iterate over the list of the tool call results</span></span><br><span class="line">    <span class="keyword">for</span> tool_call_result <span class="keyword">in</span> tool_call_results:</span><br><span class="line">        <span class="comment"># Tool name (function name)</span></span><br><span class="line">        tool_name = tool_call_result[<span class="string">"type"</span>]</span><br><span class="line">        <span class="comment"># Tool arguments</span></span><br><span class="line">        tool_args = tool_call_result[<span class="string">"args"</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Find the tool that matches the name and execute it</span></span><br><span class="line">        <span class="comment"># Use the next() function to find the first matching tool</span></span><br><span class="line">        matching_tool = <span class="built_in">next</span>((tool <span class="keyword">for</span> tool <span class="keyword">in</span> tools <span class="keyword">if</span> tool.name == tool_name), <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> matching_tool:</span><br><span class="line">            <span class="comment"># Execute the tool</span></span><br><span class="line">            result = matching_tool.invoke(tool_args)</span><br><span class="line">            <span class="built_in">print</span>(</span><br><span class="line">                <span class="string">f"[Executed Tool] <span class="subst">{tool_name}</span> [Args] <span class="subst">{tool_args}</span>\n[Execution Result] <span class="subst">{result}</span>"</span></span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"Warning: Unable to find the tool corresponding to <span class="subst">{tool_name}</span>."</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Execute the tool calls</span></span><br><span class="line">execute_tool_calls(tool_call_results)</span><br></pre></td></tr></table></figure></div>

<h2 id="将工具与解析器绑定以执行"><a href="#将工具与解析器绑定以执行" class="headerlink" title="将工具与解析器绑定以执行"></a>将工具与解析器绑定以执行</h2><p>这次，我们将工具绑定、解析结果和执行工具调用的整个过程合并为一个步骤。</p>
<ul>
<li><code>llm_with_tools</code>：绑定工具的LLM模型。</li>
<li><code>JsonOutputToolsParser</code>：处理工具调用结果的解析器。</li>
<li><code>execute_tool_calls</code>：执行工具调用结果的函数。</li>
</ul>
<p>[流程摘要]</p>
<ol>
<li>将工具绑定到模型。</li>
<li>解析工具调用的结果。</li>
<li>执行工具调用的结果。</li>
</ol>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.output_parsers.openai_tools <span class="keyword">import</span> JsonOutputToolsParser</span><br><span class="line"></span><br><span class="line"><span class="comment"># bind_tools + Parser + Execution</span></span><br><span class="line">chain = llm_with_tools | JsonOutputToolsParser(tools=tools) | execute_tool_calls</span><br></pre></td></tr></table></figure></div>


<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chain.invoke(<span class="string">"What is the length of the given text 'LangChain OpenTutorial'?"</span>)</span><br></pre></td></tr></table></figure></div>


<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Execution Result 2</span></span><br><span class="line">chain.invoke(<span class="string">"114.5 + 121.2"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Double check</span></span><br><span class="line"><span class="built_in">print</span>(<span class="number">114.5</span> + <span class="number">121.2</span>)</span><br></pre></td></tr></table></figure></div>

<h2 id="将工具与Agent和AgentExecutor绑定"><a href="#将工具与Agent和AgentExecutor绑定" class="headerlink" title="将工具与Agent和AgentExecutor绑定"></a>将工具与Agent和<code>AgentExecutor</code>绑定</h2><p><code>bind_tools</code> 提供可以由模型使用的工具（schemas）。</p>
<p><code>AgentExecutor</code> 创建一个执行循环，用于执行诸如调用LLM、路由到合适的工具、执行工具以及重新调用模型等任务。</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> ChatPromptTemplate, MessagesPlaceholder</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create an Agent prompt</span></span><br><span class="line">prompt = ChatPromptTemplate.from_messages(</span><br><span class="line">    [</span><br><span class="line">        (</span><br><span class="line">            <span class="string">"system"</span>,</span><br><span class="line">            <span class="string">"You are very powerful assistant, but don't know current events"</span>,</span><br><span class="line">        ),</span><br><span class="line">        (<span class="string">"user"</span>, <span class="string">"{input}"</span>),</span><br><span class="line">        MessagesPlaceholder(variable_name=<span class="string">"agent_scratchpad"</span>),</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a model</span></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">	base_url=<span class="string">'http://localhost:5551/v1'</span>,</span><br><span class="line">	api_key=<span class="string">'EMPTY'</span>,</span><br><span class="line">	model_name=<span class="string">'Qwen2.5-3B-Instruct'</span>,</span><br><span class="line">	temperature=<span class="number">0.2</span>,</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>


<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.agents <span class="keyword">import</span> AgentExecutor, create_tool_calling_agent</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use the tools defined previously</span></span><br><span class="line">tools = [get_word_length, add_function]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create an Agent</span></span><br><span class="line">agent = create_tool_calling_agent(llm, tools, prompt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create an AgentExecutor</span></span><br><span class="line">agent_executor = AgentExecutor(</span><br><span class="line">    agent=agent,</span><br><span class="line">    tools=tools,</span><br><span class="line">    verbose=<span class="literal">True</span>,</span><br><span class="line">    handle_parsing_errors=<span class="literal">True</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>


<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Execute the Agent</span></span><br><span class="line">result = agent_executor.invoke(</span><br><span class="line">    {<span class="string">"input"</span>: <span class="string">"What is the length of the given text 'LangChain OpenTutorial'?"</span>}</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Execution Result</span></span><br><span class="line"><span class="built_in">print</span>(result[<span class="string">"output"</span>])</span><br></pre></td></tr></table></figure></div>


<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Execute the Agent</span></span><br><span class="line">result = agent_executor.invoke({<span class="string">"input"</span>: <span class="string">"Calculate the result of 114.5 + 121.2"</span>})</span><br><span class="line"></span><br><span class="line"><span class="comment"># Execution Result</span></span><br><span class="line"><span class="built_in">print</span>(result[<span class="string">"output"</span>])</span><br></pre></td></tr></table></figure></div>

<p>小模型的性能还是会存在解析和 reasoning 方面的错误</p>
<h1 id="Tool-Calling-Agent"><a href="#Tool-Calling-Agent" class="headerlink" title="Tool Calling Agent"></a>Tool Calling Agent</h1><p>在 LangChain 中，<strong>工具调用</strong>（tool calling）允许模型检测何时调用一个或多个<strong>工具</strong>，以及需要将什么输入传递给这些工具。</p>
<p>在进行 API 调用时，你可以定义工具，并智能地引导模型生成结构化对象，例如 JSON，这些对象包含调用这些工具所需的参数。</p>
<p>工具 API 的目标是提供比标准的文本生成或聊天 API 更加可靠的有效和有用的<strong>工具调用</strong>生成。</p>
<p>你可以创建代理（agents），这些代理会迭代地调用工具并接收结果，直到通过整合这些结构化输出解决查询，并将多个工具绑定到一个工具调用的聊天模型，让模型选择调用哪些工具。</p>
<p>这代表了一个更加<strong>通用的版本</strong>，它是为 OpenAI 的特定工具调用风格设计的 OpenAI 工具代理的扩展。</p>
<p>这个代理使用 LangChain 的 <code>ToolCall</code> 接口，支持比 OpenAI 更广泛的提供者实现，包括 <code>Anthropic</code>、<code>Google Gemini</code> 和 <code>Mistral</code> 等。</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/12.Agent/15-agent-agent-concept.png"></p>
<h2 id="创建工具"><a href="#创建工具" class="headerlink" title="创建工具"></a>创建工具</h2><p>LangChain 允许你定义自定义工具，供你的代理与之交互。你可以创建用于搜索新闻或执行 Python 代码的工具。</p>
<p><code>@tool</code> 装饰器用于创建工具：</p>
<ul>
<li><code>TavilySearchResults</code> 是一个用于搜索新闻的工具。</li>
<li><code>PythonREPL</code> 是一个用于执行 Python 代码的工具。</li>
</ul>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.tools <span class="keyword">import</span> tool</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Dict</span>, Annotated</span><br><span class="line"><span class="keyword">from</span> langchain_community.tools <span class="keyword">import</span> TavilySearchResults</span><br><span class="line"><span class="keyword">from</span> langchain_experimental.utilities <span class="keyword">import</span> PythonREPL</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Creating tool for searching news</span></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search_news</span>(<span class="params">query: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">str</span>]]:</span><br><span class="line">    <span class="string">"""Search news by input keyword using Tavily Search API"""</span></span><br><span class="line">    news_tool = TavilySearchResults(</span><br><span class="line">        max_results=<span class="number">3</span>,</span><br><span class="line">        include_answer=<span class="literal">True</span>,</span><br><span class="line">        include_raw_content=<span class="literal">True</span>,</span><br><span class="line">        include_images=<span class="literal">True</span>,</span><br><span class="line">        <span class="comment"># search_depth="advanced",</span></span><br><span class="line">        <span class="comment"># include_domains = [],</span></span><br><span class="line">        <span class="comment"># exclude_domains = []</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> news_tool.invoke(query, k=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Creating tool for executing python code</span></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">python_repl_tool</span>(<span class="params"></span></span><br><span class="line"><span class="params">    code: Annotated[<span class="built_in">str</span>, <span class="string">"The python code to execute to generate your chart."</span>],</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="string">"""Use this tool to execute Python code. If you want to see the output of a value,</span></span><br><span class="line"><span class="string">    you should print it using print(...). This output is visible to the user."""</span></span><br><span class="line">    result = <span class="string">""</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = PythonREPL().run(code)</span><br><span class="line">    <span class="keyword">except</span> BaseException <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"Failed to execute. Error: <span class="subst">{<span class="built_in">repr</span>(e)}</span>"</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"Tool name: <span class="subst">{search_news.name}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"Tool description: <span class="subst">{search_news.description}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"Tool args: <span class="subst">{search_news.args}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'-'</span>*<span class="number">20</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"Tool name: <span class="subst">{python_repl_tool.name}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"Tool description: <span class="subst">{python_repl_tool.description}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"Tool args: <span class="subst">{python_repl_tool.args}</span>"</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<pre><code>Tool name: search_news
Tool description: Search news by input keyword using Tavily Search API
Tool args: {'query': {'title': 'Query', 'type': 'string'}}
--------------------
Tool name: python_repl_tool
Tool description: Use this tool to execute Python code. If you want to see the output of a value,
    you should print it using print(...). This output is visible to the user.
Tool args: {'code': {'description': 'The python code to execute to generate your chart.', 'title': 'Code', 'type': 'string'}}
</code></pre>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">search_news(<span class="string">'2024'</span>)</span><br></pre></td></tr></table></figure></div>




<pre><code>[{'url': 'https://en.wikipedia.org/wiki/2024_in_the_United_States',
  'content': "In the Senate, at least six seats, those of Senators Tom Carper from Delaware, Mike Braun from Indiana, Ben Cardin from Maryland, Debbie Stabenow from Michigan, Mitt Romney from Utah, and Joe Manchin from West Virginia, will be open contests; the seat of the late Dianne Feinstein is also expected to be an open contest with Feinstein's immediate replacement, Laphonza Butler, expected to serve on an interim basis.[1][2][3]\nConcerning state governments, 11 states and two territories will hold gubernatorial elections, and most states and territories will hold elections for their legislatures. Contents\n2024 in the United States\nThe following is a list of predicted and scheduled events of the year 2024 in the United States, that have not yet occurred.\n With former president Donald Trump's declaration to run for the office again, the election may possibly be a rematch of the 2020 election, although the June 2023 indictment of Donald Trump may have a significant impact on Trump's presidential campaign. In the federal government, the offices of the president, vice president, all 435 seats of the House of Representatives, and roughly one third of the Senate. ←\n→\nElections[edit]\nThe US general elections will be held on November 5 of this year."},
 {'url': 'https://abcnews.go.com/Entertainment/abc-news-year-2024-back-years-major-news/story?id=116448091',
  'content': 'ABC News\' \'The Year: 2024\' looks back at this year\'s major news and entertainment events - ABC News ABC News ABC News\' \'The Year: 2024\' looks back at this year\'s major news and entertainment events As the world gears up for 2025, it leaves behind a year of war, political shifts, pop culture moments, sporting triumphs, lost stars and more. ABC News was there to chronicle every moment and will look back at this year\'s defining events in a two-hour special, "The Year: 2024," which airs Thursday, Dec. 26 at 9 p.m. ET, and streams afterwards on Hulu. The special also explores how the love lives of some of our favorite stars evolved this year. ABC News Live'},
 {'url': 'https://en.wikipedia.org/wiki/2024',
  'content': 'May 8 – In North Macedonian elections, the right-wing party VMRO-DPMNE wins in a landslide in the parliamentary elections, while its presidential candidate Gordana Siljanovska-Davkova is elected as the first female president of the country in the second round of the presidential election.[88][89] July 13 – While campaigning for the 2024 United States presidential election, former President Donald Trump is shot in the right ear in an assassination attempt at a rally he held near Butler, Pennsylvania.[139] July 28 – 2024 Venezuelan presidential election: Incumbent President Nicolás Maduro declares victory against opposition candidate Edmundo González Urrutia amid alleged irregularities, causing numerous South American states to refuse to acknowledge the results or suspend diplomatic relations with the Maduro government and sparking nationwide protests.[151]'}]
</code></pre>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Creating tools</span></span><br><span class="line">tools = [search_news, python_repl_tool]</span><br></pre></td></tr></table></figure></div>

<h2 id="构建代理提示"><a href="#构建代理提示" class="headerlink" title="构建代理提示"></a>构建代理提示</h2><ul>
<li><code>chat_history</code>：此变量存储对话历史记录，如果你的代理支持多轮对话，则使用此变量。（否则，可以省略此项。）</li>
<li><code>agent_scratchpad</code>：此变量作为临时存储，用于存放中间变量。</li>
<li><code>input</code>：此变量代表用户的输入。</li>
</ul>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> ChatPromptTemplate</span><br><span class="line"></span><br><span class="line"><span class="comment"># Creating prompt</span></span><br><span class="line"><span class="comment"># Prompt is a text that describes the task the model should perform. (input the name and role of the tool)</span></span><br><span class="line">prompt = ChatPromptTemplate.from_messages(</span><br><span class="line">    [</span><br><span class="line">        (</span><br><span class="line">            <span class="string">"system"</span>,</span><br><span class="line">            <span class="string">"You are a helpful assistant. "</span></span><br><span class="line">            <span class="string">"Make sure to use the `search_news` tool for searching keyword related news."</span>,</span><br><span class="line">        ),</span><br><span class="line">        (<span class="string">"placeholder"</span>, <span class="string">"{chat_history}"</span>),</span><br><span class="line">        (<span class="string">"human"</span>, <span class="string">"{input}"</span>),</span><br><span class="line">        (<span class="string">"placeholder"</span>, <span class="string">"{agent_scratchpad}"</span>),</span><br><span class="line">    ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>

<h2 id="创建代理"><a href="#创建代理" class="headerlink" title="创建代理"></a>创建代理</h2><p>使用 <code>create_tool_calling_agent</code> 函数定义一个代理。</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> langchain.agents <span class="keyword">import</span> create_tool_calling_agent</span><br><span class="line"></span><br><span class="line"><span class="comment"># Creating LLM</span></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">	base_url=<span class="string">'http://localhost:5551/v1'</span>,</span><br><span class="line">	api_key=<span class="string">'EMPTY'</span>,</span><br><span class="line">	model_name=<span class="string">'Qwen2.5-3B-Instruct'</span>,</span><br><span class="line">	temperature=<span class="number">0.2</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Creating Agent</span></span><br><span class="line">agent = create_tool_calling_agent(llm, tools, prompt)</span><br></pre></td></tr></table></figure></div>

<h2 id="AgentExecutor"><a href="#AgentExecutor" class="headerlink" title="AgentExecutor"></a><code>AgentExecutor</code></h2><p><code>AgentExecutor</code> 是一个用于管理使用工具的代理的类。</p>
<p><strong>关键属性</strong></p>
<ul>
<li><code>agent</code>：负责创建计划并在执行循环的每个步骤中确定行动的底层代理。</li>
<li><code>tools</code>：包含代理被授权使用的所有有效工具的列表。</li>
<li><code>return_intermediate_steps</code>：布尔标志，决定是否返回代理在执行过程中所采取的中间步骤以及最终输出。</li>
<li><code>max_iterations</code>：代理在执行循环终止之前可以采取的最大步骤数。</li>
<li><code>max_execution_time</code>：执行循环允许运行的最长时间。</li>
<li><code>early_stopping_method</code>：定义当代理未返回 <code>AgentFinish</code> 时如何处理的方式。（”force” 或 “generate”）<ul>
<li><code>"force"</code>：返回一个字符串，表示执行循环由于达到时间或迭代限制而被停止。</li>
<li><code>"generate"</code>：调用代理的 LLM 链一次，根据之前的步骤生成最终答案。</li>
</ul>
</li>
<li><code>handle_parsing_errors</code>：指定如何处理解析错误。（可以设置为 <code>True</code>、<code>False</code>，或提供自定义错误处理函数。）</li>
<li><code>trim_intermediate_steps</code>：修剪中间步骤的方法。（可以设置为 <code>-1</code> 以保留所有步骤，或提供自定义修剪函数。）</li>
</ul>
<p><strong>关键方法</strong></p>
<ol>
<li><code>invoke</code>：执行代理。</li>
<li><code>stream</code>：流式传输达到最终输出所需的步骤。</li>
</ol>
<p><strong>关键特性</strong></p>
<ol>
<li><strong>工具验证</strong>：确保工具与代理兼容。</li>
<li><strong>执行控制</strong>：设置最大迭代次数和执行时间限制来管理代理行为。</li>
<li><strong>错误处理</strong>：提供多种处理输出解析错误的选项。</li>
<li><strong>中间步骤管理</strong>：允许修剪中间步骤或返回调试选项。</li>
<li><strong>异步支持</strong>：支持异步执行和结果的流式传输。</li>
</ol>
<p><strong>优化建议</strong></p>
<ul>
<li>设置适当的 <code>max_iterations</code> 和 <code>max_execution_time</code> 值来管理执行时间。</li>
<li>使用 <code>trim_intermediate_steps</code> 来优化内存使用。</li>
<li>对于复杂任务，使用 <code>stream</code> 方法来逐步监控结果。</li>
</ul>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.agents <span class="keyword">import</span> AgentExecutor</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create AgentExecutor</span></span><br><span class="line">agent_executor = AgentExecutor(</span><br><span class="line">    agent=agent,</span><br><span class="line">    tools=tools,</span><br><span class="line">    verbose=<span class="literal">True</span>,</span><br><span class="line">    max_iterations=<span class="number">10</span>,</span><br><span class="line">    max_execution_time=<span class="number">10</span>,</span><br><span class="line">    handle_parsing_errors=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Run AgentExecutor</span></span><br><span class="line">result = agent_executor.invoke({<span class="string">"input"</span>: <span class="string">"Search news about AI Agent in 2025."</span>})</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Agent execution result:"</span>)</span><br><span class="line"><span class="built_in">print</span>(result[<span class="string">"output"</span>])</span><br></pre></td></tr></table></figure></div>

<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">​    [1m&gt; Entering new AgentExecutor chain...[0m</span><br><span class="line">​    [32;1m[1;3m</span><br><span class="line">​    Invoking: `search_news` with `{'query': 'AI Agent 2025'}`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line">​    [0m[36;1m[1;3m[{'url': 'https://hai.stanford.edu/news/predictions-ai-2025-collaborative-agents-ai-skepticism-and-new-risks', 'content': 'According to leading experts from Stanford Institute for Human-Centered AI, one major trend is the rise of collaborative AI systems where multiple specialized agents work together, with humans providing high-level guidance. I expect to see more focus on multimodal AI models in education, including in processing speech and images. AI Agents Work Together In 2025, we will see a significant shift from relying on individual AI models to using systems where multiple AI agents of diverse expertise work together. As an example, we recently introduced the\xa0Virtual Lab, where a professor AI agent leads a team of AI scientist agents (e.g., AI chemist, AI biologist) to tackle challenging, open-ended research, with a human researcher providing high-level feedback. We will experience an emerging paradigm of research around how humans work together with AI agents.'}, {'url': 'https://www.forbes.com/sites/lutzfinger/2025/01/05/ai-agents-in-2025-what-enterprise-leaders-need-to-know/', 'content': 'AI Agents In 2025: What Enterprise Leaders Need To Know AI Agents In 2025: What Enterprise Leaders Need To Know AI Agents for the Enterprise will be the focus of 2025 To see what AI agents can do in 2025, let’s consider a simple example: an email-answering tool. Let’s improve our tool by building AI agents within a workflow. The Workflow of AI Agents: More Than Generative AI AI models can be connected or "chained" to build workflows where the output of one model becomes the input for the next. AI Agent Workflows: Input - Orchestration - Control - Actions - Synthesizing 2025 - AI Agents for the Enterprise Follow me here on Forbes or on LinkedIn for more of my 2025 AI predictions.'}, {'url': 'https://www.godofprompt.ai/blog/ai-agents-you-cant-miss', 'content': 'Explore 10+ AI agents that are reshaping industries in 2025. From ChatGPT to DeepSeek-R1, discover how AI is becoming more intelligent, efficient, and essential for businesses and individuals alike.'}][0m[32;1m[1;3mHere are some relevant news articles about AI Agents in 2025:</span><br><span class="line">​    </span><br><span class="line">​    1. [According to leading experts from Stanford Institute for Human-Centered AI, one major trend is the rise of collaborative AI systems where multiple specialized agents work together, with humans providing high-level guidance.](https://hai.stanford.edu/news/predictions-ai-2025-collaborative-agents-ai-skepticism-and-new-risks)</span><br><span class="line">​    </span><br><span class="line">    2. [AI Agents In 2025: What Enterprise Leaders Need To Know](https://www.forbes.com/sites/lutzfinger/2025/01/05/ai-agents-in-2025-what-enterprise-leaders-need-to-know/) - This article discusses AI Agents for the Enterprise, focusing on AI models being connected or "chained" to build workflows where the output of one model becomes the input for the next. It also mentions AI Agent Workflows: Input - Orchestration - Control - Actions - Synthesizing.</span><br><span class="line">    </span><br><span class="line">    3. [Explore 10+ AI agents that are reshaping industries in 2025. From ChatGPT to DeepSeek-R1, discover how AI is becoming more intelligent, efficient, and essential for businesses and individuals alike.](https://www.godofprompt.ai/blog/ai-agents-you-cant-miss)</span><br><span class="line">    </span><br><span class="line">    These articles provide insights into the future of AI Agents, including their collaborative nature, their potential impact on enterprises, and the development of AI Agent Workflows.[0m</span><br><span class="line">    </span><br><span class="line">    [1m&gt; Finished chain.[0m</span><br><span class="line">    Agent execution result:</span><br><span class="line">    Here are some relevant news articles about AI Agents in 2025:</span><br><span class="line">    </span><br><span class="line">    1. [According to leading experts from Stanford Institute for Human-Centered AI, one major trend is the rise of collaborative AI systems where multiple specialized agents work together, with humans providing high-level guidance.](https://hai.stanford.edu/news/predictions-ai-2025-collaborative-agents-ai-skepticism-and-new-risks)</span><br><span class="line">    </span><br><span class="line">    2. [AI Agents In 2025: What Enterprise Leaders Need To Know](https://www.forbes.com/sites/lutzfinger/2025/01/05/ai-agents-in-2025-what-enterprise-leaders-need-to-know/) - This article discusses AI Agents for the Enterprise, focusing on AI models being connected or "chained" to build workflows where the output of one model becomes the input for the next. It also mentions AI Agent Workflows: Input - Orchestration - Control - Actions - Synthesizing.</span><br><span class="line">    </span><br><span class="line">    3. [Explore 10+ AI agents that are reshaping industries in 2025. From ChatGPT to DeepSeek-R1, discover how AI is becoming more intelligent, efficient, and essential for businesses and individuals alike.](https://www.godofprompt.ai/blog/ai-agents-you-cant-miss)</span><br><span class="line">    </span><br><span class="line">    These articles provide insights into the future of AI Agents, including their collaborative nature, their potential impact on enterprises, and the development of AI Agent Workflows.</span><br></pre></td></tr></table></figure></div>

<h2 id="使用-Stream-输出检查逐步结果"><a href="#使用-Stream-输出检查逐步结果" class="headerlink" title="使用 Stream 输出检查逐步结果"></a>使用 Stream 输出检查逐步结果</h2><p>我们将使用 <code>AgentExecutor</code> 的 <code>stream()</code> 方法来流式传输代理的中间步骤。</p>
<p><code>stream()</code> 的输出在 (Action, Observation) 对之间交替，最终如果目标达成，将以代理的答案结束。</p>
<p>流程如下所示：</p>
<ol>
<li>Action 输出</li>
<li>Observation 输出</li>
<li>Action 输出</li>
<li>Observation 输出</li>
</ol>
<p>…（继续直到目标达成）…</p>
<p>然后，代理将在目标达成后得出最终答案。</p>
<p>以下表格总结了你将在输出中遇到的内容：</p>
<table>
<thead>
<tr>
<th>输出</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>Action</td>
<td><code>actions</code>：表示 <code>AgentAction</code> 或其子类。<br><code>messages</code>：与动作调用对应的聊天消息。</td>
</tr>
<tr>
<td>Observation</td>
<td><code>steps</code>：记录代理的工作，包括当前的动作和其观察结果。<br><code>messages</code>：包含函数调用结果（即观察结果）的聊天消息。</td>
</tr>
<tr>
<td>Final Answer</td>
<td><code>output</code>：表示 <code>AgentFinish</code> 信号。<br><code>messages</code>：包含最终输出的聊天消息。</td>
</tr>
</tbody></table>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.agents <span class="keyword">import</span> AgentExecutor</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create AgentExecutor</span></span><br><span class="line">agent_executor = AgentExecutor(</span><br><span class="line">    agent=agent,</span><br><span class="line">    tools=tools,</span><br><span class="line">    verbose=<span class="literal">False</span>,</span><br><span class="line">    handle_parsing_errors=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Run in streaming mode</span></span><br><span class="line">result = agent_executor.stream({<span class="string">"input"</span>: <span class="string">"Search news about AI Agent in 2025."</span>})</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> step <span class="keyword">in</span> result:</span><br><span class="line">    <span class="comment"># Print intermediate steps</span></span><br><span class="line">    <span class="built_in">print</span>(step)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"==="</span> * <span class="number">20</span>)</span><br></pre></td></tr></table></figure></div>

<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">{'actions': [ToolAgentAction(tool='search_news', tool_input={'query': 'AI Agent 2025'}, log="\nInvoking: `search_news` with `{'query': 'AI Agent 2025'}`\n\n\n", message_log=[AIMessageChunk(content='', additional_kwargs={'tool_calls': [{'index': 0, 'id': 'chatcmpl-tool-cf8525019f5847519566061e0e6647c6', 'function': {'arguments': '{"query": "AI Agent 2025"}', 'name': 'search_news'}, 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'model_name': 'Qwen2.5-3B-Instruct'}, id='run-a877dfea-5a20-4970-96da-0f3483298f7e', tool_calls=[{'name': 'search_news', 'args': {'query': 'AI Agent 2025'}, 'id': 'chatcmpl-tool-cf8525019f5847519566061e0e6647c6', 'type': 'tool_call'}], tool_call_chunks=[{'name': 'search_news', 'args': '{"query": "AI Agent 2025"}', 'id': 'chatcmpl-tool-cf8525019f5847519566061e0e6647c6', 'index': 0, 'type': 'tool_call_chunk'}])], tool_call_id='chatcmpl-tool-cf8525019f5847519566061e0e6647c6')], 'messages': [AIMessageChunk(content='', additional_kwargs={'tool_calls': [{'index': 0, 'id': 'chatcmpl-tool-cf8525019f5847519566061e0e6647c6', 'function': {'arguments': '{"query": "AI Agent 2025"}', 'name': 'search_news'}, 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'model_name': 'Qwen2.5-3B-Instruct'}, id='run-a877dfea-5a20-4970-96da-0f3483298f7e', tool_calls=[{'name': 'search_news', 'args': {'query': 'AI Agent 2025'}, 'id': 'chatcmpl-tool-cf8525019f5847519566061e0e6647c6', 'type': 'tool_call'}], tool_call_chunks=[{'name': 'search_news', 'args': '{"query": "AI Agent 2025"}', 'id': 'chatcmpl-tool-cf8525019f5847519566061e0e6647c6', 'index': 0, 'type': 'tool_call_chunk'}])]}</span><br><span class="line">============================================================</span><br><span class="line">{'steps': [AgentStep(action=ToolAgentAction(tool='search_news', tool_input={'query': 'AI Agent 2025'}, log="\nInvoking: `search_news` with `{'query': 'AI Agent 2025'}`\n\n\n", message_log=[AIMessageChunk(content='', additional_kwargs={'tool_calls': [{'index': 0, 'id': 'chatcmpl-tool-cf8525019f5847519566061e0e6647c6', 'function': {'arguments': '{"query": "AI Agent 2025"}', 'name': 'search_news'}, 'type': 'function'}]}, response_metadata={'finish_reason': 'tool_calls', 'model_name': 'Qwen2.5-3B-Instruct'}, id='run-a877dfea-5a20-4970-96da-0f3483298f7e', tool_calls=[{'name': 'search_news', 'args': {'query': 'AI Agent 2025'}, 'id': 'chatcmpl-tool-cf8525019f5847519566061e0e6647c6', 'type': 'tool_call'}], tool_call_chunks=[{'name': 'search_news', 'args': '{"query": "AI Agent 2025"}', 'id': 'chatcmpl-tool-cf8525019f5847519566061e0e6647c6', 'index': 0, 'type': 'tool_call_chunk'}])], tool_call_id='chatcmpl-tool-cf8525019f5847519566061e0e6647c6'), observation=[{'url': 'https://hai.stanford.edu/news/predictions-ai-2025-collaborative-agents-ai-skepticism-and-new-risks', 'content': 'According to leading experts from Stanford Institute for Human-Centered AI, one major trend is the rise of collaborative AI systems where multiple specialized agents work together, with humans providing high-level guidance. I expect to see more focus on multimodal AI models in education, including in processing speech and images. AI Agents Work Together In 2025, we will see a significant shift from relying on individual AI models to using systems where multiple AI agents of diverse expertise work together. As an example, we recently introduced the\xa0Virtual Lab, where a professor AI agent leads a team of AI scientist agents (e.g., AI chemist, AI biologist) to tackle challenging, open-ended research, with a human researcher providing high-level feedback. We will experience an emerging paradigm of research around how humans work together with AI agents.'}, {'url': 'https://www.forbes.com/sites/lutzfinger/2025/01/05/ai-agents-in-2025-what-enterprise-leaders-need-to-know/', 'content': 'AI Agents In 2025: What Enterprise Leaders Need To Know AI Agents In 2025: What Enterprise Leaders Need To Know AI Agents for the Enterprise will be the focus of 2025 To see what AI agents can do in 2025, let’s consider a simple example: an email-answering tool. Let’s improve our tool by building AI agents within a workflow. The Workflow of AI Agents: More Than Generative AI AI models can be connected or "chained" to build workflows where the output of one model becomes the input for the next. AI Agent Workflows: Input - Orchestration - Control - Actions - Synthesizing 2025 - AI Agents for the Enterprise Follow me here on Forbes or on LinkedIn for more of my 2025 AI predictions.'}, {'url': 'https://www.godofprompt.ai/blog/ai-agents-you-cant-miss', 'content': 'Explore 10+ AI agents that are reshaping industries in 2025. From ChatGPT to DeepSeek-R1, discover how AI is becoming more intelligent, efficient, and essential for businesses and individuals alike.'}])], 'messages': [FunctionMessage(content='[{"url": "https://hai.stanford.edu/news/predictions-ai-2025-collaborative-agents-ai-skepticism-and-new-risks", "content": "According to leading experts from Stanford Institute for Human-Centered AI, one major trend is the rise of collaborative AI systems where multiple specialized agents work together, with humans providing high-level guidance. I expect to see more focus on multimodal AI models in education, including in processing speech and images. AI Agents Work Together In 2025, we will see a significant shift from relying on individual AI models to using systems where multiple AI agents of diverse expertise work together. As an example, we recently introduced the\xa0Virtual Lab, where a professor AI agent leads a team of AI scientist agents (e.g., AI chemist, AI biologist) to tackle challenging, open-ended research, with a human researcher providing high-level feedback. We will experience an emerging paradigm of research around how humans work together with AI agents."}, {"url": "https://www.forbes.com/sites/lutzfinger/2025/01/05/ai-agents-in-2025-what-enterprise-leaders-need-to-know/", "content": "AI Agents In 2025: What Enterprise Leaders Need To Know AI Agents In 2025: What Enterprise Leaders Need To Know AI Agents for the Enterprise will be the focus of 2025 To see what AI agents can do in 2025, let’s consider a simple example: an email-answering tool. Let’s improve our tool by building AI agents within a workflow. The Workflow of AI Agents: More Than Generative AI AI models can be connected or \\"chained\\" to build workflows where the output of one model becomes the input for the next. AI Agent Workflows: Input - Orchestration - Control - Actions - Synthesizing 2025 - AI Agents for the Enterprise Follow me here on Forbes or on LinkedIn for more of my 2025 AI predictions."}, {"url": "https://www.godofprompt.ai/blog/ai-agents-you-cant-miss", "content": "Explore 10+ AI agents that are reshaping industries in 2025. From ChatGPT to DeepSeek-R1, discover how AI is becoming more intelligent, efficient, and essential for businesses and individuals alike."}]', additional_kwargs={}, response_metadata={}, name='search_news')]}</span><br><span class="line">============================================================</span><br><span class="line">{'output': 'Here are some relevant news articles about AI Agents in 2025:\n\n1. [According to leading experts from Stanford Institute for Human-Centered AI, one major trend is the rise of collaborative AI systems where multiple specialized agents work together, with humans providing high-level guidance.](https://hai.stanford.edu/news/predictions-ai-2025-collaborative-agents-ai-skepticism-and-new-risks)\n\n2. [AI Agents In 2025: What Enterprise Leaders Need To Know](https://www.forbes.com/sites/lutzfinger/2025/01/05/ai-agents-in-2025-what-enterprise-leaders-need-to-know/) - This article discusses AI Agents for the Enterprise, focusing on how AI models can be connected or "chained" to build workflows where the output of one model becomes the input for the next.\n\n3. [Explore 10+ AI agents that are reshaping industries in 2025. From ChatGPT to DeepSeek-R1, discover how AI is becoming more intelligent, efficient, and essential for businesses and individuals alike.](https://www.godofprompt.ai/blog/ai-agents-you-cant-miss)\n\nThese articles provide insights into the expected trends and developments in AI Agents for both research and enterprise applications in the year 2025.', 'messages': [AIMessage(content='Here are some relevant news articles about AI Agents in 2025:\n\n1. [According to leading experts from Stanford Institute for Human-Centered AI, one major trend is the rise of collaborative AI systems where multiple specialized agents work together, with humans providing high-level guidance.](https://hai.stanford.edu/news/predictions-ai-2025-collaborative-agents-ai-skepticism-and-new-risks)\n\n2. [AI Agents In 2025: What Enterprise Leaders Need To Know](https://www.forbes.com/sites/lutzfinger/2025/01/05/ai-agents-in-2025-what-enterprise-leaders-need-to-know/) - This article discusses AI Agents for the Enterprise, focusing on how AI models can be connected or "chained" to build workflows where the output of one model becomes the input for the next.\n\n3. [Explore 10+ AI agents that are reshaping industries in 2025. From ChatGPT to DeepSeek-R1, discover how AI is becoming more intelligent, efficient, and essential for businesses and individuals alike.](https://www.godofprompt.ai/blog/ai-agents-you-cant-miss)\n\nThese articles provide insights into the expected trends and developments in AI Agents for both research and enterprise applications in the year 2025.', additional_kwargs={}, response_metadata={})]}</span><br><span class="line">============================================================</span><br></pre></td></tr></table></figure></div>

<h2 id="使用用户定义的函数自定义中间步骤输出"><a href="#使用用户定义的函数自定义中间步骤输出" class="headerlink" title="使用用户定义的函数自定义中间步骤输出"></a>使用用户定义的函数自定义中间步骤输出</h2><p>你可以定义以下 3 个函数来自定义中间步骤的输出：</p>
<ul>
<li><code>tool_callback</code>：此函数处理工具调用生成的输出。</li>
<li><code>observation_callback</code>：此函数处理观察数据输出。</li>
<li><code>result_callback</code>：此函数允许你处理最终答案的输出。</li>
</ul>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span>, <span class="type">Any</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create AgentStreamParser class</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AgentStreamParser</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">tool_callback</span>(<span class="params">self, tool: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"\n=== Tool Called ==="</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"Tool: <span class="subst">{tool.get(<span class="string">'tool'</span>)}</span>"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"Input: <span class="subst">{tool.get(<span class="string">'tool_input'</span>)}</span>"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"==================\n"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">observation_callback</span>(<span class="params">self, step: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"\n=== Observation ==="</span>)</span><br><span class="line">        observation_data = step[<span class="string">"steps"</span>][<span class="number">0</span>].observation</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"Observation: <span class="subst">{observation_data}</span>"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"===================\n"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">result_callback</span>(<span class="params">self, result: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"\n=== Final Answer ==="</span>)</span><br><span class="line">        <span class="built_in">print</span>(result)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"====================\n"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_agent_steps</span>(<span class="params">self, step: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"actions"</span> <span class="keyword">in</span> step:</span><br><span class="line">            <span class="keyword">for</span> action <span class="keyword">in</span> step[<span class="string">"actions"</span>]:</span><br><span class="line">                <span class="variable language_">self</span>.tool_callback(</span><br><span class="line">                    {<span class="string">"tool"</span>: action.tool, <span class="string">"tool_input"</span>: action.tool_input}</span><br><span class="line">                )</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">"output"</span> <span class="keyword">in</span> step:</span><br><span class="line">            <span class="variable language_">self</span>.result_callback(step[<span class="string">"output"</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.observation_callback(step)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create AgentStreamParser instance</span></span><br><span class="line">agent_stream_parser = AgentStreamParser()</span><br></pre></td></tr></table></figure></div>


<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Run in streaming mode</span></span><br><span class="line">result = agent_executor.stream({<span class="string">"input"</span>: <span class="string">"Generate a array from 0 to 1 with the stride of 0.1 using numpy."</span>})</span><br><span class="line"><span class="comment"># result = agent_executor.stream({"input": "Search news about AI Agent in 2025."})</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> step <span class="keyword">in</span> result:</span><br><span class="line">    agent_stream_parser.process_agent_steps(step)</span><br></pre></td></tr></table></figure></div>


<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">    === Tool Called ===</span><br><span class="line">    Tool: numpy_array_generator</span><br><span class="line">    Input: {'start': 1, 'step': 0.1}</span><br><span class="line">    ==================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line">​    === Observation ===</span><br><span class="line">​    Observation: numpy_array_generator is not a valid tool, try one of [search_news, python_repl_tool].</span><br><span class="line">​    ===================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line">​    === Tool Called ===</span><br><span class="line">​    Tool: python_repl_tool</span><br><span class="line">​    Input: {'code': 'import numpy as np\nnp.arange(0, 1, 0.1)'}</span><br><span class="line">​    ==================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line">​    === Observation ===</span><br><span class="line">​    Observation: </span><br><span class="line">​    ===================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line">​    === Tool Called ===</span><br><span class="line">​    Tool: python_repl_tool</span><br><span class="line">​    Input: {'code': 'import numpy as np\nnp.arange(0, 1, 0.1)'}</span><br><span class="line">​    ==================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line">​    === Observation ===</span><br><span class="line">​    Observation: </span><br><span class="line">​    ===================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line">​    === Tool Called ===</span><br><span class="line">​    Tool: python_repl_tool</span><br><span class="line">​    Input: {'code': 'import numpy as np\nnp.arange(0, 1, 0.1)'}</span><br><span class="line">​    ==================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line">​    === Observation ===</span><br><span class="line">​    Observation: </span><br><span class="line">​    ===================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line">​    === Final Answer ===</span><br><span class="line">​    The numpy array from 0 to 1 with a stride of 0.1 has been successfully generated. Here it is:</span><br><span class="line">​    </span><br><span class="line">​    ```</span><br><span class="line">​    array([0. , 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9])</span><br><span class="line">​    ```</span><br><span class="line">​    </span><br><span class="line">    Is there anything else I can assist you with?</span><br><span class="line">    ====================</span><br></pre></td></tr></table></figure></div>


<h2 id="与之前的对话历史进行代理通信"><a href="#与之前的对话历史进行代理通信" class="headerlink" title="与之前的对话历史进行代理通信"></a>与之前的对话历史进行代理通信</h2><p>为了记住过去的对话，你可以将 <code>AgentExecutor</code> 包装在 <code>RunnableWithMessageHistory</code> 中。</p>
<p>有关 <code>RunnableWithMessageHistory</code> 的更多细节，请参阅以下链接。</p>
<p><strong>参考</strong></p>
<ul>
<li><a class="link" target="_blank" rel="noopener" href="https://python.langchain.com/api_reference/core/runnables/langchain_core.runnables.history.RunnableWithMessageHistory.html">LangChain Python API Reference &gt; langchain: 0.3.14 &gt; core &gt; runnables &gt; langchain_core.runnables.history &gt; RunnableWithMessageHistory<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></li>
</ul>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.chat_message_histories <span class="keyword">import</span> ChatMessageHistory</span><br><span class="line"><span class="keyword">from</span> langchain_core.runnables.history <span class="keyword">import</span> RunnableWithMessageHistory</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a dictionary to store session_id</span></span><br><span class="line">store = {}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Function to get session history based on session_id</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_session_history</span>(<span class="params">session_ids</span>):</span><br><span class="line">    <span class="keyword">if</span> session_ids <span class="keyword">not</span> <span class="keyword">in</span> store:  <span class="comment"># If session_id is not in store</span></span><br><span class="line">        <span class="comment"># Create a new ChatMessageHistory object and store it in store</span></span><br><span class="line">        store[session_ids] = ChatMessageHistory()</span><br><span class="line">    <span class="keyword">return</span> store[session_ids]  <span class="comment"># Return session history for the corresponding session_id</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create an agent with chat message history</span></span><br><span class="line">agent_with_chat_history = RunnableWithMessageHistory(</span><br><span class="line">    agent_executor,</span><br><span class="line">    <span class="comment"># Chat session_id</span></span><br><span class="line">    get_session_history,</span><br><span class="line">    <span class="comment"># The key for the question input in the prompt: "input"</span></span><br><span class="line">    input_messages_key=<span class="string">"input"</span>,</span><br><span class="line">    <span class="comment"># The key for the message input in the prompt: "chat_history"</span></span><br><span class="line">    history_messages_key=<span class="string">"chat_history"</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>


<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Request streaming output for the query</span></span><br><span class="line">response = agent_with_chat_history.stream(</span><br><span class="line">    {<span class="string">"input"</span>: <span class="string">"Hello! My name is Teddy!"</span>},</span><br><span class="line">    <span class="comment"># Set session_id</span></span><br><span class="line">    config={<span class="string">"configurable"</span>: {<span class="string">"session_id"</span>: <span class="string">"abc123"</span>}},</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check the output</span></span><br><span class="line"><span class="keyword">for</span> step <span class="keyword">in</span> response:</span><br><span class="line">    agent_stream_parser.process_agent_steps(step)</span><br></pre></td></tr></table></figure></div>

<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">=== Final Answer ===</span><br><span class="line">Hello Teddy! It's nice to meet you. How can I assist you today? Do you have any specific questions or topics you'd like to explore?</span><br><span class="line">====================</span><br></pre></td></tr></table></figure></div>



<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Request streaming output for the query</span></span><br><span class="line">response = agent_with_chat_history.stream(</span><br><span class="line">    {<span class="string">"input"</span>: <span class="string">"What is my name?"</span>},</span><br><span class="line">    <span class="comment"># Set session_id</span></span><br><span class="line">    config={<span class="string">"configurable"</span>: {<span class="string">"session_id"</span>: <span class="string">"abc123"</span>}},</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check the output</span></span><br><span class="line"><span class="keyword">for</span> step <span class="keyword">in</span> response:</span><br><span class="line">    agent_stream_parser.process_agent_steps(step)</span><br></pre></td></tr></table></figure></div>

<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">=== Final Answer ===</span><br><span class="line">It seems like you've already provided your name as Teddy. If you have any other questions or need information about something else, feel free to ask!</span><br><span class="line">====================</span><br></pre></td></tr></table></figure></div>



<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Request streaming output for the query</span></span><br><span class="line">response = agent_with_chat_history.stream(</span><br><span class="line">    {</span><br><span class="line">        <span class="string">"input"</span>: <span class="string">"My email address is teddy@teddynote.com. The company name is TeddyNote Co., Ltd."</span></span><br><span class="line">    },</span><br><span class="line">    <span class="comment"># Set session_id</span></span><br><span class="line">    config={<span class="string">"configurable"</span>: {<span class="string">"session_id"</span>: <span class="string">"abc123"</span>}},</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check the output</span></span><br><span class="line"><span class="keyword">for</span> step <span class="keyword">in</span> response:</span><br><span class="line">    agent_stream_parser.process_agent_steps(step)</span><br></pre></td></tr></table></figure></div>

<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">    === Tool Called ===</span><br><span class="line">    Tool: search_news</span><br><span class="line">    Input: {'query': 'TeddyNote Co., Ltd.'}</span><br><span class="line">    ==================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line">​    === Observation ===</span><br><span class="line">​    Observation: [{'url': 'https://www.youtube.com/@teddynote', 'content': '데이터 분석, 머신러닝, 딥러닝, LLM 에 대한 내용을 다룹니다. 연구보다는 개발에 관심이 많습니다 🙇\u200d♂️🔥 "테디노트의 RAG 비법노트" 랭체인'}, {'url': 'https://github.com/teddynote', 'content': 'By company size. Enterprises Small and medium teams Startups Nonprofits By use case. DevSecOps DevOps CI/CD View all use cases By industry ... teddynote.github.io teddynote.github.io Public. Forked from mmistakes/minimal-mistakes. 📐 Jekyll theme for building a personal site, blog, project documentation, or portfolio.'}, {'url': 'https://github.com/teddylee777', 'content': 'Jupyter Notebook\n1\n4\nConv2d and MaxPool2d Calculator for PyTorch\nPython\n18\n1\nStreamlit 튜토리얼 😁\nJupyter Notebook\n13\n12\n주가 종목 패턴 발굴기\nJupyter Notebook\n14\n12\n586\ncontributions\nin the last year\nContribution activity\nJanuary 2024\nSeeing something unexpected? Teddy Lee\nteddylee777\nAchievements\nAchievements\nHighlights\nBlock or report teddylee777\nPrevent this user from interacting with your repositories and sending you notifications.\n Jupyter Notebook\n58\n16\nForked from lovedlim/tensorflow\n텐서플로 도서 예제 파일입니다.\n Samsung Electronics\n테디노트 Blog\n테디노트 YouTube\n@teddynote\nLinkedIn\n💻 (This repository is intented for helping whom are interested in machine learning study)\nJupyter Notebook\n2.3k\n789\n머신러닝/딥러닝(PyTorch, TensorFlow) 전용 도커입니다.'}]</span><br><span class="line">​    ===================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line">​    === Final Answer ===</span><br><span class="line">​    Here are some recent news and information related to your company, TeddyNote Co., Ltd.:</span><br><span class="line">​    </span><br><span class="line">​    1. **TeddyNote Co., Ltd. on YouTube**: They have a YouTube channel where they discuss topics related to data analysis, machine learning, deep learning, and Large Language Models (LLM). They seem to have a focus on development rather than research. You can check out their channel [here](https://www.youtube.com/@teddynote).</span><br><span class="line">​    </span><br><span class="line">    2. **TeddyNote Co., Ltd. on GitHub**: </span><br><span class="line">       - **Company Size**: They cater to small and medium-sized teams, startups, and nonprofits.</span><br><span class="line">       - **Use Cases**: They support DevSecOps and DevOps, CI/CD.</span><br><span class="line">       - **Public Repository**: You can view their public repository [here](https://github.com/teddynote).</span><br><span class="line">       - **Personal Site**: They have a personal site and blog available at [teddynote.github.io](https://teddynote.github.io/).</span><br><span class="line">       - **Contributions**: They have contributed to various projects, including a Jupyter Notebook for a Conv2d and MaxPool2d Calculator for PyTorch, a Streamlit tutorial, and a stock price pattern analysis tool. You can see their contributions [here](https://github.com/teddylee777).</span><br><span class="line">    </span><br><span class="line">    3. **TeddyLee777 on GitHub**: This is likely a personal GitHub account associated with TeddyNote Co., Ltd. They have contributed to various projects, including a TensorFlow book example repository and a Docker image for machine learning study.</span><br><span class="line">    </span><br><span class="line">    If you need more detailed information or have any specific questions about these resources, feel free to ask!</span><br><span class="line">    ====================</span><br></pre></td></tr></table></figure></div>



<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Request streaming output for the query</span></span><br><span class="line">response = agent_with_chat_history.stream(</span><br><span class="line">    {</span><br><span class="line">        <span class="string">"input"</span>: <span class="string">"Search the latest news and write it as the body of the email. "</span></span><br><span class="line">        <span class="string">"The recipient is `Ms. Sally` and the sender is my personal information."</span></span><br><span class="line">        <span class="string">"Write in a polite tone, and include appropriate greetings and closings at the beginning and end of the email."</span></span><br><span class="line">    },</span><br><span class="line">    <span class="comment"># Set session_id</span></span><br><span class="line">    config={<span class="string">"configurable"</span>: {<span class="string">"session_id"</span>: <span class="string">"abc123"</span>}},</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check the output</span></span><br><span class="line"><span class="keyword">for</span> step <span class="keyword">in</span> response:</span><br><span class="line">    agent_stream_parser.process_agent_steps(step)</span><br></pre></td></tr></table></figure></div>

<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">    === Tool Called ===</span><br><span class="line">    Tool: search_news</span><br><span class="line">    Input: {'query': 'TeddyNote Co., Ltd latest news'}</span><br><span class="line">    ==================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line">​    === Tool Called ===</span><br><span class="line">​    Tool: python_repl_tool</span><br><span class="line">​    Input: {'code': 'import email; from email.mime.multipart import MIMEMultipart; from email.mime.text import MIMEText; msg = MIMEMultipart(); msg[\'From\'] = \'teddy@teddynote.com\'; msg[\'To\'] = \'sally@example.com\'; msg[\'Subject\'] = \'Latest News from TeddyNote Co., Ltd\'; body = """Here are the latest news and updates from TeddyNote Co., Ltd.:\n\n1. **TeddyNote Co., Ltd. on YouTube**: They have a YouTube channel where they discuss topics related to data analysis, machine learning, deep learning, and Large Language Models (LLM). They seem to have a focus on development rather than research. You can check out their channel [here](https://www.youtube.com/@teddynote).\n\n2. **TeddyNote Co., Ltd. on GitHub**: \n   - **Company Size**: They cater to small and medium-sized teams, startups, and nonprofits.\n   - **Use Cases**: They support DevSecOps and DevOps, CI/CD.\n   - **Public Repository**: You can view their public repository [here](https://github.com/teddynote).\n   - **Personal Site**: They have a personal site and blog available at [teddynote.github.io](https://teddynote.github.io/).\n   - **Contributions**: They have contributed to various projects, including a Jupyter Notebook for a Conv2d and MaxPool2d Calculator for PyTorch, a Streamlit tutorial, and a stock price pattern analysis tool. You can see their contributions [here](https://github.com/teddylee777).\n\n3. **TeddyLee777 on GitHub**: This is likely a personal GitHub account associated with TeddyNote Co., Ltd. They have contributed to various projects, including a TensorFlow book example repository and a Docker image for machine learning study.\n\nIf you need more detailed information or have any specific questions about these resources, feel free to ask!"""; msg.attach(MIMEText(body, \'plain\')); return msg.as_string()'}</span><br><span class="line">​    ==================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line">​    === Tool Called ===</span><br><span class="line">​    Tool: send_email</span><br><span class="line">​    Input: {'to': 'sally@example.com', 'subject': 'Latest News from TeddyNote Co., Ltd', 'body': '...', 'sender': 'teddy@teddynote.com'}</span><br><span class="line">​    ==================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line">​    === Tool Called ===</span><br><span class="line">​    Tool: email_status</span><br><span class="line">​    Input: {'email_id': '...'}</span><br><span class="line">​    ==================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line">​    === Observation ===</span><br><span class="line">​    Observation: [{'url': 'https://www.threads.net/@teddynote', 'content': '60 Followers • 44 Threads • 데이터 &amp; AI. See the latest conversations with @teddynote.'}, {'url': 'https://github.com/teddylee777', 'content': 'Jupyter Notebook\n1\n4\nConv2d and MaxPool2d Calculator for PyTorch\nPython\n18\n1\nStreamlit 튜토리얼 😁\nJupyter Notebook\n13\n12\n주가 종목 패턴 발굴기\nJupyter Notebook\n14\n12\n586\ncontributions\nin the last year\nContribution activity\nJanuary 2024\nSeeing something unexpected? Teddy Lee\nteddylee777\nAchievements\nAchievements\nHighlights\nBlock or report teddylee777\nPrevent this user from interacting with your repositories and sending you notifications.\n Jupyter Notebook\n58\n16\nForked from lovedlim/tensorflow\n텐서플로 도서 예제 파일입니다.\n Samsung Electronics\n테디노트 Blog\n테디노트 YouTube\n@teddynote\nLinkedIn\n💻 (This repository is intented for helping whom are interested in machine learning study)\nJupyter Notebook\n2.3k\n789\n머신러닝/딥러닝(PyTorch, TensorFlow) 전용 도커입니다.'}, {'url': 'https://langchain-opentutorial.gitbook.io/langchain-opentutorial/15-agent/03-agent', 'content': 'Best regards, Teddy teddy@teddynote.com TeddyNote Co., Ltd. --- Feel free to modify any part of the email as you see fit! &gt;&gt;&gt;&gt;&gt;'}]</span><br><span class="line">​    ===================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line">​    === Observation ===</span><br><span class="line">​    Observation: SyntaxError("'return' outside function", ('&lt;string&gt;', 14, 152, None, 14, 174))</span><br><span class="line">​    ===================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line">​    === Observation ===</span><br><span class="line">​    Observation: send_email is not a valid tool, try one of [search_news, python_repl_tool].</span><br><span class="line">​    ===================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line">​    === Observation ===</span><br><span class="line">​    Observation: email_status is not a valid tool, try one of [search_news, python_repl_tool].</span><br><span class="line">​    ===================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line">​    === Final Answer ===</span><br><span class="line">​    It seems there was an issue with the previous steps. Let's proceed with creating the email body using the news and information we gathered. Here is the body of the email:</span><br><span class="line">​    </span><br><span class="line">​    ---</span><br><span class="line">​    </span><br><span class="line">    Hello Ms. Sally,</span><br><span class="line">    </span><br><span class="line">    I hope this email finds you well. I wanted to share some recent news and updates from TeddyNote Co., Ltd.:</span><br><span class="line">    </span><br><span class="line">    1. **TeddyNote Co., Ltd. on YouTube**: They have a YouTube channel where they discuss topics related to data analysis, machine learning, deep learning, and Large Language Models (LLM). They seem to have a focus on development rather than research. You can check out their channel [here](https://www.youtube.com/@teddynote).</span><br><span class="line">    </span><br><span class="line">    2. **TeddyNote Co., Ltd. on GitHub**:</span><br><span class="line">       - **Company Size**: They cater to small and medium-sized teams, startups, and nonprofits.</span><br><span class="line">       - **Use Cases**: They support DevSecOps and DevOps, CI/CD.</span><br><span class="line">       - **Public Repository**: You can view their public repository [here](https://github.com/teddynote).</span><br><span class="line">       - **Personal Site**: They have a personal site and blog available at [teddynote.github.io](https://teddynote.github.io/).</span><br><span class="line">       - **Contributions**: They have contributed to various projects, including a Jupyter Notebook for a Conv2d and MaxPool2d Calculator for PyTorch, a Streamlit tutorial, and a stock price pattern analysis tool. You can see their contributions [here](https://github.com/teddylee777).</span><br><span class="line">    </span><br><span class="line">    3. **TeddyLee777 on GitHub**: This is likely a personal GitHub account associated with TeddyNote Co., Ltd. They have contributed to various projects, including a TensorFlow book example repository and a Docker image for machine learning study.</span><br><span class="line">    </span><br><span class="line">    If you need more detailed information or have any specific questions about these resources, feel free to ask!</span><br><span class="line">    </span><br><span class="line">    Best regards,</span><br><span class="line">    Teddy</span><br><span class="line">    teddy@teddynote.com</span><br><span class="line">    TeddyNote Co., Ltd.</span><br><span class="line">    </span><br><span class="line">    ---</span><br><span class="line">    </span><br><span class="line">    Please let me know if you need any further assistance or if there are any specific details you would like to include.</span><br><span class="line">    ====================</span><br></pre></td></tr></table></figure></div>


<h1 id="Agentic-RAG"><a href="#Agentic-RAG" class="headerlink" title="Agentic RAG"></a>Agentic RAG</h1><p><strong>Agentic RAG</strong> 扩展了传统的 RAG（检索增强生成）系统，通过结合基于代理的方法，实现更复杂的信息检索和响应生成。该系统不仅仅局限于简单的文档检索和响应生成，还允许代理利用各种工具进行更智能的信息处理。这些工具包括用于访问最新信息的 <code>Tavily Search</code>、执行 Python 代码的能力以及自定义功能实现，所有这些都集成在 <code>LangChain</code> 框架中，为信息处理和生成任务提供全面的解决方案。</p>
<p>本教程演示了如何构建一个文档检索系统，使用 <code>FAISS DB</code> 来有效地处理和搜索 PDF 文档。以软件政策研究所的 AI Brief 为示例文档，我们将探索如何将基于 Web 的文档加载器、文本拆分器、向量存储和 <code>OpenAI</code> 嵌入结合起来，创建一个实际的 <strong>Agentic RAG</strong> 系统。该实现展示了如何将 <code>Retriever</code> 工具与各种 <code>LangChain</code> 组件有效结合，创建一个强大的文档搜索和响应生成管道。</p>
<h2 id="创建工具-1"><a href="#创建工具-1" class="headerlink" title="创建工具"></a>创建工具</h2><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.tools.tavily_search <span class="keyword">import</span> TavilySearchResults</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a search tool instance that returns up to 6 results</span></span><br><span class="line">search = TavilySearchResults(k=<span class="number">6</span>)</span><br></pre></td></tr></table></figure></div>


<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_text_splitters <span class="keyword">import</span> RecursiveCharacterTextSplitter</span><br><span class="line"><span class="keyword">from</span> langchain_community.vectorstores <span class="keyword">import</span> FAISS</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> OpenAIEmbeddings</span><br><span class="line"><span class="keyword">from</span> langchain_community.embeddings <span class="keyword">import</span> DashScopeEmbeddings</span><br><span class="line"><span class="keyword">from</span> langchain.document_loaders <span class="keyword">import</span> PyPDFLoader</span><br><span class="line"><span class="keyword">from</span> langchain.tools.retriever <span class="keyword">import</span> create_retriever_tool</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load and process the PDF</span></span><br><span class="line">loader = PyPDFLoader(<span class="string">"data/What-is-AI.pdf"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create text splitter</span></span><br><span class="line">text_splitter = RecursiveCharacterTextSplitter(chunk_size=<span class="number">1000</span>, chunk_overlap=<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Split the document</span></span><br><span class="line">split_docs = loader.load_and_split(text_splitter)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create vector store</span></span><br><span class="line">embeddings = DashScopeEmbeddings(</span><br><span class="line">    model=<span class="string">"text-embedding-v2"</span>,</span><br><span class="line">)</span><br><span class="line">vector = FAISS.from_documents(split_docs, embeddings)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create retriever</span></span><br><span class="line">retriever = vector.as_retriever()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create retriever tool</span></span><br><span class="line">retriever_tool = create_retriever_tool(</span><br><span class="line">    retriever,</span><br><span class="line">    name=<span class="string">"pdf_search"</span>,</span><br><span class="line">    description=<span class="string">"use this tool to search information from the PDF document"</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>

<h2 id="创建代理-1"><a href="#创建代理-1" class="headerlink" title="创建代理"></a>创建代理</h2><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tools = [search, retriever_tool]</span><br></pre></td></tr></table></figure></div>


<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> ChatPromptTemplate</span><br><span class="line"><span class="keyword">from</span> langchain.agents <span class="keyword">import</span> create_tool_calling_agent, AgentExecutor</span><br><span class="line"></span><br><span class="line"><span class="comment"># Initialize LLM</span></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">	base_url=<span class="string">'http://localhost:5551/v1'</span>,</span><br><span class="line">	api_key=<span class="string">'EMPTY'</span>,</span><br><span class="line">	model_name=<span class="string">'Qwen2.5-3B-Instruct'</span>,</span><br><span class="line">	temperature=<span class="number">0.2</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define prompt template</span></span><br><span class="line">prompt = ChatPromptTemplate.from_messages(</span><br><span class="line">    [</span><br><span class="line">        (</span><br><span class="line">            <span class="string">"system"</span>,</span><br><span class="line">            <span class="string">"You are a helpful assistant. "</span></span><br><span class="line">            <span class="string">"Make sure to use the `pdf_search` tool for searching information from the PDF document. "</span></span><br><span class="line">            <span class="string">"If you can't find the information from the PDF document, use the `search` tool for searching information from the web."</span>,</span><br><span class="line">        ),</span><br><span class="line">        (<span class="string">"placeholder"</span>, <span class="string">"{chat_history}"</span>),</span><br><span class="line">        (<span class="string">"human"</span>, <span class="string">"{input}"</span>),</span><br><span class="line">        (<span class="string">"placeholder"</span>, <span class="string">"{agent_scratchpad}"</span>),</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create agent</span></span><br><span class="line">agent = create_tool_calling_agent(llm, tools, prompt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create agent executor</span></span><br><span class="line">agent_executor = AgentExecutor(agent=agent, tools=tools, verbose=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure></div>

<h2 id="对话历史"><a href="#对话历史" class="headerlink" title="对话历史"></a>对话历史</h2><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.chat_message_histories <span class="keyword">import</span> ChatMessageHistory</span><br><span class="line"><span class="keyword">from</span> langchain_core.runnables.history <span class="keyword">import</span> RunnableWithMessageHistory</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a store for session histories</span></span><br><span class="line">store = {}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_session_history</span>(<span class="params">session_ids</span>):</span><br><span class="line">    <span class="keyword">if</span> session_ids <span class="keyword">not</span> <span class="keyword">in</span> store:</span><br><span class="line">        store[session_ids] = ChatMessageHistory()</span><br><span class="line">    <span class="keyword">return</span> store[session_ids]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create agent with chat history</span></span><br><span class="line">agent_with_chat_history = RunnableWithMessageHistory(</span><br><span class="line">    agent_executor,</span><br><span class="line">    get_session_history,</span><br><span class="line">    input_messages_key=<span class="string">"input"</span>,</span><br><span class="line">    history_messages_key=<span class="string">"chat_history"</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>


<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">process_response</span>(<span class="params">response</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Process and display streaming response from the agent.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        response: Agent's streaming response iterator</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">for</span> chunk <span class="keyword">in</span> response:</span><br><span class="line">        <span class="keyword">if</span> chunk.get(<span class="string">"output"</span>):</span><br><span class="line">            <span class="built_in">print</span>(chunk[<span class="string">"output"</span>])</span><br><span class="line">        <span class="keyword">elif</span> chunk.get(<span class="string">"actions"</span>):</span><br><span class="line">            <span class="keyword">for</span> action <span class="keyword">in</span> chunk[<span class="string">"actions"</span>]:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f"\nTool Used: <span class="subst">{action.tool}</span>"</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f"Tool Input: <span class="subst">{action.tool_input}</span>"</span>)</span><br><span class="line">                <span class="keyword">if</span> action.log:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f"Tool Log: <span class="subst">{action.log}</span>"</span>)</span><br></pre></td></tr></table></figure></div>


<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example 1: Searching in PDF</span></span><br><span class="line">response = agent_with_chat_history.stream(</span><br><span class="line">    {</span><br><span class="line">        <span class="string">"input"</span>: <span class="string">"What information can you find about Samsung's AI model in the document?"</span></span><br><span class="line">    },</span><br><span class="line">    config={<span class="string">"configurable"</span>: {<span class="string">"session_id"</span>: <span class="string">"tutorial_session_1"</span>}},</span><br><span class="line">)</span><br><span class="line">process_response(response)</span><br></pre></td></tr></table></figure></div>

<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">    Tool Used: pdf_search</span><br><span class="line">    Tool Input: {'query': 'Samsung AI model'}</span><br><span class="line">    Tool Log: </span><br><span class="line">    Invoking: `pdf_search` with `{'query': 'Samsung AI model'}`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line">​    </span><br><span class="line">​    </span><br><span class="line">​    Tool Used: search</span><br><span class="line">​    Tool Input: {'query': 'Samsung AI model'}</span><br><span class="line">​    Tool Log: </span><br><span class="line">​    Invoking: `search` with `{'query': 'Samsung AI model'}`</span><br><span class="line">​    responded: The provided text does not contain specific information about Samsung's AI model. It seems to be a general introduction to AI, its components, and some real-world applications. To find information about Samsung's AI model, we might need to look for more detailed or specific documents or articles. Let me try searching the web for more relevant information.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line">​    </span><br><span class="line">​    </span><br><span class="line">​    Tool Used: tavily_search_results_json</span><br><span class="line">​    Tool Input: {'query': 'Samsung AI model'}</span><br><span class="line">​    Tool Log: </span><br><span class="line">​    Invoking: `tavily_search_results_json` with `{'query': 'Samsung AI model'}`</span><br><span class="line">​    responded: It appears that the 'search' tool is not available. Let's try using the 'tavily_search_results_json' tool to search the web for information about Samsung's AI model.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line">​    </span><br><span class="line">​    </span><br><span class="line">​    The search results provide information about Samsung's AI model, specifically Samsung Gauss 2, which is described as a new GenAI model that improves Galaxy AI performance and efficiency. Here are some key points from the search results:</span><br><span class="line">​    </span><br><span class="line">​    1. **Samsung Gauss 2**: This model supports 9 to 14 human languages and several programming languages. Samsung claims that Balanced and Supreme models match or beat other AI models on tasks.</span><br><span class="line">​    </span><br><span class="line">    2. **Galaxy S25 Series**: The Galaxy S25 series features advanced, efficient AI image processing with ProScaler11, achieving a 40% improvement in display image scaling quality. It also incorporates custom technology with Samsung’s mobile Digital Natural Image engine (mDNIe) embedded within the processor using Galaxy IP to enable greater display power efficiency.</span><br><span class="line">    </span><br><span class="line">    3. **Galaxy AI**: Samsung's Galaxy AI is described as a set of generative AI tools that brings features like live translation, generative photo editing, and more. The AI features are available on newer Samsung phones, but Samsung is making efforts to support these features on older models as well.</span><br><span class="line">    </span><br><span class="line">    4. **Samsung Gauss 2 on Device**: Samsung Gauss 2 is an on-device AI model, which means it processes data locally on the device rather than sending it to a cloud server.</span><br><span class="line">    </span><br><span class="line">    These results suggest that Samsung Gauss 2 is a significant advancement in their AI capabilities, particularly in improving Galaxy AI performance and efficiency. If you need more detailed information, you might want to look into the specific features and capabilities of Samsung Gauss 2 in more detail.</span><br></pre></td></tr></table></figure></div>


<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example 1: Searching in PDF</span></span><br><span class="line">response = agent_with_chat_history.stream(</span><br><span class="line">    {</span><br><span class="line">        <span class="string">"input"</span>: <span class="string">"List the devices using ai in your previous responese."</span></span><br><span class="line">    },</span><br><span class="line">    config={<span class="string">"configurable"</span>: {<span class="string">"session_id"</span>: <span class="string">"tutorial_session_1"</span>}},</span><br><span class="line">)</span><br><span class="line">process_response(response)</span><br></pre></td></tr></table></figure></div>

<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">    Tool Used: pdf_search</span><br><span class="line">    Tool Input: {'query': 'devices using ai'}</span><br><span class="line">    Tool Log: </span><br><span class="line">    Invoking: `pdf_search` with `{'query': 'devices using ai'}`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line">​    </span><br><span class="line">​    Based on the information provided in the document, the devices mentioned that use AI are:</span><br><span class="line">​    </span><br><span class="line">​    1. **Smartphones**: The document mentions that AI is available on newer Samsung phones, indicating that smartphones are one of the devices using AI.</span><br><span class="line">​    2. **Galaxy S25 Series**: The document describes the Galaxy S25 series as featuring advanced, efficient AI image processing, which implies that this device uses AI.</span><br><span class="line">​    3. **Galaxy AI**: The document states that Galaxy AI is a set of generative AI tools available on newer Samsung phones, suggesting that the Galaxy S25 series and possibly other newer Samsung devices use AI.</span><br><span class="line">​    4. **Smart City Initiative**: The document provides an example of a government initiative using AI for real-time video analytics, advanced forensic investigation capabilities, and comprehensive operational intelligence. While it doesn't specify which devices are used, it implies that AI is used across various devices in this context.</span><br><span class="line">​    </span><br><span class="line">    Therefore, the devices using AI mentioned in the document are:</span><br><span class="line">    - Smartphones (Samsung)</span><br><span class="line">    - Galaxy S25 Series</span><br><span class="line">    - Galaxy AI (presumably available on newer Samsung phones)</span><br></pre></td></tr></table></figure></div>

		</div>

		

		
		<ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden">
			
			<li class="tag-item mx-0.5">
				<a href="/tags/Langchain/">#Langchain</a>&nbsp;
			</li>
			
		</ul>
		

		

		
		<div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
			
			<div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="prev" rel="prev" href="/2025/05/04/langchain-tutorial-series/11.RAG/">
					<span class="left arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-left"></i>
					</span>
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item">Langchain 入门教程 - 11.检索增强生成 RAG</span>
						<span class="post-nav-item">Prev posts</span>
					</span>
				</a>
			</div>
			
			
			<div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="next" rel="next" href="/2025/05/04/langchain-tutorial-series/07.Embedding/">
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item">Langchain 入门教程 - 7.embedding模型</span>
						<span class="post-nav-item">Next posts</span>
					</span>
					<span class="right arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-right"></i>
					</span>
				</a>
			</div>
			
		</div>
		


		
		<div class="comment-container px-2 sm:px-6 md:px-8 pb-8">
			<div class="comments-container mt-10 w-full ">
    <div id="comment-anchor" class="w-full h-2.5"></div>
    <div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">
        Comments
    </div>
    

        
            
    <div id="waline"></div>
    <script type="module" data-swup-reload-script>
      import { init } from '/js/libs/waline.mjs';

      function loadWaline() {
        init({
          el: '#waline',
          serverURL: 'https://example.example.com',
          lang: 'zh-CN',
          dark: 'body[class~="dark-mode"]',
          reaction: false,
          requiredMeta: ['nick', 'mail'],
          emoji: [],
          
          
        });
      }

      if (typeof swup !== 'undefined') {
        loadWaline();
      } else {
        window.addEventListener('DOMContentLoaded', loadWaline);
      }
    </script>



        
    
</div>

		</div>
		
	</div>

	
	<div class="toc-content-container">
		<div class="post-toc-wrap">
	<div class="post-toc">
		<div class="toc-title">On this page</div>
		<div class="page-title">Langchain 入门教程 - 12.智能体 agent</div>
		<ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Tool"><span class="nav-text">Tool</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E7%BD%AE%E5%B7%A5%E5%85%B7-Built-in-tools"><span class="nav-text">内置工具 Built-in tools</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Python-REPL-%E5%B7%A5%E5%85%B7"><span class="nav-text">Python REPL 工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B7%A5%E5%85%B7"><span class="nav-text">自定义工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%94%A8%E4%BA%8E-Google-%E6%96%B0%E9%97%BB%E6%96%87%E7%AB%A0%E6%90%9C%E7%B4%A2%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B7%A5%E5%85%B7"><span class="nav-text">创建一个用于 Google 新闻文章搜索的自定义工具</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#bind-tools"><span class="nav-text">bind_tools</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#tool-%E8%BE%93%E5%87%BA%E8%A7%A3%E6%9E%90-JsonOutputToolsParser"><span class="nav-text">tool 输出解析 JsonOutputToolsParser</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%86%E5%B7%A5%E5%85%B7%E4%B8%8E%E8%A7%A3%E6%9E%90%E5%99%A8%E7%BB%91%E5%AE%9A%E4%BB%A5%E6%89%A7%E8%A1%8C"><span class="nav-text">将工具与解析器绑定以执行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%86%E5%B7%A5%E5%85%B7%E4%B8%8EAgent%E5%92%8CAgentExecutor%E7%BB%91%E5%AE%9A"><span class="nav-text">将工具与Agent和AgentExecutor绑定</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Tool-Calling-Agent"><span class="nav-text">Tool Calling Agent</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%B7%A5%E5%85%B7"><span class="nav-text">创建工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E4%BB%A3%E7%90%86%E6%8F%90%E7%A4%BA"><span class="nav-text">构建代理提示</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86"><span class="nav-text">创建代理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AgentExecutor"><span class="nav-text">AgentExecutor</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Stream-%E8%BE%93%E5%87%BA%E6%A3%80%E6%9F%A5%E9%80%90%E6%AD%A5%E7%BB%93%E6%9E%9C"><span class="nav-text">使用 Stream 输出检查逐步结果</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%94%A8%E6%88%B7%E5%AE%9A%E4%B9%89%E7%9A%84%E5%87%BD%E6%95%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%AD%E9%97%B4%E6%AD%A5%E9%AA%A4%E8%BE%93%E5%87%BA"><span class="nav-text">使用用户定义的函数自定义中间步骤输出</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8E%E4%B9%8B%E5%89%8D%E7%9A%84%E5%AF%B9%E8%AF%9D%E5%8E%86%E5%8F%B2%E8%BF%9B%E8%A1%8C%E4%BB%A3%E7%90%86%E9%80%9A%E4%BF%A1"><span class="nav-text">与之前的对话历史进行代理通信</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Agentic-RAG"><span class="nav-text">Agentic RAG</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%B7%A5%E5%85%B7-1"><span class="nav-text">创建工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86-1"><span class="nav-text">创建代理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%B9%E8%AF%9D%E5%8E%86%E5%8F%B2"><span class="nav-text">对话历史</span></a></li></ol></li></ol>

	</div>
</div>
	</div>
	
</div>
			</div>

			
		</div>

		<div class="main-content-footer">
			<footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
            2025&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">Peng Xia</a>
            
                
                <p class="post-count space-x-0.5">
                    <span>
                        45 posts in total
                    </span>
                    
                        <span>
                            149.6k words in total
                        </span>
                    
                </p>
            
        </div>
        
            <script data-swup-reload-script src="https://cn.vercount.one/js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">VISITOR COUNT</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">TOTAL PAGE VIEWS</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.8.2</a></span>
        </div>
        
        
        
        
        
    </div>  
</footer>
		</div>
	</div>

	
	<div class="post-tools">
		<div class="post-tools-container">
	<ul class="article-tools-list">
		<!-- TOC aside toggle -->
		
		<li class="right-bottom-tools page-aside-toggle">
			<i class="fa-regular fa-outdent"></i>
		</li>
		

		<!-- go comment -->
		
		<li class="go-comment">
			<i class="fa-regular fa-comments"></i>
		</li>
		
	</ul>
</div>
	</div>
	

	<div class="right-side-tools-container">
		<div class="side-tools-container">
	<ul class="hidden-tools-list">
		<li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-plus"></i>
		</li>

		<li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-minus"></i>
		</li>

		<li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
			<i class="fa-regular fa-moon"></i>
		</li>

		<!-- rss -->
		

		

		<li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
			<i class="fa-regular fa-arrow-down"></i>
		</li>
	</ul>

	<ul class="visible-tools-list">
		<li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
			<i class="fa-regular fa-cog fa-spin"></i>
		</li>
		
		<li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
			<i class="arrow-up fas fa-arrow-up"></i>
			<span class="percent"></span>
		</li>
		
		
	</ul>
</div>
	</div>

	<div class="image-viewer-container">
	<img src="">
</div>

	
	<div class="search-pop-overlay">
	<div class="popup search-popup">
		<div class="search-header">
			<span class="search-input-field-pre">
				<i class="fa-solid fa-keyboard"></i>
			</span>
			<div class="search-input-container">
				<input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input">
			</div>
			<span class="popup-btn-close">
				<i class="fa-solid fa-times"></i>
			</span>
		</div>
		<div id="search-result">
			<div id="no-result">
				<i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
			</div>
		</div>
	</div>
</div>
	

</main>



<script src="/js/build/libs/Swup.min.js"></script>

<script src="/js/build/libs/SwupSlideTheme.min.js"></script>

<script src="/js/build/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/build/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/build/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/build/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>




	
<script src="/js/build/tools/imageViewer.js" type="module"></script>

<script src="/js/build/utils.js" type="module"></script>

<script src="/js/build/main.js" type="module"></script>

<script src="/js/build/layouts/navbarShrink.js" type="module"></script>

<script src="/js/build/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/build/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/build/layouts/categoryList.js" type="module"></script>



    
<script src="/js/build/tools/localSearch.js" type="module"></script>




    
<script src="/js/build/tools/codeBlock.js" type="module"></script>




    
<script src="/js/build/layouts/lazyload.js" type="module"></script>






  
<script src="/js/build/libs/Typed.min.js"></script>

  
<script src="/js/build/plugins/typed.js" type="module"></script>








    
<script src="/js/build/libs/anime.min.js"></script>





    
<script src="/js/build/tools/tocToggle.js" type="module" data-swup-reload-script=""></script>

<script src="/js/build/layouts/toc.js" type="module" data-swup-reload-script=""></script>

<script src="/js/build/plugins/tabs.js" type="module" data-swup-reload-script=""></script>




<script src="/js/build/libs/moment-with-locales.min.js" data-swup-reload-script=""></script>


<script src="/js/build/layouts/essays.js" type="module" data-swup-reload-script=""></script>





	
</body>

</html>