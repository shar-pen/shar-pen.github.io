<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="Peng Xia">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://example.com/2025/05/04/langchain-tutorial-series/03.outputparser/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
    
    
        
        <meta name="description" content="Hexo Theme Redefine, Redefine Your Hexo Journey.">
<meta property="og:type" content="article">
<meta property="og:title" content="Langchain 入门教程 - 3.输出解析器">
<meta property="og:url" content="http://example.com/2025/05/04/langchain-tutorial-series/03.OutputParser/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Hexo Theme Redefine, Redefine Your Hexo Journey.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/redefine-og.webp">
<meta property="article:published_time" content="2025-05-04T14:43:57.509Z">
<meta property="article:modified_time" content="2025-05-04T14:46:49.493Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Langchain">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/redefine-og.webp">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/github-color-svgrepo-com.svg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/github-color-svgrepo-com.svg">
    <meta name="theme-color" content="#FFD700">
    <link rel="shortcut icon" href="/images/github-color-svgrepo-com.svg">
    <!--- Page Info-->
    
    <title>
        
            Langchain 入门教程 - 3.输出解析器 | Sharpen&#39;s Blogs
        
    </title>

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">


    <!--- Inject Part-->
    

    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/css/build/tailwind.css">

    

    
<link rel="stylesheet" href="/fonts/GeistMono/geist-mono.css">

    
<link rel="stylesheet" href="/fonts/Geist/geist.css">

    <!--- Font Part-->
    
        <link href="https://fonts.googleapis.com/css2?family=Lora" rel="stylesheet">
    
    
    
    
    
    

    <script id="hexo-configurations">
    window.config = {"hostname":"example.com","root":"/","language":"en","path":"search.json"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"delete_mask":false,"title_alignment":"left","headings_top_spacing":{"h1":"3.2rem","h2":"2.4rem","h3":"1.9rem","h4":"1.6rem","h5":"1.4rem","h6":"1.3rem"}},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":false,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","highlight_theme":{"light":"github","dark":"vs2015"},"font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":false,"default":"cc_by_nc_sa"},"lazyload":true,"pangu_js":false,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#FFD700","secondary":null,"default_mode":"light"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null},"title":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"website_counter":{"url":"https://cn.vercount.one/js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"preloader":{"enable":false,"custom_message":null},"open_graph":{"enable":true,"image":"/images/redefine-og.webp","description":"Hexo Theme Redefine, Redefine Your Hexo Journey."},"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/dune.jpg","dark":"/images/dune.jpg"},"title":"Sharpen's Blogs","subtitle":{"text":["Just regularly appending some blogs here, to keep my memory fresh and mind straight.","Here I am. ","Do not go gentle into that good night. "],"hitokoto":{"enable":false,"show_author":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":true,"family":"Lora","url":"https://fonts.googleapis.com/css2?family=Lora"},"social_links":{"enable":false,"style":"default","links":{"github":"https://github.com/shar-pen","instagram":null,"zhihu":null,"twitter":null,"email":"xiapeng21011@mail.ustc.edu.cn"},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null,"lrc":null}]},"mermaid":{"enable":false,"version":"11.4.1"}},"version":"2.8.2","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"width":{"home":"1200px","pages":"1000px"},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Categories":{"path":"/categories","icon":"fa-solid fa-folder"},"About":{"path":"/about","icon":"fa-regular fa-user"},"Links":{"icon":"fa-regular fa-link","submenus":{"Github":"https://github.com/shar-pen","Blog":"https://github.com/shar-pen.github.io","CSDN":"https://blog.csdn.net/the_3rd_bomb"}}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":":)","show_on_mobile":true,"links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"path":"/tags","icon":"fa-regular fa-tags"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"}}},"article_date_format":"YYYY-MM-DD","excerpt_length":200,"categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":null};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 7.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>



<body>
	<div class="progress-bar-container">
	

	
	<span class="pjax-progress-bar"></span>
	<!--        <span class="swup-progress-icon">-->
	<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
	<!--        </span>-->
	
</div>

<main class="page-container" id="swup">

	

	<div class="main-content-container flex flex-col justify-between min-h-dvh">
		<div class="main-content-header">
			<header class="navbar-container px-6 md:px-12">
    <div class="navbar-content transition-navbar ">
        <div class="left">
            
                <a class="logo-image h-8 w-8 sm:w-10 sm:h-10 mr-3" href="/">
                    <img src="/images/github-color-svgrepo-com.svg" class="w-full h-full rounded-sm">
                </a>
            
            <a class="logo-title" href="/">
                
                Sharpen&#39;s Blogs
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    HOME
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/archives"
                                        >
                                    <i class="fa-regular fa-archive fa-fw"></i>
                                    ARCHIVES
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/categories"
                                        >
                                    <i class="fa-solid fa-folder fa-fw"></i>
                                    CATEGORIES
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/about"
                                        >
                                    <i class="fa-regular fa-user fa-fw"></i>
                                    ABOUT
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown"
                                   href="#"
                                        onClick=&#34;return false;&#34;>
                                    <i class="fa-regular fa-link fa-fw"></i>
                                    LINKS
                                    <i class="fa-solid fa-chevron-down fa-fw"></i>
                                </a>

                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://github.com/shar-pen">
                                                    GITHUB
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://github.com/shar-pen.github.io">
                                                    BLOG
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://blog.csdn.net/the_3rd_bomb">
                                                    CSDN
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i>
                    </div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                HOME
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/archives"
                        >
                            <span>
                                ARCHIVES
                            </span>
                            
                                <i class="fa-regular fa-archive fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/categories"
                        >
                            <span>
                                CATEGORIES
                            </span>
                            
                                <i class="fa-solid fa-folder fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/about"
                        >
                            <span>
                                ABOUT
                            </span>
                            
                                <i class="fa-regular fa-user fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item-sub text-base my-1.5 flex flex-col w-full">
                        
                        <div class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary cursor-pointer text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                             navbar-data-toggle="submenu-Links"
                        >
                            <span>
                                LINKS
                            </span>
                            
                                <i class="fa-solid fa-chevron-right fa-sm fa-fw transition-all"></i>
                            
                        </div>
                        

                        
                            <div class="flex-col items-start px-2 py-2 hidden" data-target="submenu-Links">
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://github.com/shar-pen">GITHUB</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://github.com/shar-pen.github.io">BLOG</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://blog.csdn.net/the_3rd_bomb">CSDN</a>
                                    </div>
                                
                            </div>
                        
                    </li>
            

            
            
                
                    
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/tags"
                        >
                            <span>Tags</span>
                            <i class="fa-regular fa-tags fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">9</div>
        <div class="label text-third-text-color text-sm">Tags</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">11</div>
        <div class="label text-third-text-color text-sm">Categories</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">45</div>
        <div class="label text-third-text-color text-sm">Posts</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


		</div>

		<div class="main-content-body transition-fade-up">
			

			<div class="main-content">
				<div class="post-page-container flex relative justify-between box-border w-full h-full">
	<div class="article-content-container">

		<div class="article-title relative w-full">
			
			<div class="w-full flex items-center pt-6 justify-start">
				<h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">Langchain 入门教程 - 3.输出解析器</h1>
			</div>
			
		</div>

		
		<div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
			<div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
				<img src="/images/avatar.jpg">
			</div>
			<div class="info flex flex-col justify-between">
				<div class="author flex items-center">
					<span class="name text-default-text-color text-lg font-semibold">Peng Xia</span>
					
				</div>
				<div class="meta-info">
					<div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2025-05-04 22:43:57</span>
        <span class="mobile">2025-05-04 22:43:57</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2025-05-04 22:46:49</span>
            <span class="mobile">2025-05-04 22:46:49</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/Langchain-%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/">Langchain 入门教程</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Langchain/">Langchain</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>3.7k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>19 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

				</div>
			</div>
		</div>
		

		


		<div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
			<h1 id="Prompt-Template"><a href="#Prompt-Template" class="headerlink" title="Prompt Template"></a>Prompt Template</h1><p>Prompt 模板对于生成动态且灵活的提示至关重要，可用于各种场景，例如会话历史记录、结构化输出和特定查询。  </p>
<p>在本教程中，我们将探讨创建 <code>PromptTemplate</code> 对象的方法，应用部分变量，通过 YAML 文件管理模板，并利用 <code>ChatPromptTemplate</code> 和 <code>MessagePlaceholder</code> 等高级工具来增强功能。</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">	base_url=<span class="string">'http://localhost:5551/v1'</span>,</span><br><span class="line">	api_key=<span class="string">'EMPTY'</span>,</span><br><span class="line">	model_name=<span class="string">'Qwen2.5-7B-Instruct'</span>,</span><br><span class="line">	temperature=<span class="number">0.2</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>

<h2 id="创建-PromptTemplate-对象"><a href="#创建-PromptTemplate-对象" class="headerlink" title="创建 PromptTemplate 对象"></a>创建 <code>PromptTemplate</code> 对象</h2><p>有两种方法可以创建 <code>PromptTemplate</code> 对象：  </p>
<ul>
<li><strong>1.</strong> 使用 <code>from_template()</code> 方法。  </li>
<li><strong>2.</strong> 直接创建 <code>PromptTemplate</code> 对象并同时生成提示词。</li>
</ul>
<h3 id="方法-1-使用-from-template-方法"><a href="#方法-1-使用-from-template-方法" class="headerlink" title="方法 1. 使用 from_template() 方法"></a><strong>方法 1. 使用 <code>from_template()</code> 方法</strong></h3><ul>
<li>使用 <code>{variable}</code> 语法定义模板，其中 <code>variable</code> 代表可替换的变量。</li>
</ul>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> PromptTemplate</span><br><span class="line"></span><br><span class="line"><span class="comment"># {}内部是变量</span></span><br><span class="line">template = <span class="string">"What is the capital of {country}?"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用`from_template`函数来创建模板</span></span><br><span class="line">prompt = PromptTemplate.from_template(template)</span><br><span class="line">prompt</span><br></pre></td></tr></table></figure></div>




<pre><code>PromptTemplate(input_variables=['country'], input_types={}, partial_variables={}, template='What is the capital of {country}?')
</code></pre>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PromptTemplate(input_variables=['country'], input_types={}, partial_variables={}, template='What is the capital of {country}?')</span><br></pre></td></tr></table></figure></div>
<p>类已经解析出country这个变量，可以通过为变量 <code>country</code> 赋值来完成提示词。</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 类似str的`format`方法来创建实例</span></span><br><span class="line">prompt.<span class="built_in">format</span>(country=<span class="string">"United States of America"</span>)</span><br></pre></td></tr></table></figure></div>




<pre><code>'What is the capital of United States of America?'
</code></pre>
<p>进一步用chain来简化流程</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">template = <span class="string">"What is the capital of {country}?"</span></span><br><span class="line">prompt = PromptTemplate.from_template(template)</span><br><span class="line">chain = prompt | llm</span><br><span class="line">chain.invoke(<span class="string">"United States of America"</span>).content</span><br></pre></td></tr></table></figure></div>




<pre><code>'The capital of the United States of America is Washington, D.C.'
</code></pre>
<h3 id="方法-2-直接创建-PromptTemplate-对象并同时生成提示"><a href="#方法-2-直接创建-PromptTemplate-对象并同时生成提示" class="headerlink" title="方法 2. 直接创建 PromptTemplate 对象并同时生成提示"></a><strong>方法 2. 直接创建 <code>PromptTemplate</code> 对象并同时生成提示</strong></h3><ul>
<li><strong>明确指定 <code>input_variables</code></strong> 以进行额外的验证。  </li>
<li>否则，如果 <code>input_variables</code> 与模板字符串中的变量不匹配，实例化时可能会引发异常。</li>
</ul>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> PromptTemplate</span><br><span class="line"><span class="comment"># Define template</span></span><br><span class="line">template = <span class="string">"What is the capital of {country}?"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a prompt template with `PromptTemplate` object</span></span><br><span class="line">prompt = PromptTemplate(</span><br><span class="line">    template=template,</span><br><span class="line">    input_variables=[<span class="string">"country"</span>],</span><br><span class="line">)</span><br><span class="line">prompt</span><br></pre></td></tr></table></figure></div>




<pre><code>PromptTemplate(input_variables=['country'], input_types={}, partial_variables={}, template='What is the capital of {country}?')
</code></pre>
<h3 id="partial-variables"><a href="#partial-variables" class="headerlink" title="partial variables"></a>partial variables</h3><p>可临时固定的可变参数, 是特殊的 <code>input_variables</code>, 是对应 <code>input_variables</code> 在缺失时的默认值。<br>使用 <code>partial_variables</code>，您可以<strong>部分应用函数</strong>。这在需要共享 <strong>通用变量</strong> 时特别有用。  </p>
<p><strong>常见示例：</strong>  </p>
<ul>
<li><strong>日期或时间（date or time）</strong> 是典型的应用场景。</li>
</ul>
<p>例如，假设您希望在提示中指定当前日期：  </p>
<ul>
<li><strong>直接硬编码日期</strong> 或 <strong>每次手动传递日期变量</strong> 可能不太灵活。  </li>
<li><strong>更好的方法</strong> 是使用一个返回当前日期的函数，将其部分应用于提示模板，从而动态填充日期变量，使提示更具适应性。</li>
</ul>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> PromptTemplate</span><br><span class="line"><span class="comment"># Define template</span></span><br><span class="line">template = <span class="string">"What are the capitals of {country1} and {country2}, respectively?"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a prompt template with `PromptTemplate` object</span></span><br><span class="line">prompt = PromptTemplate(</span><br><span class="line">    template=template,</span><br><span class="line">    input_variables=[<span class="string">"country1"</span>],</span><br><span class="line">    partial_variables={</span><br><span class="line">        <span class="string">"country2"</span>: <span class="string">"United States of America"</span>  <span class="comment"># Pass `partial_variables` in dictionary form</span></span><br><span class="line">    },</span><br><span class="line">)</span><br><span class="line">prompt</span><br></pre></td></tr></table></figure></div>




<pre><code>PromptTemplate(input_variables=['country1'], input_types={}, partial_variables={'country2': 'United States of America'}, template='What are the capitals of {country1} and {country2}, respectively?')
</code></pre>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prompt.<span class="built_in">format</span>(country1=<span class="string">"South Korea"</span>)</span><br></pre></td></tr></table></figure></div>




<pre><code>'What are the capitals of South Korea and United States of America, respectively?'
</code></pre>
<p>通过<code>partial()</code>函数修改或者增加临时变量, 或者直接修改 PromptTemplate.partial_variables</p>
<ul>
<li>prompt_partial = prompt.partial(country2=”India”), 可创建新实例的同时保留原实例</li>
<li>prompt.partial_variables = {‘country2’:’china’}, 直接修改原实例</li>
</ul>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">prompt_partial = prompt.partial(country2=<span class="string">"India"</span>)</span><br><span class="line">prompt_partial.<span class="built_in">format</span>(country1=<span class="string">"South Korea"</span>)</span><br></pre></td></tr></table></figure></div>




<pre><code>'What are the capitals of South Korea and India, respectively?'
</code></pre>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">prompt.partial_variables = {<span class="string">'country2'</span>:<span class="string">'china'</span>}</span><br><span class="line">prompt.<span class="built_in">format</span>(country1=<span class="string">"South Korea"</span>)</span><br></pre></td></tr></table></figure></div>




<pre><code>'What are the capitals of South Korea and china, respectively?'
</code></pre>
<p><code>partial variables</code> 可以临时用新值, 不会影响缺失时的默认值</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(prompt_partial.<span class="built_in">format</span>(country1=<span class="string">"South Korea"</span>, country2=<span class="string">"Canada"</span>))</span><br><span class="line"><span class="built_in">print</span>(prompt_partial.<span class="built_in">format</span>(country1=<span class="string">"South Korea"</span>))</span><br></pre></td></tr></table></figure></div>

<pre><code>What are the capitals of South Korea and Canada, respectively?
What are the capitals of South Korea and India, respectively?
</code></pre>
<p><code>partial variables</code> 可用函数传递, 不需要手动设置新值</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_today</span>():</span><br><span class="line">    <span class="keyword">return</span> datetime.now().strftime(<span class="string">"%B %d"</span>)</span><br><span class="line"></span><br><span class="line">prompt = PromptTemplate(</span><br><span class="line">    template=<span class="string">"Today's date is {today}. Please list {n} celebrities whose birthday is today. Please specify their date of birth."</span>,</span><br><span class="line">    input_variables=[<span class="string">"n"</span>],</span><br><span class="line">    partial_variables={</span><br><span class="line">        <span class="string">"today"</span>: get_today  <span class="comment"># Pass `partial_variables` in dictionary form</span></span><br><span class="line">    },</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">prompt.<span class="built_in">format</span>(n=<span class="number">3</span>)</span><br></pre></td></tr></table></figure></div>




<pre><code>"Today's date is January 30. Please list 3 celebrities whose birthday is today. Please specify their date of birth."
</code></pre>
<h2 id="从-YAML-文件加载-Prompt-模板"><a href="#从-YAML-文件加载-Prompt-模板" class="headerlink" title="从 YAML 文件加载 Prompt 模板"></a><strong>从 YAML 文件加载 Prompt 模板</strong></h2><p>您可以将 <strong>Prompt 模板</strong> 存储在单独的 <strong>YAML 文件</strong> 中，并使用 <code>load_prompt</code> 进行加载和管理。</p>
<p>以下是一个yaml示例: </p>
<hr>
<div class="code-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">_type:</span> <span class="string">"prompt"</span></span><br><span class="line"><span class="attr">template:</span> <span class="string">"What is the color of {fruit}?"</span></span><br><span class="line"><span class="attr">input_variables:</span> [<span class="string">"fruit"</span>]</span><br></pre></td></tr></table></figure></div>
<hr>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> load_prompt</span><br><span class="line"></span><br><span class="line">prompt = load_prompt(<span class="string">"prompts/fruit_color.yaml"</span>, encoding=<span class="string">"utf-8"</span>)</span><br><span class="line">prompt</span><br></pre></td></tr></table></figure></div>

<h2 id="ChatPromptTemplate"><a href="#ChatPromptTemplate" class="headerlink" title="ChatPromptTemplate"></a><strong>ChatPromptTemplate</strong></h2><p><code>ChatPromptTemplate</code> 可用于将<strong>会话历史记录</strong>包含到提示词中，以提供上下文信息。消息以 <strong>(<code>role</code>, <code>message</code>)</strong> 元组的形式组织，并存储在 <strong>列表</strong> 中。</p>
<p><strong>角色（role）</strong>:</p>
<ul>
<li><strong><code>"system"</code></strong> ：系统设置信息，通常用于全局指令或设定 AI 的行为。  </li>
<li><strong><code>"human"</code></strong> ：用户输入的消息。  </li>
<li><strong><code>"ai"</code></strong> ：AI 生成的响应消息。</li>
</ul>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> ChatPromptTemplate</span><br><span class="line"></span><br><span class="line">chat_prompt = ChatPromptTemplate.from_template(<span class="string">"What is the capital of {country}?"</span>)</span><br><span class="line">chat_prompt</span><br></pre></td></tr></table></figure></div>




<pre><code>ChatPromptTemplate(input_variables=['country'], input_types={}, partial_variables={}, messages=[HumanMessagePromptTemplate(prompt=PromptTemplate(input_variables=['country'], input_types={}, partial_variables={}, template='What is the capital of {country}?'), additional_kwargs={})])
</code></pre>
<p>ChatPromptTemplate(input_variables=[‘country’], input_types={}, partial_variables={}, messages=[HumanMessagePromptTemplate(prompt=PromptTemplate(input_variables=[‘country’], input_types={}, partial_variables={}, template=’What is the capital of {country}?’), additional_kwargs={})])</p>
<p>注意这个prompt被 <code>HumanMessagePromptTemplate</code>包装了，而且位于一个list中</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chat_prompt.<span class="built_in">format</span>(country=<span class="string">"United States of America"</span>)</span><br></pre></td></tr></table></figure></div>




<pre><code>'Human: What is the capital of United States of America?'
</code></pre>
<h3 id="多角色"><a href="#多角色" class="headerlink" title="多角色"></a>多角色</h3><p>使用 <code>ChatPromptTemplate.from_messages</code>来定义模板, 内部是 chat list, 每个 chat 都是以 <strong>(<code>role</code>, <code>message</code>)</strong> 元组的形式组织</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> ChatPromptTemplate</span><br><span class="line"></span><br><span class="line">chat_template = ChatPromptTemplate.from_messages(</span><br><span class="line">    [</span><br><span class="line">        <span class="comment"># role, message</span></span><br><span class="line">        (<span class="string">"system"</span>, <span class="string">"You are a friendly AI assistant. Your name is {name}."</span>),</span><br><span class="line">        (<span class="string">"human"</span>, <span class="string">"Nice to meet you!"</span>),</span><br><span class="line">        (<span class="string">"ai"</span>, <span class="string">"Hello! How can I assist you?"</span>),</span><br><span class="line">        (<span class="string">"human"</span>, <span class="string">"{user_input}"</span>),</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create chat messages</span></span><br><span class="line">messages = chat_template.format_messages(name=<span class="string">"Teddy"</span>, user_input=<span class="string">"What is your name?"</span>)</span><br><span class="line">messages</span><br></pre></td></tr></table></figure></div>




<pre><code>[SystemMessage(content='You are a friendly AI assistant. Your name is Teddy.', additional_kwargs={}, response_metadata={}),
 HumanMessage(content='Nice to meet you!', additional_kwargs={}, response_metadata={}),
 AIMessage(content='Hello! How can I assist you?', additional_kwargs={}, response_metadata={}),
 HumanMessage(content='What is your name?', additional_kwargs={}, response_metadata={})]
</code></pre>
<p>可直接用上面的 Message list 的形式调用大模型</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">	base_url=<span class="string">'http://localhost:5551/v1'</span>,</span><br><span class="line">	api_key=<span class="string">'EMPTY'</span>,</span><br><span class="line">	model_name=<span class="string">'Qwen2.5-7B-Instruct'</span>,</span><br><span class="line">	temperature=<span class="number">0.2</span>,</span><br><span class="line">)</span><br><span class="line">llm.invoke(messages).content</span><br></pre></td></tr></table></figure></div>




<pre><code>"My name is Teddy. It's nice to meet you! How can I help you today?"
</code></pre>
<h3 id="MessagePlaceholder"><a href="#MessagePlaceholder" class="headerlink" title="MessagePlaceholder"></a><strong>MessagePlaceholder</strong></h3><p><code>LangChain</code> 提供了 <strong><code>MessagePlaceholder</code></strong>，用途包括:</p>
<ul>
<li><strong>当不确定使用哪些角色</strong> 作为消息提示模板的一部分时，它可以提供灵活性。  </li>
<li><strong>在格式化时插入一组消息列表</strong>，适用于动态会话历史记录的场景。</li>
</ul>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.output_parsers <span class="keyword">import</span> StrOutputParser</span><br><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> ChatPromptTemplate, MessagesPlaceholder</span><br><span class="line"></span><br><span class="line">chat_prompt = ChatPromptTemplate.from_messages(</span><br><span class="line">    [</span><br><span class="line">        (</span><br><span class="line">            <span class="string">"system"</span>,</span><br><span class="line">            <span class="string">"You are a summarization specialist AI assistant. Your mission is to summarize conversations using key points."</span>,</span><br><span class="line">        ),</span><br><span class="line">        MessagesPlaceholder(variable_name=<span class="string">"conversation"</span>),</span><br><span class="line">        (<span class="string">"human"</span>, <span class="string">"Summarize the conversation so far in {word_count} words."</span>),</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line">chat_prompt</span><br></pre></td></tr></table></figure></div>




<pre><code>ChatPromptTemplate(input_variables=['conversation', 'word_count'], input_types={'conversation': list[typing.Annotated[typing.Union[typing.Annotated[langchain_core.messages.ai.AIMessage, Tag(tag='ai')], typing.Annotated[langchain_core.messages.human.HumanMessage, Tag(tag='human')], typing.Annotated[langchain_core.messages.chat.ChatMessage, Tag(tag='chat')], typing.Annotated[langchain_core.messages.system.SystemMessage, Tag(tag='system')], typing.Annotated[langchain_core.messages.function.FunctionMessage, Tag(tag='function')], typing.Annotated[langchain_core.messages.tool.ToolMessage, Tag(tag='tool')], typing.Annotated[langchain_core.messages.ai.AIMessageChunk, Tag(tag='AIMessageChunk')], typing.Annotated[langchain_core.messages.human.HumanMessageChunk, Tag(tag='HumanMessageChunk')], typing.Annotated[langchain_core.messages.chat.ChatMessageChunk, Tag(tag='ChatMessageChunk')], typing.Annotated[langchain_core.messages.system.SystemMessageChunk, Tag(tag='SystemMessageChunk')], typing.Annotated[langchain_core.messages.function.FunctionMessageChunk, Tag(tag='FunctionMessageChunk')], typing.Annotated[langchain_core.messages.tool.ToolMessageChunk, Tag(tag='ToolMessageChunk')]], FieldInfo(annotation=NoneType, required=True, discriminator=Discriminator(discriminator=&lt;function _get_type at 0x7ff1a966cfe0&gt;, custom_error_type=None, custom_error_message=None, custom_error_context=None))]]}, partial_variables={}, messages=[SystemMessagePromptTemplate(prompt=PromptTemplate(input_variables=[], input_types={}, partial_variables={}, template='You are a summarization specialist AI assistant. Your mission is to summarize conversations using key points.'), additional_kwargs={}), MessagesPlaceholder(variable_name='conversation'), HumanMessagePromptTemplate(prompt=PromptTemplate(input_variables=['word_count'], input_types={}, partial_variables={}, template='Summarize the conversation so far in {word_count} words.'), additional_kwargs={})])
</code></pre>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">formatted_chat_prompt = chat_prompt.<span class="built_in">format</span>(</span><br><span class="line">    word_count=<span class="number">5</span>,</span><br><span class="line">    conversation=[</span><br><span class="line">        (<span class="string">"human"</span>, <span class="string">"Hello! I’m Teddy. Nice to meet you."</span>),</span><br><span class="line">        (<span class="string">"ai"</span>, <span class="string">"Nice to meet you! I look forward to working with you."</span>),</span><br><span class="line">    ],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(formatted_chat_prompt)</span><br></pre></td></tr></table></figure></div>

<pre><code>System: You are a summarization specialist AI assistant. Your mission is to summarize conversations using key points.
Human: Hello! I’m Teddy. Nice to meet you.
AI: Nice to meet you! I look forward to working with you.
Human: Summarize the conversation so far in 5 words.
</code></pre>
<h2 id="Few-Shot-Prompting"><a href="#Few-Shot-Prompting" class="headerlink" title="Few-Shot Prompting"></a><strong>Few-Shot Prompting</strong></h2><p>LangChain 的 <strong>Few-Shot Prompting</strong> 提供了一种强大的框架，通过提供精心挑选的示例，引导语言模型生成高质量的输出。此技术<strong>减少了大量模型微调的需求</strong>，同时确保在各种应用场景中提供<strong>精准且符合上下文</strong>的结果。  </p>
<ul>
<li><p><strong>Few-Shot Prompt 模板</strong>：  </p>
<ul>
<li>通过嵌入示例定义提示的结构和格式，指导模型生成一致的输出。</li>
</ul>
</li>
<li><p><strong>示例选择策略（Example Selection Strategies）</strong>：  </p>
<ul>
<li><strong>动态选择最相关的示例</strong> 以匹配特定查询，增强模型的上下文理解能力，提高响应准确性。</li>
</ul>
</li>
<li><p><strong>Chroma 向量存储（Chroma Vector Store）</strong>：  </p>
<ul>
<li>用于存储和检索基于<strong>语义相似度</strong>的示例，提供<strong>可扩展且高效</strong>的 Prompt 结构构建。</li>
</ul>
</li>
</ul>
<h3 id="FewShotPromptTemplate"><a href="#FewShotPromptTemplate" class="headerlink" title="FewShotPromptTemplate"></a><strong>FewShotPromptTemplate</strong></h3><p><strong>Few-shot prompting</strong> 是一种强大的技术，它通过提供<strong>少量精心设计的示例</strong>，引导语言模型生成<strong>准确且符合上下文</strong>的输出。LangChain 的 <strong><code>FewShotPromptTemplate</code></strong> 简化了这一过程，使用户能够<strong>构建灵活且可复用的提示</strong>，适用于问答、摘要、文本校正等任务。  </p>
<p><strong>1. 设计 Few-Shot 提示（Designing Few-Shot Prompts）</strong>  </p>
<ul>
<li><strong>定义示例</strong>，展示所需的输出结构和风格。  </li>
<li><strong>确保示例覆盖边界情况</strong>，以增强模型的理解能力和性能。</li>
</ul>
<p><strong>2. 动态示例选择（Dynamic Example Selection）</strong>  </p>
<ul>
<li><strong>利用语义相似性或向量搜索</strong>，选择最相关的示例，以匹配输入查询。</li>
</ul>
<p><strong>3. 集成 Few-Shot 提示（Integrating Few-Shot Prompts）</strong>  </p>
<ul>
<li><strong>结合 Prompt 模板与语言模型</strong>，构建强大的链式调用，以生成高质量的响应。</li>
</ul>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">	base_url=<span class="string">'http://localhost:5551/v1'</span>,</span><br><span class="line">	api_key=<span class="string">'EMPTY'</span>,</span><br><span class="line">	model_name=<span class="string">'Qwen2.5-7B-Instruct'</span>,</span><br><span class="line">	temperature=<span class="number">0.2</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># User query</span></span><br><span class="line">question = <span class="string">"What is the capital of United States of America?"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Query the model</span></span><br><span class="line">response = llm.invoke(question)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print the response</span></span><br><span class="line"><span class="built_in">print</span>(response.content)</span><br></pre></td></tr></table></figure></div>

<pre><code>The capital of the United States of America is Washington, D.C.
</code></pre>
<p>以下是一个 CoT 的示例prompt</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> PromptTemplate, FewShotPromptTemplate</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define examples for the few-shot prompt</span></span><br><span class="line">examples = [</span><br><span class="line">    {</span><br><span class="line">        <span class="string">"question"</span>: <span class="string">"Who lived longer, Steve Jobs or Einstein?"</span>,</span><br><span class="line">        <span class="string">"answer"</span>: <span class="string">"""Does this question require additional questions: Yes.</span></span><br><span class="line"><span class="string">Additional Question: At what age did Steve Jobs die?</span></span><br><span class="line"><span class="string">Intermediate Answer: Steve Jobs died at the age of 56.</span></span><br><span class="line"><span class="string">Additional Question: At what age did Einstein die?</span></span><br><span class="line"><span class="string">Intermediate Answer: Einstein died at the age of 76.</span></span><br><span class="line"><span class="string">The final answer is: Einstein</span></span><br><span class="line"><span class="string">"""</span>,</span><br><span class="line">    },</span><br><span class="line">    {</span><br><span class="line">        <span class="string">"question"</span>: <span class="string">"When was the founder of Naver born?"</span>,</span><br><span class="line">        <span class="string">"answer"</span>: <span class="string">"""Does this question require additional questions: Yes.</span></span><br><span class="line"><span class="string">Additional Question: Who is the founder of Naver?</span></span><br><span class="line"><span class="string">Intermediate Answer: Naver was founded by Lee Hae-jin.</span></span><br><span class="line"><span class="string">Additional Question: When was Lee Hae-jin born?</span></span><br><span class="line"><span class="string">Intermediate Answer: Lee Hae-jin was born on June 22, 1967.</span></span><br><span class="line"><span class="string">The final answer is: June 22, 1967</span></span><br><span class="line"><span class="string">"""</span>,</span><br><span class="line">    },</span><br><span class="line">    {</span><br><span class="line">        <span class="string">"question"</span>: <span class="string">"Who was the reigning king when Yulgok Yi's mother was born?"</span>,</span><br><span class="line">        <span class="string">"answer"</span>: <span class="string">"""Does this question require additional questions: Yes.</span></span><br><span class="line"><span class="string">Additional Question: Who is Yulgok Yi's mother?</span></span><br><span class="line"><span class="string">Intermediate Answer: Yulgok Yi's mother is Shin Saimdang.</span></span><br><span class="line"><span class="string">Additional Question: When was Shin Saimdang born?</span></span><br><span class="line"><span class="string">Intermediate Answer: Shin Saimdang was born in 1504.</span></span><br><span class="line"><span class="string">Additional Question: Who was the king of Joseon in 1504?</span></span><br><span class="line"><span class="string">Intermediate Answer: The king of Joseon in 1504 was Yeonsangun.</span></span><br><span class="line"><span class="string">The final answer is: Yeonsangun</span></span><br><span class="line"><span class="string">"""</span>,</span><br><span class="line">    },</span><br><span class="line">    {</span><br><span class="line">        <span class="string">"question"</span>: <span class="string">"Are the directors of Oldboy and Parasite from the same country?"</span>,</span><br><span class="line">        <span class="string">"answer"</span>: <span class="string">"""Does this question require additional questions: Yes.</span></span><br><span class="line"><span class="string">Additional Question: Who is the director of Oldboy?</span></span><br><span class="line"><span class="string">Intermediate Answer: The director of Oldboy is Park Chan-wook.</span></span><br><span class="line"><span class="string">Additional Question: Which country is Park Chan-wook from?</span></span><br><span class="line"><span class="string">Intermediate Answer: Park Chan-wook is from South Korea.</span></span><br><span class="line"><span class="string">Additional Question: Who is the director of Parasite?</span></span><br><span class="line"><span class="string">Intermediate Answer: The director of Parasite is Bong Joon-ho.</span></span><br><span class="line"><span class="string">Additional Question: Which country is Bong Joon-ho from?</span></span><br><span class="line"><span class="string">Intermediate Answer: Bong Joon-ho is from South Korea.</span></span><br><span class="line"><span class="string">The final answer is: Yes</span></span><br><span class="line"><span class="string">"""</span>,</span><br><span class="line">    },</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">example_prompt = PromptTemplate.from_template(</span><br><span class="line">    <span class="string">"Question:\n{question}\nAnswer:\n{answer}"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print the first formatted example</span></span><br><span class="line"><span class="built_in">print</span>(example_prompt.<span class="built_in">format</span>(**examples[<span class="number">0</span>]))</span><br></pre></td></tr></table></figure></div>

<pre><code>Question:
Who lived longer, Steve Jobs or Einstein?
Answer:
Does this question require additional questions: Yes.
Additional Question: At what age did Steve Jobs die?
Intermediate Answer: Steve Jobs died at the age of 56.
Additional Question: At what age did Einstein die?
Intermediate Answer: Einstein died at the age of 76.
The final answer is: Einstein
</code></pre>
<p>以下这个 <code>FewShotPromptTemplate</code> 将 examples 以 example_prompt 格式添加到真正 QA 的前面。真正的 QA 按照 suffix 格式展示</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Initialize the FewShotPromptTemplate</span></span><br><span class="line">few_shot_prompt = FewShotPromptTemplate(</span><br><span class="line">    examples=examples,</span><br><span class="line">    example_prompt=example_prompt,</span><br><span class="line">    suffix=<span class="string">"Question:\n{question}\nAnswer:"</span>,</span><br><span class="line">    input_variables=[<span class="string">"question"</span>],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example question</span></span><br><span class="line">question = <span class="string">"How old was Bill Gates when Google was founded?"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate the final prompt</span></span><br><span class="line">final_prompt = few_shot_prompt.<span class="built_in">format</span>(question=question)</span><br><span class="line"><span class="built_in">print</span>(final_prompt)</span><br></pre></td></tr></table></figure></div>

<pre><code>Question:
Who lived longer, Steve Jobs or Einstein?
Answer:
Does this question require additional questions: Yes.
Additional Question: At what age did Steve Jobs die?
Intermediate Answer: Steve Jobs died at the age of 56.
Additional Question: At what age did Einstein die?
Intermediate Answer: Einstein died at the age of 76.
The final answer is: Einstein
</code></pre>
<p>​<br>    Question:<br>    When was the founder of Naver born?<br>    Answer:<br>    Does this question require additional questions: Yes.<br>    Additional Question: Who is the founder of Naver?<br>    Intermediate Answer: Naver was founded by Lee Hae-jin.<br>    Additional Question: When was Lee Hae-jin born?<br>    Intermediate Answer: Lee Hae-jin was born on June 22, 1967.<br>    The final answer is: June 22, 1967</p>
<p>​<br>    Question:<br>    Who was the reigning king when Yulgok Yi’s mother was born?<br>    Answer:<br>    Does this question require additional questions: Yes.<br>    Additional Question: Who is Yulgok Yi’s mother?<br>    Intermediate Answer: Yulgok Yi’s mother is Shin Saimdang.<br>    Additional Question: When was Shin Saimdang born?<br>    Intermediate Answer: Shin Saimdang was born in 1504.<br>    Additional Question: Who was the king of Joseon in 1504?<br>    Intermediate Answer: The king of Joseon in 1504 was Yeonsangun.<br>    The final answer is: Yeonsangun</p>
<p>​<br>    Question:<br>    Are the directors of Oldboy and Parasite from the same country?<br>    Answer:<br>    Does this question require additional questions: Yes.<br>    Additional Question: Who is the director of Oldboy?<br>    Intermediate Answer: The director of Oldboy is Park Chan-wook.<br>    Additional Question: Which country is Park Chan-wook from?<br>    Intermediate Answer: Park Chan-wook is from South Korea.<br>    Additional Question: Who is the director of Parasite?<br>    Intermediate Answer: The director of Parasite is Bong Joon-ho.<br>    Additional Question: Which country is Bong Joon-ho from?<br>    Intermediate Answer: Bong Joon-ho is from South Korea.<br>    The final answer is: Yes</p>
<p>​<br>    Question:<br>    How old was Bill Gates when Google was founded?<br>    Answer:</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">response = llm.invoke(final_prompt)</span><br><span class="line"><span class="built_in">print</span>(response.content)</span><br></pre></td></tr></table></figure></div>

<pre><code>Does this question require additional questions: Yes.
Additional Question: When was Google founded?
Intermediate Answer: Google was founded in 1998.
Additional Question: When was Bill Gates born?
Intermediate Answer: Bill Gates was born on October 28, 1955.
The final answer is: Bill Gates was 43 years old when Google was founded.
</code></pre>
<h2 id="特殊-prompt"><a href="#特殊-prompt" class="headerlink" title="特殊 prompt"></a>特殊 prompt</h2><h3 id="RAG-文档分析"><a href="#RAG-文档分析" class="headerlink" title="RAG 文档分析"></a><strong>RAG 文档分析</strong></h3><p>基于检索到的文档上下文<strong>处理并回答问题</strong>，确保<strong>高准确性和高相关性</strong>。</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.prompts <span class="keyword">import</span> ChatPromptTemplate</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">system = <span class="string">"""You are a precise and helpful AI assistant specializing in question-answering tasks based on provided context.</span></span><br><span class="line"><span class="string">Your primary task is to:</span></span><br><span class="line"><span class="string">1. Analyze the provided context thoroughly</span></span><br><span class="line"><span class="string">2. Answer questions using ONLY the information from the context</span></span><br><span class="line"><span class="string">3. Preserve technical terms and proper nouns exactly as they appear</span></span><br><span class="line"><span class="string">4. If the answer cannot be found in the context, respond with: 'The provided context does not contain information to answer this question.'</span></span><br><span class="line"><span class="string">5. Format responses in clear, readable paragraphs with relevant examples when available</span></span><br><span class="line"><span class="string">6. Focus on accuracy and clarity in your responses</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">human = <span class="string">"""#Question:</span></span><br><span class="line"><span class="string">{question}</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#Context:</span></span><br><span class="line"><span class="string">{context}</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#Answer:</span></span><br><span class="line"><span class="string">Please provide a focused, accurate response that directly addresses the question using only the information from the provided context."""</span></span><br><span class="line"></span><br><span class="line">prompt = ChatPromptTemplate.from_messages(</span><br><span class="line">	[</span><br><span class="line">		(<span class="string">"system"</span>, system), </span><br><span class="line">		(<span class="string">"human"</span>, human)</span><br><span class="line">	]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">prompt</span><br></pre></td></tr></table></figure></div>




<pre><code>ChatPromptTemplate(input_variables=['context', 'question'], input_types={}, partial_variables={}, messages=[SystemMessagePromptTemplate(prompt=PromptTemplate(input_variables=[], input_types={}, partial_variables={}, template="You are a precise and helpful AI assistant specializing in question-answering tasks based on provided context.\nYour primary task is to:\n1. Analyze the provided context thoroughly\n2. Answer questions using ONLY the information from the context\n3. Preserve technical terms and proper nouns exactly as they appear\n4. If the answer cannot be found in the context, respond with: 'The provided context does not contain information to answer this question.'\n5. Format responses in clear, readable paragraphs with relevant examples when available\n6. Focus on accuracy and clarity in your responses\n"), additional_kwargs={}), HumanMessagePromptTemplate(prompt=PromptTemplate(input_variables=['context', 'question'], input_types={}, partial_variables={}, template='#Question:\n{question}\n\n#Context:\n{context}\n\n#Answer:\nPlease provide a focused, accurate response that directly addresses the question using only the information from the provided context.'), additional_kwargs={})])
</code></pre>
<h3 id="具有来源归因的-RAG（RAG-with-Source-Attribution）"><a href="#具有来源归因的-RAG（RAG-with-Source-Attribution）" class="headerlink" title="具有来源归因的 RAG（RAG with Source Attribution）"></a><strong>具有来源归因的 RAG（RAG with Source Attribution）</strong></h3><p>增强型 RAG 实现，支持<strong>详细的来源追踪和引用</strong>，以提高<strong>可追溯性和验证可靠性</strong>。</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.prompts <span class="keyword">import</span> ChatPromptTemplate</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">system = <span class="string">"""You are a precise and thorough AI assistant that provides well-documented answers with source attribution.</span></span><br><span class="line"><span class="string">Your responsibilities include:</span></span><br><span class="line"><span class="string">1. Analyzing provided context thoroughly</span></span><br><span class="line"><span class="string">2. Generating accurate answers based solely on the given context</span></span><br><span class="line"><span class="string">3. Including specific source references for each key point</span></span><br><span class="line"><span class="string">4. Preserving technical terminology exactly as presented</span></span><br><span class="line"><span class="string">5. Maintaining clear citation format [source: page/document]</span></span><br><span class="line"><span class="string">6. If information is not found in the context, state: 'The provided context does not contain information to answer this question.'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Format your response as:</span></span><br><span class="line"><span class="string">1. Main Answer</span></span><br><span class="line"><span class="string">2. Sources Used (with specific locations)</span></span><br><span class="line"><span class="string">3. Confidence Level (High/Medium/Low)"""</span></span><br><span class="line"></span><br><span class="line">human = <span class="string">"""#Question:</span></span><br><span class="line"><span class="string">{question}</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#Context:</span></span><br><span class="line"><span class="string">{context}</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#Answer:</span></span><br><span class="line"><span class="string">Please provide a detailed response with source citations using only information from the provided context."""</span></span><br><span class="line"></span><br><span class="line">prompt = ChatPromptTemplate.from_messages(</span><br><span class="line">	[</span><br><span class="line">		(<span class="string">"system"</span>, system), </span><br><span class="line">		(<span class="string">"human"</span>, human)</span><br><span class="line">	]</span><br><span class="line">)</span><br><span class="line">PROMPT_OWNER = <span class="string">"eun"</span></span><br><span class="line">hub.push(<span class="string">f"<span class="subst">{PROMPT_OWNER}</span>/<span class="subst">{prompt_title}</span>"</span>, prompt, new_repo_is_public=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></div>

<p>其实在回答要求里加入了源引用的要求</p>
<h3 id="LLM-响应评估（LLM-Response-Evaluation）"><a href="#LLM-响应评估（LLM-Response-Evaluation）" class="headerlink" title="LLM 响应评估（LLM Response Evaluation）"></a><strong>LLM 响应评估（LLM Response Evaluation）</strong></h3><p>基于<strong>多项质量指标</strong>对 LLM 响应进行<strong>全面评估</strong>，并提供<strong>详细的评分方法</strong>。</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.prompts <span class="keyword">import</span> PromptTemplate</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">evaluation_prompt = <span class="string">"""Evaluate the LLM's response based on the following criteria:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">INPUT:</span></span><br><span class="line"><span class="string">Question: {question}</span></span><br><span class="line"><span class="string">Context: {context}</span></span><br><span class="line"><span class="string">LLM Response: {answer}</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EVALUATION CRITERIA:</span></span><br><span class="line"><span class="string">1. Accuracy (0-10)</span></span><br><span class="line"><span class="string">- Perfect (10): Completely accurate, perfectly aligned with context</span></span><br><span class="line"><span class="string">- Good (7-9): Minor inaccuracies</span></span><br><span class="line"><span class="string">- Fair (4-6): Some significant inaccuracies</span></span><br><span class="line"><span class="string">- Poor (0-3): Major inaccuracies or misalignment</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. Completeness (0-10)</span></span><br><span class="line"><span class="string">- Perfect (10): Comprehensive coverage of all relevant points</span></span><br><span class="line"><span class="string">- Good (7-9): Covers most important points</span></span><br><span class="line"><span class="string">- Fair (4-6): Missing several key points</span></span><br><span class="line"><span class="string">- Poor (0-3): Critically incomplete</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3. Context Relevance (0-10)</span></span><br><span class="line"><span class="string">- Perfect (10): Optimal use of context</span></span><br><span class="line"><span class="string">- Good (7-9): Good use with minor omissions</span></span><br><span class="line"><span class="string">- Fair (4-6): Partial use of relevant context</span></span><br><span class="line"><span class="string">- Poor (0-3): Poor context utilization</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">4. Clarity (0-10)</span></span><br><span class="line"><span class="string">- Perfect (10): Exceptionally clear and well-structured</span></span><br><span class="line"><span class="string">- Good (7-9): Clear with minor issues</span></span><br><span class="line"><span class="string">- Fair (4-6): Somewhat unclear</span></span><br><span class="line"><span class="string">- Poor (0-3): Confusing or poorly structured</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">SCORING METHOD:</span></span><br><span class="line"><span class="string">1. Calculate individual scores</span></span><br><span class="line"><span class="string">2. Compute weighted average:</span></span><br><span class="line"><span class="string">   - Accuracy: 40%</span></span><br><span class="line"><span class="string">   - Completeness: 25%</span></span><br><span class="line"><span class="string">   - Context Relevance: 25%</span></span><br><span class="line"><span class="string">   - Clarity: 10%</span></span><br><span class="line"><span class="string">3. Normalize to 0-1 scale</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">OUTPUT FORMAT:</span></span><br><span class="line"><span class="string">{</span></span><br><span class="line"><span class="string">    "individual_scores": {</span></span><br><span class="line"><span class="string">        "accuracy": float,</span></span><br><span class="line"><span class="string">        "completeness": float,</span></span><br><span class="line"><span class="string">        "context_relevance": float,</span></span><br><span class="line"><span class="string">        "clarity": float</span></span><br><span class="line"><span class="string">    },</span></span><br><span class="line"><span class="string">    "weighted_score": float,</span></span><br><span class="line"><span class="string">    "normalized_score": float,</span></span><br><span class="line"><span class="string">    "evaluation_notes": string</span></span><br><span class="line"><span class="string">}</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Return ONLY the normalized_score as a decimal between 0 and 1."""</span></span><br><span class="line"></span><br><span class="line">prompt = PromptTemplate.from_template(evaluation_prompt)</span><br></pre></td></tr></table></figure></div>
		</div>

		

		
		<ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden">
			
			<li class="tag-item mx-0.5">
				<a href="/tags/Langchain/">#Langchain</a>&nbsp;
			</li>
			
		</ul>
		

		

		
		<div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
			
			<div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="prev" rel="prev" href="/2025/05/04/langchain-tutorial-series/06.TextSplitter/">
					<span class="left arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-left"></i>
					</span>
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item">Langchain 入门教程 - 6.文档切分</span>
						<span class="post-nav-item">Prev posts</span>
					</span>
				</a>
			</div>
			
			
			<div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="next" rel="next" href="/2025/05/04/langchain-tutorial-series/02Prompt/">
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item">Langchain 入门教程 - 2.提示词模板</span>
						<span class="post-nav-item">Next posts</span>
					</span>
					<span class="right arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-right"></i>
					</span>
				</a>
			</div>
			
		</div>
		


		
		<div class="comment-container px-2 sm:px-6 md:px-8 pb-8">
			<div class="comments-container mt-10 w-full ">
    <div id="comment-anchor" class="w-full h-2.5"></div>
    <div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">
        Comments
    </div>
    

        
            
    <div id="waline"></div>
    <script type="module" data-swup-reload-script>
      import { init } from '/js/libs/waline.mjs';

      function loadWaline() {
        init({
          el: '#waline',
          serverURL: 'https://example.example.com',
          lang: 'zh-CN',
          dark: 'body[class~="dark-mode"]',
          reaction: false,
          requiredMeta: ['nick', 'mail'],
          emoji: [],
          
          
        });
      }

      if (typeof swup !== 'undefined') {
        loadWaline();
      } else {
        window.addEventListener('DOMContentLoaded', loadWaline);
      }
    </script>



        
    
</div>

		</div>
		
	</div>

	
	<div class="toc-content-container">
		<div class="post-toc-wrap">
	<div class="post-toc">
		<div class="toc-title">On this page</div>
		<div class="page-title">Langchain 入门教程 - 3.输出解析器</div>
		<ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Prompt-Template"><span class="nav-text">Prompt Template</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-PromptTemplate-%E5%AF%B9%E8%B1%A1"><span class="nav-text">创建 PromptTemplate 对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95-1-%E4%BD%BF%E7%94%A8-from-template-%E6%96%B9%E6%B3%95"><span class="nav-text">方法 1. 使用 from_template() 方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95-2-%E7%9B%B4%E6%8E%A5%E5%88%9B%E5%BB%BA-PromptTemplate-%E5%AF%B9%E8%B1%A1%E5%B9%B6%E5%90%8C%E6%97%B6%E7%94%9F%E6%88%90%E6%8F%90%E7%A4%BA"><span class="nav-text">方法 2. 直接创建 PromptTemplate 对象并同时生成提示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#partial-variables"><span class="nav-text">partial variables</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8E-YAML-%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD-Prompt-%E6%A8%A1%E6%9D%BF"><span class="nav-text">从 YAML 文件加载 Prompt 模板</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ChatPromptTemplate"><span class="nav-text">ChatPromptTemplate</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E8%A7%92%E8%89%B2"><span class="nav-text">多角色</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MessagePlaceholder"><span class="nav-text">MessagePlaceholder</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Few-Shot-Prompting"><span class="nav-text">Few-Shot Prompting</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#FewShotPromptTemplate"><span class="nav-text">FewShotPromptTemplate</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A-prompt"><span class="nav-text">特殊 prompt</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RAG-%E6%96%87%E6%A1%A3%E5%88%86%E6%9E%90"><span class="nav-text">RAG 文档分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B7%E6%9C%89%E6%9D%A5%E6%BA%90%E5%BD%92%E5%9B%A0%E7%9A%84-RAG%EF%BC%88RAG-with-Source-Attribution%EF%BC%89"><span class="nav-text">具有来源归因的 RAG（RAG with Source Attribution）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LLM-%E5%93%8D%E5%BA%94%E8%AF%84%E4%BC%B0%EF%BC%88LLM-Response-Evaluation%EF%BC%89"><span class="nav-text">LLM 响应评估（LLM Response Evaluation）</span></a></li></ol></li></ol></li></ol>

	</div>
</div>
	</div>
	
</div>
			</div>

			
		</div>

		<div class="main-content-footer">
			<footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
            2025&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">Peng Xia</a>
            
                
                <p class="post-count space-x-0.5">
                    <span>
                        45 posts in total
                    </span>
                    
                        <span>
                            149.6k words in total
                        </span>
                    
                </p>
            
        </div>
        
            <script data-swup-reload-script src="https://cn.vercount.one/js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">VISITOR COUNT</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">TOTAL PAGE VIEWS</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.8.2</a></span>
        </div>
        
        
        
        
        
    </div>  
</footer>
		</div>
	</div>

	
	<div class="post-tools">
		<div class="post-tools-container">
	<ul class="article-tools-list">
		<!-- TOC aside toggle -->
		
		<li class="right-bottom-tools page-aside-toggle">
			<i class="fa-regular fa-outdent"></i>
		</li>
		

		<!-- go comment -->
		
		<li class="go-comment">
			<i class="fa-regular fa-comments"></i>
		</li>
		
	</ul>
</div>
	</div>
	

	<div class="right-side-tools-container">
		<div class="side-tools-container">
	<ul class="hidden-tools-list">
		<li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-plus"></i>
		</li>

		<li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-minus"></i>
		</li>

		<li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
			<i class="fa-regular fa-moon"></i>
		</li>

		<!-- rss -->
		

		

		<li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
			<i class="fa-regular fa-arrow-down"></i>
		</li>
	</ul>

	<ul class="visible-tools-list">
		<li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
			<i class="fa-regular fa-cog fa-spin"></i>
		</li>
		
		<li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
			<i class="arrow-up fas fa-arrow-up"></i>
			<span class="percent"></span>
		</li>
		
		
	</ul>
</div>
	</div>

	<div class="image-viewer-container">
	<img src="">
</div>

	
	<div class="search-pop-overlay">
	<div class="popup search-popup">
		<div class="search-header">
			<span class="search-input-field-pre">
				<i class="fa-solid fa-keyboard"></i>
			</span>
			<div class="search-input-container">
				<input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input">
			</div>
			<span class="popup-btn-close">
				<i class="fa-solid fa-times"></i>
			</span>
		</div>
		<div id="search-result">
			<div id="no-result">
				<i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
			</div>
		</div>
	</div>
</div>
	

</main>



<script src="/js/build/libs/Swup.min.js"></script>

<script src="/js/build/libs/SwupSlideTheme.min.js"></script>

<script src="/js/build/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/build/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/build/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/build/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>




	
<script src="/js/build/tools/imageViewer.js" type="module"></script>

<script src="/js/build/utils.js" type="module"></script>

<script src="/js/build/main.js" type="module"></script>

<script src="/js/build/layouts/navbarShrink.js" type="module"></script>

<script src="/js/build/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/build/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/build/layouts/categoryList.js" type="module"></script>



    
<script src="/js/build/tools/localSearch.js" type="module"></script>




    
<script src="/js/build/tools/codeBlock.js" type="module"></script>




    
<script src="/js/build/layouts/lazyload.js" type="module"></script>






  
<script src="/js/build/libs/Typed.min.js"></script>

  
<script src="/js/build/plugins/typed.js" type="module"></script>








    
<script src="/js/build/libs/anime.min.js"></script>





    
<script src="/js/build/tools/tocToggle.js" type="module" data-swup-reload-script=""></script>

<script src="/js/build/layouts/toc.js" type="module" data-swup-reload-script=""></script>

<script src="/js/build/plugins/tabs.js" type="module" data-swup-reload-script=""></script>




<script src="/js/build/libs/moment-with-locales.min.js" data-swup-reload-script=""></script>


<script src="/js/build/layouts/essays.js" type="module" data-swup-reload-script=""></script>





	
</body>

</html>