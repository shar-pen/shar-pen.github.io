<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="Peng Xia">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://example.com/2025/08/05/rag/agentic_search_infer/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
    
    
        
        <meta name="description" content="Hexo Theme Redefine, Redefine Your Hexo Journey.">
<meta property="og:type" content="article">
<meta property="og:title" content="Agentic search&#x2F;RAG pipeline">
<meta property="og:url" content="http://example.com/2025/08/05/RAG/agentic_search_infer/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Hexo Theme Redefine, Redefine Your Hexo Journey.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/redefine-og.webp">
<meta property="article:published_time" content="2025-08-05T14:35:22.746Z">
<meta property="article:modified_time" content="2025-08-05T14:39:49.033Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Agent">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/redefine-og.webp">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/github-color-svgrepo-com.svg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/github-color-svgrepo-com.svg">
    <meta name="theme-color" content="#FFD700">
    <link rel="shortcut icon" href="/images/github-color-svgrepo-com.svg">
    <!--- Page Info-->
    
    <title>
        
            Agentic search/RAG pipeline | Sharpen&#39;s Blogs
        
    </title>

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">


    <!--- Inject Part-->
    

    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/css/build/tailwind.css">

    

    
<link rel="stylesheet" href="/fonts/GeistMono/geist-mono.css">

    
<link rel="stylesheet" href="/fonts/Geist/geist.css">

    <!--- Font Part-->
    
        <link href="https://fonts.googleapis.com/css2?family=Lora" rel="stylesheet">
    
    
    
    
    
    

    <script id="hexo-configurations">
    window.config = {"hostname":"example.com","root":"/","language":"en","path":"search.json"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"delete_mask":false,"title_alignment":"left","headings_top_spacing":{"h1":"3.2rem","h2":"2.4rem","h3":"1.9rem","h4":"1.6rem","h5":"1.4rem","h6":"1.3rem"}},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":false,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","highlight_theme":{"light":"github","dark":"vs2015"},"font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":false,"default":"cc_by_nc_sa"},"lazyload":true,"pangu_js":false,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#FFD700","secondary":null,"default_mode":"light"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null},"title":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"website_counter":{"url":"https://cn.vercount.one/js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"preloader":{"enable":false,"custom_message":null},"open_graph":{"enable":true,"image":"/images/redefine-og.webp","description":"Hexo Theme Redefine, Redefine Your Hexo Journey."},"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/dune.jpg","dark":"/images/dune.jpg"},"title":"Sharpen's Blogs","subtitle":{"text":["Just regularly appending some blogs here, to keep my memory fresh and mind straight.","Here I am. ","Do not go gentle into that good night. "],"hitokoto":{"enable":false,"show_author":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":true,"family":"Lora","url":"https://fonts.googleapis.com/css2?family=Lora"},"social_links":{"enable":false,"style":"default","links":{"github":"https://github.com/shar-pen","instagram":null,"zhihu":null,"twitter":null,"email":"xiapeng21011@mail.ustc.edu.cn"},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null,"lrc":null}]},"mermaid":{"enable":false,"version":"11.4.1"}},"version":"2.8.2","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"width":{"home":"1200px","pages":"1000px"},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Categories":{"path":"/categories","icon":"fa-solid fa-folder"},"About":{"path":"/about","icon":"fa-regular fa-user"},"Links":{"icon":"fa-regular fa-link","submenus":{"Github":"https://github.com/shar-pen","Blog":"https://github.com/shar-pen.github.io","CSDN":"https://blog.csdn.net/the_3rd_bomb"}}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":":)","show_on_mobile":true,"links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"path":"/tags","icon":"fa-regular fa-tags"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"}}},"article_date_format":"YYYY-MM-DD","excerpt_length":200,"categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":null};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 7.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>



<body>
	<div class="progress-bar-container">
	

	
	<span class="pjax-progress-bar"></span>
	<!--        <span class="swup-progress-icon">-->
	<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
	<!--        </span>-->
	
</div>

<main class="page-container" id="swup">

	

	<div class="main-content-container flex flex-col justify-between min-h-dvh">
		<div class="main-content-header">
			<header class="navbar-container px-6 md:px-12">
    <div class="navbar-content transition-navbar ">
        <div class="left">
            
                <a class="logo-image h-8 w-8 sm:w-10 sm:h-10 mr-3" href="/">
                    <img src="/images/github-color-svgrepo-com.svg" class="w-full h-full rounded-sm">
                </a>
            
            <a class="logo-title" href="/">
                
                Sharpen&#39;s Blogs
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    HOME
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/archives"
                                        >
                                    <i class="fa-regular fa-archive fa-fw"></i>
                                    ARCHIVES
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/categories"
                                        >
                                    <i class="fa-solid fa-folder fa-fw"></i>
                                    CATEGORIES
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/about"
                                        >
                                    <i class="fa-regular fa-user fa-fw"></i>
                                    ABOUT
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown"
                                   href="#"
                                        onClick=&#34;return false;&#34;>
                                    <i class="fa-regular fa-link fa-fw"></i>
                                    LINKS
                                    <i class="fa-solid fa-chevron-down fa-fw"></i>
                                </a>

                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://github.com/shar-pen">
                                                    GITHUB
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://github.com/shar-pen.github.io">
                                                    BLOG
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://blog.csdn.net/the_3rd_bomb">
                                                    CSDN
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i>
                    </div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                HOME
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/archives"
                        >
                            <span>
                                ARCHIVES
                            </span>
                            
                                <i class="fa-regular fa-archive fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/categories"
                        >
                            <span>
                                CATEGORIES
                            </span>
                            
                                <i class="fa-solid fa-folder fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/about"
                        >
                            <span>
                                ABOUT
                            </span>
                            
                                <i class="fa-regular fa-user fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item-sub text-base my-1.5 flex flex-col w-full">
                        
                        <div class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary cursor-pointer text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                             navbar-data-toggle="submenu-Links"
                        >
                            <span>
                                LINKS
                            </span>
                            
                                <i class="fa-solid fa-chevron-right fa-sm fa-fw transition-all"></i>
                            
                        </div>
                        

                        
                            <div class="flex-col items-start px-2 py-2 hidden" data-target="submenu-Links">
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://github.com/shar-pen">GITHUB</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://github.com/shar-pen.github.io">BLOG</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://blog.csdn.net/the_3rd_bomb">CSDN</a>
                                    </div>
                                
                            </div>
                        
                    </li>
            

            
            
                
                    
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/tags"
                        >
                            <span>Tags</span>
                            <i class="fa-regular fa-tags fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">10</div>
        <div class="label text-third-text-color text-sm">Tags</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">12</div>
        <div class="label text-third-text-color text-sm">Categories</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">50</div>
        <div class="label text-third-text-color text-sm">Posts</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


		</div>

		<div class="main-content-body transition-fade-up">
			

			<div class="main-content">
				<div class="post-page-container flex relative justify-between box-border w-full h-full">
	<div class="article-content-container">

		<div class="article-title relative w-full">
			
			<div class="w-full flex items-center pt-6 justify-start">
				<h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">Agentic search/RAG pipeline</h1>
			</div>
			
		</div>

		
		<div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
			<div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
				<img src="/images/avatar.jpg">
			</div>
			<div class="info flex flex-col justify-between">
				<div class="author flex items-center">
					<span class="name text-default-text-color text-lg font-semibold">Peng Xia</span>
					
				</div>
				<div class="meta-info">
					<div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2025-08-05 22:35:22</span>
        <span class="mobile">2025-08-05 22:35:22</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2025-08-05 22:39:49</span>
            <span class="mobile">2025-08-05 22:39:49</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/RAG/">RAG</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Agent/">Agent</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>5.5k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>26 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

				</div>
			</div>
		</div>
		

		


		<div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
			<p>这个 blog 是复现 ZeroSearch 的副产物。拿来和 function call search 对比时搭的 pipeline。<br>Search-O1, Search-R1, ReSearch, DeepResearcher, ZeroSearch 之类都是采用整体上类似的 agentic search 结构, i.e., think, search, infomation 交叉生成，直到生成了 answer. </p>
<p>以下示意图出自 Search-O1。</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/agentic_search_infer/image-20250805222714583-1754404409438-1.png" alt="image-20250805222714583"></p>
<p>接下来先构建搜索引擎，Bing 和 Google 之类的个人申请好麻烦，国内提供 api 服务的有博查。</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os, json, time, requests, transformers, torch, re</span><br><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> OpenAI</span><br></pre></td></tr></table></figure></div>

<h2 id="搜索引擎函数定义"><a href="#搜索引擎函数定义" class="headerlink" title="搜索引擎函数定义"></a>搜索引擎函数定义</h2><h3 id="google"><a href="#google" class="headerlink" title="google"></a>google</h3><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> serpapi</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">retrieve_from_google</span>(<span class="params">query, topk, retry_attempt=<span class="number">3</span></span>):</span><br><span class="line">	SER_API_KEY = os.environ.get(<span class="string">"SER_API_KEY"</span>, <span class="literal">None</span>)</span><br><span class="line">	params = {</span><br><span class="line">		<span class="string">"engine"</span>: <span class="string">"google"</span>,</span><br><span class="line">		<span class="string">"q"</span>: query,</span><br><span class="line">		<span class="string">"api_key"</span>: SER_API_KEY,</span><br><span class="line">		<span class="string">"num"</span>: topk</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(retry_attempt):</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			search = serpapi.search(params)</span><br><span class="line">			search_result = search[<span class="string">"organic_results"</span>]</span><br><span class="line"></span><br><span class="line">			search_texts = []</span><br><span class="line">			<span class="keyword">for</span> item <span class="keyword">in</span> search_result:</span><br><span class="line">				text_data = <span class="string">''</span></span><br><span class="line">				<span class="keyword">if</span> <span class="string">'title'</span> <span class="keyword">in</span> item:</span><br><span class="line">					text_data += item[<span class="string">'title'</span>]</span><br><span class="line">				<span class="keyword">if</span> <span class="string">'snippet'</span> <span class="keyword">in</span> item:</span><br><span class="line">					text_data += item[<span class="string">'snippet'</span>]</span><br><span class="line">				search_texts.append(text_data)</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> <span class="string">'\n'</span>.join([<span class="string">f"Doc <span class="subst">{i + <span class="number">1</span>}</span>: <span class="subst">{doc}</span>"</span> <span class="keyword">for</span> i, doc <span class="keyword">in</span> <span class="built_in">enumerate</span>(search_texts)])</span><br><span class="line"></span><br><span class="line">		<span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">f"Attempt <span class="subst">{i + <span class="number">1</span>}</span> failed: <span class="subst">{e}</span>"</span>)</span><br><span class="line">			<span class="keyword">if</span> i &lt; retry_attempt - <span class="number">1</span>:</span><br><span class="line">				time.sleep(<span class="number">2</span>)  <span class="comment"># 等待2秒后重试</span></span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				<span class="built_in">print</span>(<span class="string">"All retries failed."</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="string">'No information available'</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h3 id="bocha"><a href="#bocha" class="headerlink" title="bocha"></a>bocha</h3><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">retrieve_from_bocha</span>(<span class="params">query, topk, retry_attempt=<span class="number">3</span></span>):</span><br><span class="line"></span><br><span class="line">	url = <span class="string">"https://api.bochaai.com/v1/web-search"</span></span><br><span class="line">	headers = {</span><br><span class="line">	<span class="string">'Authorization'</span>: <span class="string">'Bearer sk-128428ba28314b80a8283695ff1385a3'</span>,</span><br><span class="line">	<span class="string">'Content-Type'</span>: <span class="string">'application/json'</span></span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(retry_attempt):</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			payload = json.dumps({</span><br><span class="line">				<span class="string">"query"</span>: query,</span><br><span class="line">				<span class="string">"summary"</span>: <span class="literal">True</span>,</span><br><span class="line">				<span class="string">"count"</span>: topk</span><br><span class="line">			})</span><br><span class="line"></span><br><span class="line">			response = requests.request(<span class="string">"POST"</span>, url, headers=headers, data=payload)</span><br><span class="line">			search_results = response.json()[<span class="string">'data'</span>][<span class="string">'webPages'</span>][<span class="string">'value'</span>]</span><br><span class="line">			search_texts = [item[<span class="string">'summary'</span>] <span class="keyword">for</span> item <span class="keyword">in</span> search_results <span class="keyword">if</span> <span class="string">'summary'</span> <span class="keyword">in</span> item]</span><br><span class="line">			<span class="keyword">return</span> <span class="string">'\n'</span>.join([<span class="string">f"Doc <span class="subst">{i + <span class="number">1</span>}</span>: <span class="subst">{doc}</span>"</span> <span class="keyword">for</span> i, doc <span class="keyword">in</span> <span class="built_in">enumerate</span>(search_texts)])</span><br><span class="line"></span><br><span class="line">		<span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">f"Attempt <span class="subst">{i + <span class="number">1</span>}</span> failed: <span class="subst">{e}</span>"</span>)</span><br><span class="line">			<span class="keyword">if</span> i &lt; retry_attempt - <span class="number">1</span>:</span><br><span class="line">				time.sleep(<span class="number">2</span>)  <span class="comment"># 等待2秒后重试</span></span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				<span class="built_in">print</span>(<span class="string">"All retries failed."</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="string">'No information available'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(retrieve_from_bocha('2025金价', 5))</span></span><br></pre></td></tr></table></figure></div>

<div class="code-container" data-rel="Markdown"><figure class="iseeu highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Doc 1: 正面观点:2025年金价会越来越高!不少机构及分析师预测2025年金价均价达到2800-2900美元区间,并可能突破3000美元关口。当然手里有黄金的朋友也不建议卖的太早了,未来金价有望达到700元/克。</span><br><span class="line">Doc 2: 汇通网12月17日讯 —— MKS 预测2024年金价均价为每盎司2750美元,较今年当前的年均值上涨14%;2025年金价接近 2500 美元/盎司的可能性为30%,2025年金价突破每盎司 3000 美元的可能性只有20%;全球宽松措施应有助于刺激经济,提振2025年白银的工业需求,预计白银价格交易区间为每盎司 28 美元至 42 美元,均价为每盎司 36.50 美元,较当前年均价上涨 23%。 一位市场分析师表示,即将进入新的一年,黄金在 2025 年创下历史新高的道路似乎更加复杂。 MKS PAMP (瑞士金融公司)研究与金属策略主管 Nicky Shiels 在她的 2025 年贵金属展望中表示,她预计黄金交易价格将在每盎司 2500 美元至 3200 美元之间的相当宽的范围内,贵金属的命运很大程度上由美联储决定。与此同时,MKS 预测今年金价均价为每盎司 2750 美元,较今年当前的年均值上涨 14%。 “金价在 3000 美元以上或 2500 美元——取决于美联储是领先还是落后于特朗普通胀曲线;我们预计它们将落后,导致下半年实际利率下降和美元走软,”她表示,“从结构上看,长期高通胀、持续的去全球化、货币贬值、央行去美元化、混乱且不可预测的地缘政治、不可持续的全球债务路径以及持有不足的普通投资者群体的正反馈循环确保了黄金仍然是一种安全资产多元化者。” 尽管黄金在 2025 年拥有坚实的基本面支撑,但Shiels 指出,明年出现熊市的可能性高于牛市的可能性。 Shiels 在报告中表示,随着当选总统唐纳德·特朗普通过减税和放松管制等促增长政策推动美国例外论,明年金价接近 2500 美元/盎司的可能性为 30% 。 与此同时,美国优先的政策预计将推高消费者价格,迫使美联储放慢宽松周期,尽管它落后于通胀曲线。 Shiels还警告黄金投资者,新政府对其他货币的关注可能会</span><br><span class="line">Doc 3: 根据伦敦金银市场协会对26位分析师的调查显示,黄金今年将在当前价格附近徘徊。 调查显示,2025年金价平均将达到每盎司2737美元。 最乐观的预测来自住友商事的Keisuke Okui,预计将达到2925美元。 最悲观的预测来自Robin Bhar Metals Consulting的Robin Bhar,预计将达到2500美元。 注:现货黄金周一的交易价格接近每盎司2760美元。 新浪合作大平台期货开户 安全快捷有保障 海量资讯、精准解读,尽在新浪财经APP</span><br><span class="line">Doc 4: 各大投行对黄金 2025 年价格的预测及走势分析: 高盛    价格预测 :预计 2025 年初金价将达到每盎司 2900 美元,到2025 年底,金价将上涨 11%,至每盎司 3000 美元.    走势分析 :高盛认为推动金价走高的因素主要有三个。一是美联储的政策行动,预计美联储将在 2025 年大幅降息,借贷成本的下降会使黄金更具吸引力 。二是美元走强将推动各国央行主导的黄金购买热潮,外国机构对黄金的购买量将持续增加。三是黄金和美元在 2025 年有一个共同的上涨理由,当贸易关税或地缘政治冲击推动美元走强时,美元和金价往往会同时上涨,因二者均为避险资产. 摩根大通    价格预测 :预计 2025 年底金价将达到 3000 美元 / 盎司.    走势分析 :2025 年宏观不确定性加剧时,黄金将发挥重要对冲作用。宏观动荡时,央行和投资者增持黄金;宏观平稳时,美联储降息周期带动黄金 ETF 资金流入. 瑞银    价格预测 :预计 2025 年底金价将达到每盎司 2900 美元.    走势分析 :预计黄金在未来 6 到12 个月内仍有进一步上涨的空间,黄金是抵御经济不确定性的有吸引力的避险资产,特别是在特朗普政府的政策变化和美联储的利率路径不确定性增加的背景下,ETF 的大量资金流入是关键因素 美国银行    价格预测 :预计 2025 年下半年金价将达到 3000 美元,2025 年金价平均将在每盎司 2750 美元左右.    走势分析 :尽管 2025 年黄金面临如亚洲大国需求低迷、西方投资者面临潜在的债券收益率上升和美元走强等重大阻力,但受经济不确定性和地缘政治动荡刺激避险需求的推动,金银将获得坚实支撑. 荷兰国际集团    价格预测 :预计 2025 年第一季度和第二季度现货黄金均价为每盎司 2800 美元,全年均价为每盎司 2760 美元5.    走势</span><br></pre></td></tr></table></figure></div>

<h2 id="agentic-search"><a href="#agentic-search" class="headerlink" title="agentic search"></a>agentic search</h2><p>这是 zero search 的提示词，实际测试时还是有点问题，例如:</p>
<ul>
<li>tag 部分不生成，例如非第一次think只会生成 <code>&lt;/think&gt;</code> ，已修改</li>
<li>没有搜索上限，复杂问题或者单纯没有搜索到内容的情况就会重复好久，我记得 search-o1 有搜索次数上限: “You can repeat the search process multiple times if necessary. The maximum number of search attempts is limited to {MAX_SEARCH_LIMIT}.\n\n”，我没有修改提示词，直接break。</li>
<li>答案过于简洁，不大友善</li>
</ul>
<p>整体推理流程是 loop，每个 loop 内: </p>
<ul>
<li>以 prompt 为输入 think，可能会直接回答或者生成 search</li>
<li>model.generate 检测到 <code>&lt;/search&gt;</code> 中断</li>
<li>检查是否是 eos 导致，是则退出 loop</li>
<li>抽取新生成的内容 <code>&lt;search&gt;</code> 去搜索</li>
<li>将本轮新生成的内容和搜索结果拼入 prompt 中</li>
</ul>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 搜索结果的模板，最后的 `&lt;think&gt;` 最好还是加下，可能会出现非第一次think只会生成 &lt;/think&gt; 的情况</span></span><br><span class="line">curr_search_template = <span class="string">'{output_text}\n&lt;information&gt;{search_results}&lt;/information&gt;\n&lt;think&gt;'</span></span><br><span class="line"><span class="comment"># Prompt 模板</span></span><br><span class="line">prompt_template = <span class="string">"""Answer the given question. \</span></span><br><span class="line"><span class="string">You must conduct reasoning inside &lt;think&gt; and &lt;/think&gt; first every time you get new information. \</span></span><br><span class="line"><span class="string">After reasoning, if you find you lack some knowledge, you can call a search engine by &lt;search&gt; query &lt;/search&gt; and it will return the top searched results between &lt;information&gt; and &lt;/information&gt;. \</span></span><br><span class="line"><span class="string">You can search as many times as your want. \</span></span><br><span class="line"><span class="string">If you find no further external knowledge needed, you can directly provide the answer inside &lt;answer&gt; and &lt;/answer&gt;, without detailed illustrations. For example, &lt;answer&gt; Beijing &lt;/answer&gt;. Question: {question}\n"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个用于控制在生成 &lt;/search&gt; 时中断生成</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StopOnSequence</span>(transformers.StoppingCriteria):</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, target_sequences, tokenizer</span>):</span><br><span class="line">		<span class="comment"># Encode the string so we have the exact token-IDs pattern</span></span><br><span class="line">		<span class="variable language_">self</span>.target_ids = [tokenizer.encode(target_sequence, add_special_tokens=<span class="literal">False</span>) <span class="keyword">for</span> target_sequence <span class="keyword">in</span></span><br><span class="line">						   target_sequences]</span><br><span class="line">		<span class="variable language_">self</span>.target_lengths = [<span class="built_in">len</span>(target_id) <span class="keyword">for</span> target_id <span class="keyword">in</span> <span class="variable language_">self</span>.target_ids]</span><br><span class="line">		<span class="variable language_">self</span>._tokenizer = tokenizer</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, input_ids, scores, **kwargs</span>):</span><br><span class="line">		<span class="comment"># Make sure the target IDs are on the same device</span></span><br><span class="line">		targets = [torch.as_tensor(target_id, device=input_ids.device) <span class="keyword">for</span> target_id <span class="keyword">in</span> <span class="variable language_">self</span>.target_ids]</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> input_ids.shape[<span class="number">1</span>] &lt; <span class="built_in">min</span>(<span class="variable language_">self</span>.target_lengths):</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">		<span class="comment"># Compare the tail of input_ids with our target_ids</span></span><br><span class="line">		<span class="keyword">for</span> i, target <span class="keyword">in</span> <span class="built_in">enumerate</span>(targets):</span><br><span class="line">			<span class="keyword">if</span> torch.equal(input_ids[<span class="number">0</span>, -<span class="variable language_">self</span>.target_lengths[i]:], target):</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取 search query</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_query</span>(<span class="params">text</span>):</span><br><span class="line">	pattern = re.<span class="built_in">compile</span>(<span class="string">r"&lt;search&gt;(.*?)&lt;/search&gt;"</span>, re.DOTALL)</span><br><span class="line">	matches = pattern.findall(text)</span><br><span class="line">	<span class="keyword">if</span> matches:</span><br><span class="line">		<span class="keyword">return</span> matches[-<span class="number">1</span>].strip(<span class="string">'\n'</span>).strip()</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_agentic_search</span>(<span class="params">model, tokenizer, question, search_engine_func=retrieve_from_bocha, search_engine_func_kwargs={<span class="string">'topk'</span>:<span class="number">5</span>}</span>):</span><br><span class="line">	device = model.device</span><br><span class="line">	question = question.strip()</span><br><span class="line">	<span class="keyword">if</span> question[-<span class="number">1</span>] != <span class="string">'?'</span>:</span><br><span class="line">		question += <span class="string">'?'</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># Prepare the message</span></span><br><span class="line">	prompt = prompt_template.<span class="built_in">format</span>(question=question)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># Initialize the stopping criteria</span></span><br><span class="line">	<span class="comment"># real stopping criteria</span></span><br><span class="line">	curr_eos = [tokenizer.eos_token_id, tokenizer.pad_token_id]</span><br><span class="line">	<span class="comment"># middle stopping criteria</span></span><br><span class="line">	target_sequences = [<span class="string">"&lt;/search&gt;"</span>, <span class="string">" &lt;/search&gt;"</span>, <span class="string">"&lt;/search&gt;\n"</span>, <span class="string">" &lt;/search&gt;\n"</span>, <span class="string">"&lt;/search&gt;\n\n"</span>, <span class="string">" &lt;/search&gt;\n\n"</span>]</span><br><span class="line">	stopping_criteria = transformers.StoppingCriteriaList([StopOnSequence(target_sequences, tokenizer)])</span><br><span class="line"></span><br><span class="line">	cnt = <span class="number">0</span></span><br><span class="line">	<span class="keyword">if</span> tokenizer.chat_template:</span><br><span class="line">		prompt = tokenizer.apply_chat_template([{<span class="string">"role"</span>: <span class="string">"user"</span>, <span class="string">"content"</span>: prompt}], add_generation_prompt=<span class="literal">True</span>, tokenize=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># print('\n\n################# [Start Reasoning + Searching] ##################\n\n')</span></span><br><span class="line">	<span class="comment"># print(prompt)</span></span><br><span class="line">	<span class="comment"># Encode the chat-formatted prompt and move it to the correct device</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		input_ids = tokenizer.encode(prompt, return_tensors=<span class="string">'pt'</span>).to(device)</span><br><span class="line">		attention_mask = torch.ones_like(input_ids)</span><br><span class="line"></span><br><span class="line">		<span class="comment"># Generate text with the stopping criteria</span></span><br><span class="line">		outputs = model.generate(</span><br><span class="line">			input_ids,</span><br><span class="line">			attention_mask=attention_mask,</span><br><span class="line">			max_new_tokens=<span class="number">1024</span>,</span><br><span class="line">			stopping_criteria=stopping_criteria,</span><br><span class="line">			pad_token_id=tokenizer.eos_token_id,</span><br><span class="line">			do_sample=<span class="literal">True</span>,</span><br><span class="line">			temperature=<span class="number">0.7</span></span><br><span class="line">		)</span><br><span class="line"></span><br><span class="line">		<span class="comment"># real stop and exit loop</span></span><br><span class="line">		<span class="keyword">if</span> outputs[<span class="number">0</span>][-<span class="number">1</span>].item() <span class="keyword">in</span> curr_eos:</span><br><span class="line">			full_text = tokenizer.decode(outputs[<span class="number">0</span>], skip_special_tokens=<span class="literal">False</span>)</span><br><span class="line">			<span class="keyword">return</span> full_text</span><br><span class="line">			<span class="comment"># generated_tokens = outputs[0][input_ids.shape[1]:]</span></span><br><span class="line">			<span class="comment"># output_text = tokenizer.decode(generated_tokens, skip_special_tokens=True)</span></span><br><span class="line">			<span class="comment"># print(output_text)</span></span><br><span class="line">			<span class="comment"># break</span></span><br><span class="line"></span><br><span class="line">		<span class="comment"># split generated tokens from current output_ids</span></span><br><span class="line">		generated_tokens = outputs[<span class="number">0</span>][input_ids.shape[<span class="number">1</span>]:]</span><br><span class="line">		output_text = tokenizer.decode(generated_tokens, skip_special_tokens=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">		<span class="comment"># check for &lt;search&gt; invoking </span></span><br><span class="line">		tmp_query = get_query(tokenizer.decode(outputs[<span class="number">0</span>], skip_special_tokens=<span class="literal">True</span>))</span><br><span class="line">		<span class="keyword">if</span> tmp_query:</span><br><span class="line">			<span class="keyword">try</span>:</span><br><span class="line">				search_results = search_engine_func(tmp_query, **search_engine_func_kwargs)</span><br><span class="line">			<span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">				<span class="keyword">raise</span> ValueError(<span class="string">f"Unknown using search engine: <span class="subst">{search_engine_func.__name__}</span>, error: <span class="subst">{e}</span>"</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			search_results = <span class="string">'No information available'</span></span><br><span class="line"></span><br><span class="line">		<span class="comment"># reformat the input text - concat the generated text and search results with input text, and serve as the next input text</span></span><br><span class="line">		search_text = curr_search_template.<span class="built_in">format</span>(output_text=output_text.strip(<span class="string">'\n'</span>), search_results=search_results)</span><br><span class="line">		prompt += search_text</span><br><span class="line">		cnt += <span class="number">1</span></span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> cnt &gt;=<span class="number">5</span>:</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		<span class="comment"># print(search_text)</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> {<span class="string">'error'</span>: <span class="string">'Reach max search rounds (5), force exit.'</span>}</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>


<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">model_path = <span class="string">'Alibaba-NLP/ZeroSearch_google_V2_Qwen2.5_7B_Instruct'</span></span><br><span class="line"><span class="comment"># Initialize the tokenizer and model</span></span><br><span class="line">tokenizer = transformers.AutoTokenizer.from_pretrained(model_path)</span><br><span class="line">model = transformers.AutoModelForCausalLM.from_pretrained(model_path, torch_dtype=torch.bfloat16).to(<span class="string">'cuda:1'</span>)</span><br><span class="line"></span><br><span class="line">question = <span class="string">"What is the capital of France?"</span></span><br><span class="line">output_text = run_agentic_search(model, tokenizer, question, retrieve_from_bocha, {<span class="string">'topk'</span>: <span class="number">5</span>})</span><br><span class="line"><span class="built_in">print</span>(output_text)</span><br></pre></td></tr></table></figure></div>

<div class="code-container" data-rel="Markdown"><figure class="iseeu highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;|im<span class="emphasis">_start|&gt;system</span></span><br><span class="line"><span class="emphasis">You are Qwen, created by Alibaba Cloud. You are a helpful assistant.&lt;|im_</span>end|&gt;</span><br><span class="line">&lt;|im<span class="emphasis">_start|&gt;user</span></span><br><span class="line"><span class="emphasis">Answer the given question. You must conduct reasoning inside <span class="language-xml"><span class="tag">&lt;<span class="name">think</span>&gt;</span></span> and <span class="language-xml"><span class="tag">&lt;/<span class="name">think</span>&gt;</span></span> first every time you get new information. After reasoning, if you find you lack some knowledge, you can call a search engine by <span class="language-xml"><span class="tag">&lt;<span class="name">search</span>&gt;</span></span> query <span class="language-xml"><span class="tag">&lt;/<span class="name">search</span>&gt;</span></span> and it will return the top searched results between <span class="language-xml"><span class="tag">&lt;<span class="name">information</span>&gt;</span></span> and <span class="language-xml"><span class="tag">&lt;/<span class="name">information</span>&gt;</span></span>. You can search as many times as your want. If you find no further external knowledge needed, you can directly provide the answer inside <span class="language-xml"><span class="tag">&lt;<span class="name">answer</span>&gt;</span></span> and <span class="language-xml"><span class="tag">&lt;/<span class="name">answer</span>&gt;</span></span>, without detailed illustrations. For example, <span class="language-xml"><span class="tag">&lt;<span class="name">answer</span>&gt;</span></span> Beijing <span class="language-xml"><span class="tag">&lt;/<span class="name">answer</span>&gt;</span></span>. Question: What is the capital of France?</span></span><br><span class="line"><span class="emphasis">&lt;|im_</span>end|&gt;</span><br><span class="line">&lt;|im<span class="emphasis">_start|&gt;assistant</span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">think</span>&gt;</span></span> The question is about the capital of France. I need to search for the capital of France. <span class="language-xml"><span class="tag">&lt;/<span class="name">think</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">search</span>&gt;</span></span> capital of France <span class="language-xml"><span class="tag">&lt;/<span class="name">search</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">information</span>&gt;</span></span>Doc 1: Study now See answers (2) Best Answer Copy The capital of France is Paris (Frankreich is the German namefor France) Wiki User ∙ 15 y ago This answer is:  Helpful ( 0 )  Not Helpful ( 0 ) Add a Comment More answers AnswerBot ∙ 8 mo ago Copy The capital of Frankreich is Paris. This answer is:  Helpful ( 0 )  Not Helpful ( 0 ) Add a Comment Add your answer: Earn + 20 pts Q: What is the capital of Frankreich? Write your answer... Submit Still have questions? Find more answers Ask your question Continue Learning about Linguistics Related questions What actors and actresses appeared in Gott in Frankreich - 2005? How do you say France in German? What is France called in gemany? How do you say France in Colognian?</span></span><br><span class="line"><span class="emphasis">Doc 2: 试卷征集 加入会员 操作视频 What is the capital of France? What is the capital of France? 【考点】 复合句 . 【答案】 What is the capital of France? 【解答】 【点评】 声明:本试题解析著作权属菁优网所有,未经书面同意,不得复制发布。 相似题 1. There are some lakes in the village. (改成一般疑问句) 组卷:3 引用:1 难度:0.0 2. These pants are short.( 同义句 ) These are 组卷:65 引用:4 难度:0.3 3. I am 10 years old this year . (用three years ago代替划线部分) 组卷:1 引用:1 难度:0.0 深圳市菁优智慧教育股份有限公司 ©2010-2025 jyeoo.com 版权所有 APP开发者:深圳市菁优智慧教育股份有限公司 | 应用名称:菁优网 | 应用版本:5.0.7 | 隐私协议 | 第三方SDK | 用户服务条款</span></span><br><span class="line"><span class="emphasis">Doc 3: Paris is the capital of my country</span></span><br><span class="line"><span class="emphasis">查看翻译 </span></span><br><span class="line"><span class="emphasis">这个答案有帮助吗?</span></span><br><span class="line"><span class="emphasis">That's basic geography knowledge ^^'</span></span><br><span class="line"><span class="emphasis">@Nasdil  ça me casse les couilles, ce genre de question</span></span><br><span class="line"><span class="emphasis"> on est bien d'accord... déjà que c'est le niveau 0 de la culture générale, mais en plus, même en étant inculte, 2 secondes sur google suffisent !</span></span><br><span class="line"><span class="emphasis">@Nasdil  oui, bien sûr !! Ça ne coûte rien. </span></span><br><span class="line"><span class="emphasis">Je ne comprends pas</span></span><br><span class="line"><span class="emphasis">surtout que le pays c'est pas french mais France Lol Mm le niveau anglais est pas au rdv</span></span><br><span class="line"><span class="emphasis">1. French is a language and languages can't have capitals.</span></span><br><span class="line"><span class="emphasis">2. Paris is famous, you should know that or at least look on google.</span></span><br><span class="line"><span class="emphasis">这个答案有帮助吗?</span></span><br><span class="line"><span class="emphasis">Où est la capitale de la France ?</span></span><br><span class="line"><span class="emphasis">这个答案有帮助吗?</span></span><br><span class="line"><span class="emphasis">the capital of france is Paris,do you like the eiffel tower?</span></span><br><span class="line"><span class="emphasis">Doc 4: 法国的首都是什么?</span></span><br><span class="line"><span class="emphasis">答:巴黎 Paris</span></span><br><span class="line"><span class="emphasis">解析看不懂?免费查看同类题视频解析</span></span><br><span class="line"><span class="emphasis">Doc 5: 关于 法国  的问题</span></span><br><span class="line"><span class="emphasis">what is the capital of France???</span></span><br><span class="line"><span class="emphasis">can you send me pics of paris</span></span><br><span class="line"><span class="emphasis">Sorry, I don't have pics of Paris</span></span><br><span class="line"><span class="emphasis">这个答案有帮助吗?</span></span><br><span class="line"><span class="emphasis"> 具体的国家或地区 印度 </span></span><br><span class="line"><span class="emphasis">it's ok...    </span></span><br><span class="line"><span class="emphasis">查看翻译 </span></span><br><span class="line"><span class="emphasis"> 具体的国家或地区 法国 </span></span><br><span class="line"><span class="emphasis">Here you go</span></span><br><span class="line"><span class="emphasis">这个答案有帮助吗?</span></span><br><span class="line"><span class="emphasis">thank you @haibaraaa  , it's so beautiful            </span></span><br><span class="line"><span class="emphasis">这个答案有帮助吗?</span></span><br><span class="line"><span class="emphasis">这个答案有帮助吗?</span></span><br><span class="line"><span class="emphasis">这个答案有帮助吗?</span></span><br><span class="line"><span class="emphasis">这个答案有帮助吗?</span></span><br><span class="line"><span class="emphasis">你知道如何提升自己的外语能力吗❓只需写下外语文章并让母语使用者更正!</span></span><br><span class="line"><span class="emphasis">使用HiNative,免费让母语使用者帮你订正文章✍️✨</span></span><br><span class="line"><span class="emphasis"> 注册新帐户<span class="language-xml"><span class="tag">&lt;/<span class="name">information</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">think</span>&gt;</span></span> From the information provided, the capital of France is Paris. <span class="language-xml"><span class="tag">&lt;/<span class="name">think</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="language-xml"><span class="tag">&lt;<span class="name">answer</span>&gt;</span></span> Paris <span class="language-xml"><span class="tag">&lt;/<span class="name">answer</span>&gt;</span></span>&lt;|im_</span>end|&gt;</span><br></pre></td></tr></table></figure></div>

<p>国内搜索引擎结果真是让人无语</p>
<h2 id="text-拆分"><a href="#text-拆分" class="headerlink" title="text 拆分"></a>text 拆分</h2><p>以下函数是将 已经是 chat template 化的 str，重新组织为 messages。</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">pattern_pairs_qwen = [</span><br><span class="line">    (<span class="string">"system"</span>,    <span class="string">r"(?s)^\s*&lt;\|im_start\|&gt;system\s*"</span>,    <span class="string">r"\s*&lt;\|im_end\|&gt;"</span>),</span><br><span class="line">    (<span class="string">"user"</span>,      <span class="string">r"(?s)^\s*&lt;\|im_start\|&gt;user\s*"</span>,      <span class="string">r"\s*&lt;\|im_end\|&gt;"</span>),</span><br><span class="line">    (<span class="string">"assistant"</span>, <span class="string">r"(?s)^\s*&lt;\|im_start\|&gt;assistant\s*"</span>, <span class="string">r"\s*&lt;\|im_end\|&gt;"</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reverse_chat_template</span>(<span class="params">text, pattern_pairs=pattern_pairs_qwen</span>):</span><br><span class="line">    msgs, idx = [], <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> idx &lt; <span class="built_in">len</span>(text):</span><br><span class="line">        <span class="comment"># 跳过段落间的空白字符</span></span><br><span class="line">        <span class="keyword">while</span> idx &lt; <span class="built_in">len</span>(text) <span class="keyword">and</span> text[idx].isspace():</span><br><span class="line">            idx += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> role, start_pat, end_pat <span class="keyword">in</span> pattern_pairs:</span><br><span class="line">            m = re.<span class="keyword">match</span>(start_pat, text[idx:])</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> m:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            start_pos = idx + m.end()              <span class="comment"># content 起点</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> end_pat:                            <span class="comment"># 找 &lt;|im_end|&gt;</span></span><br><span class="line">                end_m = re.search(end_pat, text[start_pos:])</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> end_m:                      <span class="comment"># 理论上不会发生</span></span><br><span class="line">                    content_end = end_pos = <span class="built_in">len</span>(text)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    content_end = start_pos + end_m.start()</span><br><span class="line">                    end_pos     = start_pos + end_m.end()   <span class="comment"># 关键：跨过 END 标记</span></span><br><span class="line">            <span class="keyword">else</span>:                                  <span class="comment"># 无显式 END（几乎不用）</span></span><br><span class="line">                end_pos = content_end = <span class="built_in">len</span>(text)</span><br><span class="line"></span><br><span class="line">            msgs.append({<span class="string">"role"</span>: role,</span><br><span class="line">                         <span class="string">"content"</span>: text[start_pos:content_end].rstrip()})</span><br><span class="line">            idx = end_pos                          <span class="comment"># 继续下一段</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 没一个 pattern 命中，避免死循环</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> msgs</span><br><span class="line"></span><br><span class="line">msgs = reverse_chat_template(output_text, pattern_pairs=pattern_pairs_qwen)</span><br><span class="line"><span class="built_in">print</span>(msgs)</span><br><span class="line"><span class="built_in">print</span>(msgs[-<span class="number">1</span>][<span class="string">'content'</span>])</span><br></pre></td></tr></table></figure></div>

<div class="code-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span><span class="punctuation">{</span>'role'<span class="punctuation">:</span> 'system'<span class="punctuation">,</span></span><br><span class="line">  'content'<span class="punctuation">:</span> 'You are Qwen<span class="punctuation">,</span> created by Alibaba Cloud. You are a helpful assistant.'<span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line"> <span class="punctuation">{</span>'role'<span class="punctuation">:</span> 'user'<span class="punctuation">,</span></span><br><span class="line">  'content'<span class="punctuation">:</span> 'Answer the given question. You must conduct reasoning inside &lt;think&gt; and &lt;/think&gt; first every time you get new information. After reasoning<span class="punctuation">,</span> if you find you lack some knowledge<span class="punctuation">,</span> you can call a search engine by &lt;search&gt; query &lt;/search&gt; and it will return the top searched results between &lt;information&gt; and &lt;/information&gt;. You can search as many times as your want. If you find no further external knowledge needed<span class="punctuation">,</span> you can directly provide the answer inside &lt;answer&gt; and &lt;/answer&gt;<span class="punctuation">,</span> without detailed illustrations. For example<span class="punctuation">,</span> &lt;answer&gt; Beijing &lt;/answer&gt;. Question<span class="punctuation">:</span> What is the capital of France?'<span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line"> <span class="punctuation">{</span>'role'<span class="punctuation">:</span> 'assistant'<span class="punctuation">,</span></span><br><span class="line">  'content'<span class="punctuation">:</span> <span class="string">"&lt;think&gt; The question is about the capital of France. I need to search for the capital of France. &lt;/think&gt;\n&lt;search&gt; capital of France &lt;/search&gt;\n&lt;information&gt;Doc 1: Study now See answers (2) Best Answer Copy The capital of France is Paris (Frankreich is the German namefor France) Wiki User ∙ 15 y ago This answer is: \uf44d Helpful ( 0 ) \uf44e Not Helpful ( 0 ) Add a Comment More answers AnswerBot ∙ 8 mo ago Copy The capital of Frankreich is Paris. This answer is: \uf44d Helpful ( 0 ) \uf44e Not Helpful ( 0 ) Add a Comment Add your answer: Earn + 20 pts Q: What is the capital of Frankreich? Write your answer... Submit Still have questions? Find more answers Ask your question Continue Learning about Linguistics Related questions What actors and actresses appeared in Gott in Frankreich - 2005? How do you say France in German? What is France called in gemany? How do you say France in Colognian?\nDoc 2: 试卷征集 加入会员 操作视频 What is the capital of France? What is the capital of France? 【考点】 复合句 . 【答案】 What is the capital of France? 【解答】 【点评】 声明:本试题解析著作权属菁优网所有,未经书面同意,不得复制发布。 相似题 1. There are some lakes in the village. (改成一般疑问句) 组卷:3 引用:1 难度:0.0 2. These pants are short.( 同义句 ) These are 组卷:65 引用:4 难度:0.3 3. I am 10 years old this year . (用three years ago代替划线部分) 组卷:1 引用:1 难度:0.0 深圳市菁优智慧教育股份有限公司 ©2010-2025 jyeoo.com 版权所有 APP开发者:深圳市菁优智慧教育股份有限公司 | 应用名称:菁优网 | 应用版本:5.0.7 | 隐私协议 | 第三方SDK | 用户服务条款\nDoc 3: Paris is the capital of my country\n查看翻译 \n这个答案有帮助吗?\nThat's basic geography knowledge ^^'\n@Nasdil  ça me casse les couilles, ce genre de question\n on est bien d'accord... déjà que c'est le niveau 0 de la culture générale, mais en plus, même en étant inculte, 2 secondes sur google suffisent !\n@Nasdil  oui, bien sûr !! Ça ne coûte rien. \nJe ne comprends pas\nsurtout que le pays c'est pas french mais France Lol Mm le niveau anglais est pas au rdv\n1. French is a language and languages can't have capitals.\n2. Paris is famous, you should know that or at least look on google.\n这个答案有帮助吗?\nOù est la capitale de la France ?\n这个答案有帮助吗?\nthe capital of france is Paris,do you like the eiffel tower?\nDoc 4: 法国的首都是什么?\n答:巴黎 Paris\n解析看不懂?免费查看同类题视频解析\nDoc 5: 关于 法国  的问题\nwhat is the capital of France???\ncan you send me pics of paris\nSorry, I don't have pics of Paris\n这个答案有帮助吗?\n 具体的国家或地区 印度 \nit's ok...    \n查看翻译 \n 具体的国家或地区 法国 \nHere you go\n这个答案有帮助吗?\nthank you @haibaraaa  , it's so beautiful            \n这个答案有帮助吗?\n这个答案有帮助吗?\n这个答案有帮助吗?\n这个答案有帮助吗?\n你知道如何提升自己的外语能力吗❓只需写下外语文章并让母语使用者更正!\n使用HiNative,免费让母语使用者帮你订正文章✍️✨\n 注册新帐户&lt;/information&gt;\n&lt;think&gt; From the information provided, the capital of France is Paris. &lt;/think&gt;\n&lt;answer&gt; Paris &lt;/answer&gt;"</span><span class="punctuation">}</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure></div>

<p>以上是完整的 messages，以下是仅模型生成部分。</p>
<div class="code-container" data-rel="Markdown"><figure class="iseeu highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">think</span>&gt;</span></span> The question is about the capital of France. I need to search for the capital of France. <span class="language-xml"><span class="tag">&lt;/<span class="name">think</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">search</span>&gt;</span></span> capital of France <span class="language-xml"><span class="tag">&lt;/<span class="name">search</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">information</span>&gt;</span></span>Doc 1: Study now See answers (2) Best Answer Copy The capital of France is Paris (Frankreich is the German namefor France) Wiki User ∙ 15 y ago This answer is:  Helpful ( 0 )  Not Helpful ( 0 ) Add a Comment More answers AnswerBot ∙ 8 mo ago Copy The capital of Frankreich is Paris. This answer is:  Helpful ( 0 )  Not Helpful ( 0 ) Add a Comment Add your answer: Earn + 20 pts Q: What is the capital of Frankreich? Write your answer... Submit Still have questions? Find more answers Ask your question Continue Learning about Linguistics Related questions What actors and actresses appeared in Gott in Frankreich - 2005? How do you say France in German? What is France called in gemany? How do you say France in Colognian?</span><br><span class="line">Doc 2: 试卷征集 加入会员 操作视频 What is the capital of France? What is the capital of France? 【考点】 复合句 . 【答案】 What is the capital of France? 【解答】 【点评】 声明:本试题解析著作权属菁优网所有,未经书面同意,不得复制发布。 相似题 1. There are some lakes in the village. (改成一般疑问句) 组卷:3 引用:1 难度:0.0 2. These pants are short.( 同义句 ) These are 组卷:65 引用:4 难度:0.3 3. I am 10 years old this year . (用three years ago代替划线部分) 组卷:1 引用:1 难度:0.0 深圳市菁优智慧教育股份有限公司 ©2010-2025 jyeoo.com 版权所有 APP开发者:深圳市菁优智慧教育股份有限公司 | 应用名称:菁优网 | 应用版本:5.0.7 | 隐私协议 | 第三方SDK | 用户服务条款</span><br><span class="line">Doc 3: Paris is the capital of my country</span><br><span class="line">查看翻译 </span><br><span class="line">这个答案有帮助吗?</span><br><span class="line">That's basic geography knowledge ^^'</span><br><span class="line">@Nasdil  ça me casse les couilles, ce genre de question</span><br><span class="line"> on est bien d'accord... déjà que c'est le niveau 0 de la culture générale, mais en plus, même en étant inculte, 2 secondes sur google suffisent !</span><br><span class="line">@Nasdil  oui, bien sûr !! Ça ne coûte rien. </span><br><span class="line">Je ne comprends pas</span><br><span class="line">surtout que le pays c'est pas french mais France Lol Mm le niveau anglais est pas au rdv</span><br><span class="line"><span class="bullet">1.</span> French is a language and languages can't have capitals.</span><br><span class="line"><span class="bullet">2.</span> Paris is famous, you should know that or at least look on google.</span><br><span class="line">这个答案有帮助吗?</span><br><span class="line">Où est la capitale de la France ?</span><br><span class="line">这个答案有帮助吗?</span><br><span class="line">the capital of france is Paris,do you like the eiffel tower?</span><br><span class="line">Doc 4: 法国的首都是什么?</span><br><span class="line">答:巴黎 Paris</span><br><span class="line">解析看不懂?免费查看同类题视频解析</span><br><span class="line">Doc 5: 关于 法国  的问题</span><br><span class="line">what is the capital of France???</span><br><span class="line">can you send me pics of paris</span><br><span class="line">Sorry, I don't have pics of Paris</span><br><span class="line">这个答案有帮助吗?</span><br><span class="line"> 具体的国家或地区 印度 </span><br><span class="line">it's ok...    </span><br><span class="line">查看翻译 </span><br><span class="line"> 具体的国家或地区 法国 </span><br><span class="line">Here you go</span><br><span class="line">这个答案有帮助吗?</span><br><span class="line">thank you @haibaraaa  , it's so beautiful            </span><br><span class="line">这个答案有帮助吗?</span><br><span class="line">这个答案有帮助吗?</span><br><span class="line">这个答案有帮助吗?</span><br><span class="line">这个答案有帮助吗?</span><br><span class="line">你知道如何提升自己的外语能力吗❓只需写下外语文章并让母语使用者更正!</span><br><span class="line">使用HiNative,免费让母语使用者帮你订正文章✍️✨</span><br><span class="line"> 注册新帐户<span class="language-xml"><span class="tag">&lt;/<span class="name">information</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">think</span>&gt;</span></span> From the information provided, the capital of France is Paris. <span class="language-xml"><span class="tag">&lt;/<span class="name">think</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">answer</span>&gt;</span></span> Paris <span class="language-xml"><span class="tag">&lt;/<span class="name">answer</span>&gt;</span></span></span><br></pre></td></tr></table></figure></div>


<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 提取 answer</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_answer</span>(<span class="params">text</span>):</span><br><span class="line">	pattern = re.<span class="built_in">compile</span>(<span class="string">r"&lt;answer&gt;(.*?)&lt;/answer&gt;"</span>, re.DOTALL)</span><br><span class="line">	matches = pattern.findall(text)</span><br><span class="line">	<span class="keyword">if</span> matches:</span><br><span class="line">		<span class="keyword">return</span> matches[-<span class="number">1</span>].strip(<span class="string">'\n'</span>).strip()</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">	</span><br><span class="line">final_answer = get_answer(output_text)</span><br><span class="line"><span class="built_in">print</span>(final_answer)</span><br></pre></td></tr></table></figure></div>

<p>Paris</p>

		</div>

		

		
		<ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden">
			
			<li class="tag-item mx-0.5">
				<a href="/tags/Agent/">#Agent</a>&nbsp;
			</li>
			
		</ul>
		

		

		
		<div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
			
			
			<div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="next" rel="next" href="/2025/08/02/Reinforcement_learning/GRPO_trainer_reasoning_model/">
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item">GRPO trainer 训练推理模型</span>
						<span class="post-nav-item">Next posts</span>
					</span>
					<span class="right arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-right"></i>
					</span>
				</a>
			</div>
			
		</div>
		


		
		<div class="comment-container px-2 sm:px-6 md:px-8 pb-8">
			<div class="comments-container mt-10 w-full ">
    <div id="comment-anchor" class="w-full h-2.5"></div>
    <div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">
        Comments
    </div>
    

        
            
    <div id="waline"></div>
    <script type="module" data-swup-reload-script>
      import { init } from '/js/libs/waline.mjs';

      function loadWaline() {
        init({
          el: '#waline',
          serverURL: 'https://example.example.com',
          lang: 'zh-CN',
          dark: 'body[class~="dark-mode"]',
          reaction: false,
          requiredMeta: ['nick', 'mail'],
          emoji: [],
          
          
        });
      }

      if (typeof swup !== 'undefined') {
        loadWaline();
      } else {
        window.addEventListener('DOMContentLoaded', loadWaline);
      }
    </script>



        
    
</div>

		</div>
		
	</div>

	
	<div class="toc-content-container">
		<div class="post-toc-wrap">
	<div class="post-toc">
		<div class="toc-title">On this page</div>
		<div class="page-title">Agentic search/RAG pipeline</div>
		<ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E5%87%BD%E6%95%B0%E5%AE%9A%E4%B9%89"><span class="nav-text">搜索引擎函数定义</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#google"><span class="nav-text">google</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bocha"><span class="nav-text">bocha</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#agentic-search"><span class="nav-text">agentic search</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#text-%E6%8B%86%E5%88%86"><span class="nav-text">text 拆分</span></a></li></ol>

	</div>
</div>
	</div>
	
</div>
			</div>

			
		</div>

		<div class="main-content-footer">
			<footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
            2025&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">Peng Xia</a>
            
                
                <p class="post-count space-x-0.5">
                    <span>
                        50 posts in total
                    </span>
                    
                        <span>
                            162.9k words in total
                        </span>
                    
                </p>
            
        </div>
        
            <script data-swup-reload-script src="https://cn.vercount.one/js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">VISITOR COUNT</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">TOTAL PAGE VIEWS</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.8.2</a></span>
        </div>
        
        
        
        
        
    </div>  
</footer>
		</div>
	</div>

	
	<div class="post-tools">
		<div class="post-tools-container">
	<ul class="article-tools-list">
		<!-- TOC aside toggle -->
		
		<li class="right-bottom-tools page-aside-toggle">
			<i class="fa-regular fa-outdent"></i>
		</li>
		

		<!-- go comment -->
		
		<li class="go-comment">
			<i class="fa-regular fa-comments"></i>
		</li>
		
	</ul>
</div>
	</div>
	

	<div class="right-side-tools-container">
		<div class="side-tools-container">
	<ul class="hidden-tools-list">
		<li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-plus"></i>
		</li>

		<li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-minus"></i>
		</li>

		<li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
			<i class="fa-regular fa-moon"></i>
		</li>

		<!-- rss -->
		

		

		<li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
			<i class="fa-regular fa-arrow-down"></i>
		</li>
	</ul>

	<ul class="visible-tools-list">
		<li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
			<i class="fa-regular fa-cog fa-spin"></i>
		</li>
		
		<li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
			<i class="arrow-up fas fa-arrow-up"></i>
			<span class="percent"></span>
		</li>
		
		
	</ul>
</div>
	</div>

	<div class="image-viewer-container">
	<img src="">
</div>

	
	<div class="search-pop-overlay">
	<div class="popup search-popup">
		<div class="search-header">
			<span class="search-input-field-pre">
				<i class="fa-solid fa-keyboard"></i>
			</span>
			<div class="search-input-container">
				<input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input">
			</div>
			<span class="popup-btn-close">
				<i class="fa-solid fa-times"></i>
			</span>
		</div>
		<div id="search-result">
			<div id="no-result">
				<i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
			</div>
		</div>
	</div>
</div>
	

</main>



<script src="/js/build/libs/Swup.min.js"></script>

<script src="/js/build/libs/SwupSlideTheme.min.js"></script>

<script src="/js/build/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/build/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/build/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/build/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>




	
<script src="/js/build/tools/imageViewer.js" type="module"></script>

<script src="/js/build/utils.js" type="module"></script>

<script src="/js/build/main.js" type="module"></script>

<script src="/js/build/layouts/navbarShrink.js" type="module"></script>

<script src="/js/build/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/build/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/build/layouts/categoryList.js" type="module"></script>



    
<script src="/js/build/tools/localSearch.js" type="module"></script>




    
<script src="/js/build/tools/codeBlock.js" type="module"></script>




    
<script src="/js/build/layouts/lazyload.js" type="module"></script>






  
<script src="/js/build/libs/Typed.min.js"></script>

  
<script src="/js/build/plugins/typed.js" type="module"></script>








    
<script src="/js/build/libs/anime.min.js"></script>





    
<script src="/js/build/tools/tocToggle.js" type="module" data-swup-reload-script=""></script>

<script src="/js/build/layouts/toc.js" type="module" data-swup-reload-script=""></script>

<script src="/js/build/plugins/tabs.js" type="module" data-swup-reload-script=""></script>




<script src="/js/build/libs/moment-with-locales.min.js" data-swup-reload-script=""></script>


<script src="/js/build/layouts/essays.js" type="module" data-swup-reload-script=""></script>





	
</body>

</html>