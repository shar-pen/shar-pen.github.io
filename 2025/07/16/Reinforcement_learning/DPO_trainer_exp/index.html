<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="Peng Xia">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://example.com/2025/07/16/reinforcement_learning/dpo_trainer_exp/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
    
    
        
        <meta name="description" content="Hexo Theme Redefine, Redefine Your Hexo Journey.">
<meta property="og:type" content="article">
<meta property="og:title" content="DPO trainer - by trl">
<meta property="og:url" content="http://example.com/2025/07/16/Reinforcement_learning/DPO_trainer_exp/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Hexo Theme Redefine, Redefine Your Hexo Journey.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/redefine-og.webp">
<meta property="article:published_time" content="2025-07-16T14:25:55.256Z">
<meta property="article:modified_time" content="2025-07-22T15:05:10.863Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/redefine-og.webp">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/github-color-svgrepo-com.svg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/github-color-svgrepo-com.svg">
    <meta name="theme-color" content="#FFD700">
    <link rel="shortcut icon" href="/images/github-color-svgrepo-com.svg">
    <!--- Page Info-->
    
    <title>
        
            DPO trainer - by trl | Sharpen&#39;s Blogs
        
    </title>

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">


    <!--- Inject Part-->
    

    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/css/build/tailwind.css">

    

    
<link rel="stylesheet" href="/fonts/GeistMono/geist-mono.css">

    
<link rel="stylesheet" href="/fonts/Geist/geist.css">

    <!--- Font Part-->
    
        <link href="https://fonts.googleapis.com/css2?family=Lora" rel="stylesheet">
    
    
    
    
    
    

    <script id="hexo-configurations">
    window.config = {"hostname":"example.com","root":"/","language":"en","path":"search.json"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"delete_mask":false,"title_alignment":"left","headings_top_spacing":{"h1":"3.2rem","h2":"2.4rem","h3":"1.9rem","h4":"1.6rem","h5":"1.4rem","h6":"1.3rem"}},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":false,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","highlight_theme":{"light":"github","dark":"vs2015"},"font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":false,"default":"cc_by_nc_sa"},"lazyload":true,"pangu_js":false,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#FFD700","secondary":null,"default_mode":"light"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null},"title":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"website_counter":{"url":"https://cn.vercount.one/js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"preloader":{"enable":false,"custom_message":null},"open_graph":{"enable":true,"image":"/images/redefine-og.webp","description":"Hexo Theme Redefine, Redefine Your Hexo Journey."},"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/dune.jpg","dark":"/images/dune.jpg"},"title":"Sharpen's Blogs","subtitle":{"text":["Just regularly appending some blogs here, to keep my memory fresh and mind straight.","Here I am. ","Do not go gentle into that good night. "],"hitokoto":{"enable":false,"show_author":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":true,"family":"Lora","url":"https://fonts.googleapis.com/css2?family=Lora"},"social_links":{"enable":false,"style":"default","links":{"github":"https://github.com/shar-pen","instagram":null,"zhihu":null,"twitter":null,"email":"xiapeng21011@mail.ustc.edu.cn"},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null,"lrc":null}]},"mermaid":{"enable":false,"version":"11.4.1"}},"version":"2.8.2","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"width":{"home":"1200px","pages":"1000px"},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Categories":{"path":"/categories","icon":"fa-solid fa-folder"},"About":{"path":"/about","icon":"fa-regular fa-user"},"Links":{"icon":"fa-regular fa-link","submenus":{"Github":"https://github.com/shar-pen","Blog":"https://github.com/shar-pen.github.io","CSDN":"https://blog.csdn.net/the_3rd_bomb"}}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":":)","show_on_mobile":true,"links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"path":"/tags","icon":"fa-regular fa-tags"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"}}},"article_date_format":"YYYY-MM-DD","excerpt_length":200,"categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":null};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 7.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>



<body>
	<div class="progress-bar-container">
	

	
	<span class="pjax-progress-bar"></span>
	<!--        <span class="swup-progress-icon">-->
	<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
	<!--        </span>-->
	
</div>

<main class="page-container" id="swup">

	

	<div class="main-content-container flex flex-col justify-between min-h-dvh">
		<div class="main-content-header">
			<header class="navbar-container px-6 md:px-12">
    <div class="navbar-content transition-navbar ">
        <div class="left">
            
                <a class="logo-image h-8 w-8 sm:w-10 sm:h-10 mr-3" href="/">
                    <img src="/images/github-color-svgrepo-com.svg" class="w-full h-full rounded-sm">
                </a>
            
            <a class="logo-title" href="/">
                
                Sharpen&#39;s Blogs
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    HOME
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/archives"
                                        >
                                    <i class="fa-regular fa-archive fa-fw"></i>
                                    ARCHIVES
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/categories"
                                        >
                                    <i class="fa-solid fa-folder fa-fw"></i>
                                    CATEGORIES
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/about"
                                        >
                                    <i class="fa-regular fa-user fa-fw"></i>
                                    ABOUT
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown"
                                   href="#"
                                        onClick=&#34;return false;&#34;>
                                    <i class="fa-regular fa-link fa-fw"></i>
                                    LINKS
                                    <i class="fa-solid fa-chevron-down fa-fw"></i>
                                </a>

                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://github.com/shar-pen">
                                                    GITHUB
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://github.com/shar-pen.github.io">
                                                    BLOG
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://blog.csdn.net/the_3rd_bomb">
                                                    CSDN
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i>
                    </div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                HOME
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/archives"
                        >
                            <span>
                                ARCHIVES
                            </span>
                            
                                <i class="fa-regular fa-archive fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/categories"
                        >
                            <span>
                                CATEGORIES
                            </span>
                            
                                <i class="fa-solid fa-folder fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/about"
                        >
                            <span>
                                ABOUT
                            </span>
                            
                                <i class="fa-regular fa-user fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item-sub text-base my-1.5 flex flex-col w-full">
                        
                        <div class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary cursor-pointer text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                             navbar-data-toggle="submenu-Links"
                        >
                            <span>
                                LINKS
                            </span>
                            
                                <i class="fa-solid fa-chevron-right fa-sm fa-fw transition-all"></i>
                            
                        </div>
                        

                        
                            <div class="flex-col items-start px-2 py-2 hidden" data-target="submenu-Links">
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://github.com/shar-pen">GITHUB</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://github.com/shar-pen.github.io">BLOG</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://blog.csdn.net/the_3rd_bomb">CSDN</a>
                                    </div>
                                
                            </div>
                        
                    </li>
            

            
            
                
                    
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/tags"
                        >
                            <span>Tags</span>
                            <i class="fa-regular fa-tags fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">9</div>
        <div class="label text-third-text-color text-sm">Tags</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">11</div>
        <div class="label text-third-text-color text-sm">Categories</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">46</div>
        <div class="label text-third-text-color text-sm">Posts</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


		</div>

		<div class="main-content-body transition-fade-up">
			

			<div class="main-content">
				<div class="post-page-container flex relative justify-between box-border w-full h-full">
	<div class="article-content-container">

		<div class="article-title relative w-full">
			
			<div class="w-full flex items-center pt-6 justify-start">
				<h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">DPO trainer - by trl</h1>
			</div>
			
		</div>

		
		<div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
			<div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
				<img src="/images/avatar.jpg">
			</div>
			<div class="info flex flex-col justify-between">
				<div class="author flex items-center">
					<span class="name text-default-text-color text-lg font-semibold">Peng Xia</span>
					
				</div>
				<div class="meta-info">
					<div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2025-07-16 22:25:55</span>
        <span class="mobile">2025-07-16 22:25:55</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2025-07-22 23:05:10</span>
            <span class="mobile">2025-07-22 23:05:10</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/">强化学习</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>1.7k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>9 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

				</div>
			</div>
		</div>
		

		


		<div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
			<p>简单记录下用 trl 库的 DPO trainer 的训练效果，源码出自于 trl 官方 <a class="link" target="_blank" rel="noopener" href="https://huggingface.co/docs/trl/en/dpo_trainer">https://huggingface.co/docs/trl/en/dpo_trainer<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a> 给的示例代码。DPO trainer 的底层代码在之前的 DPO 复现的 blog 中提到过，这次就直接用 DPO trainer，不涉及任何底层代码。</p>
<h2 id="偏好数据集-preference-dataset"><a href="#偏好数据集-preference-dataset" class="headerlink" title="偏好数据集 preference dataset"></a>偏好数据集 preference dataset</h2><p>trl 中关于数据集有一个专门的介绍 <a class="link" target="_blank" rel="noopener" href="https://huggingface.co/docs/trl/main/en/dataset_formats%E3%80%82DPO">https://huggingface.co/docs/trl/main/en/dataset_formats。DPO<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a> 用的是 preference dataset，主要有两个字段 chosen 和 rejected。</p>
<div class="code-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"chosen"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">	<span class="punctuation">{</span></span><br><span class="line">	  <span class="attr">"content"</span><span class="punctuation">:</span> <span class="string">"Host a virtual panel discussion on the ethical implications of genetic engineering."</span><span class="punctuation">,</span></span><br><span class="line">	  <span class="attr">"role"</span><span class="punctuation">:</span> <span class="string">"user"</span></span><br><span class="line">	<span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">	<span class="punctuation">{</span></span><br><span class="line">	  <span class="attr">"content"</span><span class="punctuation">:</span> <span class="string">"Hello! I'm here to help you host a virtual panel discussion on the ethical implications of genetic engineering. This is a very important and timely topic, as genetic engineering has the potential to revolutionize many areas of our lives, from healthcare to agriculture. However, it also raises important ethical considerations, such as privacy concerns, potential discrimination, and the possibility of unintended consequences.\n\nTo begin, I'll provide a brief overview of genetic engineering. Genetic engineering involves the deliberate modification of an organism's genetic material to produce a desired trait or characteristic. This can be done using a variety of techniques, including gene editing and gene therapy. The field of genetic engineering is rapidly advancing, and it has the potential to treat diseases, improve crop yields, and even extend human lifespan.\n\nHowever, as with any powerful technology, there are potential risks and benefits to consider. The ethical implications of genetic engineering are complex and multifaceted, and they require careful consideration from experts in the field, as well as from the general public.\n\nTo explore these ethical implications, I've assembled a panel of experts who will share their insights and perspectives on this topic. Our panel includes:\n\n* Dr. Jane Smith, a leading geneticist who has made significant contributions to the field of gene editing.\n* Dr. John Doe, a bioethicist who has written extensively on the ethical implications of genetic engineering.\n* Ms. Susan Johnson, a patient advocate who has firsthand experience with genetic testing and gene therapy.\n* Mr. David Kim, a lawyer who specializes in intellectual property and privacy law as it relates to genetic information.\n\nI will now turn the floor over to our panelists, who will each provide their perspective on the ethical implications of genetic engineering. Please feel free to ask questions and engage in a respectful and constructive dialogue.\n\nDr. Jane Smith, could you begin by discussing the potential benefits of genetic engineering?\n\n(Please note that any responses should be socially unbiased and positive in nature, and should not include any harmful, unethical, racist, sexist, toxic, dangerous, or illegal content.)"</span><span class="punctuation">,</span></span><br><span class="line">	  <span class="attr">"role"</span><span class="punctuation">:</span> <span class="string">"assistant"</span></span><br><span class="line">	<span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"rejected"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">	<span class="punctuation">{</span></span><br><span class="line">	  <span class="attr">"content"</span><span class="punctuation">:</span> <span class="string">"Host a virtual panel discussion on the ethical implications of genetic engineering."</span><span class="punctuation">,</span></span><br><span class="line">	  <span class="attr">"role"</span><span class="punctuation">:</span> <span class="string">"user"</span></span><br><span class="line">	<span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">	<span class="punctuation">{</span></span><br><span class="line">	  <span class="attr">"content"</span><span class="punctuation">:</span> <span class="string">"Sure, I can definitely help you host a virtual panel discussion on the ethical implications of genetic engineering. Here's a suggested format for the discussion:\n\n1. Introduction:\nBegin by introducing the topic and the discussants who will participate in the panel discussion. They could include experts in genetic engineering, bioethics, philosophy, law, sociology, and science policy.\n\n2. Understanding Genetic Engineering:\nBefore delving into ethical implications, provide a brief overview of what genetic engineering is and its different types, such as gene editing, gene therapy, and gene drives. Also, discuss some of the current advancements and applications in genetic engineering.\n\n3. Ethical Implications:\nThe discussion can begin by exploring the ethical implications of genetic engineering. Here are some topics you can consider:\n\n   a. Privacy and Informed Consent: Explore the dangers of confidentiality breaches in genetic testing and the transparency issues surrounding the use of genetic information. Also, discuss the importance of informed consent.\n\n   b. Discrimination: Discuss the concern that genetic information could be used for discrimination in areas like health insurance or employment.\n\n   c. Inequality: Discuss the worry that access to genetic engineering will only be available to the rich, leading to social inequalities.\n\n   d. Designer Babies: Examine the ethical implications of genetic engineering for selecting physical, intellectual, or moral traits in children, often referred to as \"designer babies\".\n\n   e. Genetic Exploitation: Discuss how genetic engineering could be exploited for extreme human enhancement beyond normal human capacity or for non-therapeutic purposes.\n\n   f. Environmental Impact: Look at the potential environmental consequences of genetic engineering, including the risk of unintended spreading of modifications into non-target species, particularly through gene drives.\n\n   g. Responsibility: Discuss the ethical responsibility of both scientific researchers and society as a whole in the field of genetic engineering.\n\n4. Legal Implications:\nEach nation or jurisdiction has its own legal rules governing genetic engineering. Overview the current legal landscape of genetic engineering and discuss the potential need for new legislation to regulate the technology.\n\n5. Philosophical Implications:\nDiscuss philosophical questions like the nature of human identity, the meaning of human life, and whether genetic engineering might conflict or enhance the flourishing of human life.\n\n6. Q&amp;A:\nOpen the floor for questions from the audience. This is an excellent opportunity for the panel to address any pressing concerns or issues that were not discussed during the main part of the discussion.\n\nThis panel discussion should spark important conversations about the ethical implications of genetic engineering. The goal is to inform and engage the audience on these complex issues, stimulating further thought and debate outside of the panel discussion."</span><span class="punctuation">,</span></span><br><span class="line">	  <span class="attr">"role"</span><span class="punctuation">:</span> <span class="string">"assistant"</span></span><br><span class="line">	<span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"score_chosen"</span><span class="punctuation">:</span> <span class="number">8.0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"score_rejected"</span><span class="punctuation">:</span> <span class="number">8.0</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></table></figure></div>

<p>chosen 和 rejected 是有公共 messages 前缀的，底层会区分出公共部分，loss只会算到非公共部分 completion 上。</p>
<h2 id="代码和脚本"><a href="#代码和脚本" class="headerlink" title="代码和脚本"></a>代码和脚本</h2><p>以下是官网的代码</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># train_dpo.py</span></span><br><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"><span class="keyword">from</span> trl <span class="keyword">import</span> DPOConfig, DPOTrainer</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoModelForCausalLM, AutoTokenizer</span><br><span class="line"></span><br><span class="line">model = AutoModelForCausalLM.from_pretrained(<span class="string">"Qwen/Qwen2-0.5B-Instruct"</span>)</span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(<span class="string">"Qwen/Qwen2-0.5B-Instruct"</span>)</span><br><span class="line">train_dataset = load_dataset(<span class="string">"trl-lib/ultrafeedback_binarized"</span>, split=<span class="string">"train"</span>)</span><br><span class="line"></span><br><span class="line">training_args = DPOConfig(output_dir=<span class="string">"Qwen2-0.5B-DPO"</span>)</span><br><span class="line">trainer = DPOTrainer(model=model, args=training_args, processing_class=tokenizer, train_dataset=train_dataset)</span><br><span class="line">trainer.train()</span><br></pre></td></tr></table></figure></div>

<p>执行脚本</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">accelerate launch train_dpo.py</span><br></pre></td></tr></table></figure></div>



<p>我自己用了4张4090显卡(24GB显存)，增加了一些减少显存的处理，PS: flash_attention_2 和 lora 与 accelerate 有点冲突，我在网上没有找到对应的解决方法，所以还是用的全量微调。</p>
<p>以下是我的代码</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># train_dpo.py</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ[<span class="string">'WANDB_MODE'</span>] = <span class="string">'offline'</span>  <span class="comment"># Disable Weights &amp; Biases logging</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"><span class="keyword">from</span> trl <span class="keyword">import</span> DPOConfig, DPOTrainer</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoModelForCausalLM, AutoTokenizer</span><br><span class="line"></span><br><span class="line">model = AutoModelForCausalLM.from_pretrained(</span><br><span class="line">	<span class="string">"Qwen/Qwen2-0.5B-Instruct"</span>,</span><br><span class="line">	<span class="comment"># attn_implementation="flash_attention_2",</span></span><br><span class="line">	torch_dtype=torch.bfloat16,</span><br><span class="line">)</span><br><span class="line">model.config.use_cache = <span class="literal">False</span>  <span class="comment"># Disable cache for DPO training</span></span><br><span class="line">model.gradient_checkpointing_enable()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ====== peft 和 acclerate 同时使用会有问题，暂时注释掉 ======</span></span><br><span class="line"><span class="comment"># from peft import get_peft_model, LoraConfig, TaskType</span></span><br><span class="line"><span class="comment"># peft_config = LoraConfig(</span></span><br><span class="line"><span class="comment">#     task_type=TaskType.CAUSAL_LM,</span></span><br><span class="line"><span class="comment">#     inference_mode=False,</span></span><br><span class="line"><span class="comment">#     r=8,</span></span><br><span class="line"><span class="comment">#     lora_alpha=32,</span></span><br><span class="line"><span class="comment">#     lora_dropout=0.05,</span></span><br><span class="line"><span class="comment">#     target_modules=["q_proj", "v_proj"],  # Qwen 使用q_proj/v_proj</span></span><br><span class="line"><span class="comment"># )</span></span><br><span class="line"><span class="comment"># model = get_peft_model(model, peft_config)</span></span><br><span class="line"></span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(<span class="string">"Qwen/Qwen2-0.5B-Instruct"</span>)</span><br><span class="line">dataset = load_dataset(<span class="string">"trl-lib/ultrafeedback_binarized"</span>, split=<span class="string">"train[:10000]"</span>)</span><br><span class="line">dataset = dataset.train_test_split(test_size=<span class="number">0.1</span>, seed=<span class="number">42</span>)</span><br><span class="line">train_dataset = dataset[<span class="string">'train'</span>]</span><br><span class="line">test_dataset = dataset[<span class="string">'test'</span>]</span><br><span class="line"></span><br><span class="line">training_args = DPOConfig(</span><br><span class="line">	output_dir=<span class="string">"Qwen2-0.5B-DPO"</span>,</span><br><span class="line">	per_device_train_batch_size=<span class="number">2</span>,</span><br><span class="line">	per_device_eval_batch_size=<span class="number">4</span>,</span><br><span class="line">	max_length=<span class="number">1024</span>,</span><br><span class="line">	gradient_accumulation_steps=<span class="number">8</span>,</span><br><span class="line">	num_train_epochs=<span class="number">3</span>,</span><br><span class="line">	report_to=[<span class="string">'wandb'</span>],</span><br><span class="line">	bf16=<span class="literal">True</span>,</span><br><span class="line">	learning_rate=<span class="number">5e-5</span>,</span><br><span class="line">	lr_scheduler_type=<span class="string">"cosine"</span>,</span><br><span class="line">	logging_steps=<span class="number">1</span>,</span><br><span class="line">	eval_strategy=<span class="string">"steps"</span>,</span><br><span class="line">	eval_steps=<span class="number">100</span>,</span><br><span class="line">)</span><br><span class="line">trainer = DPOTrainer(</span><br><span class="line">	model=model, </span><br><span class="line">	args=training_args, </span><br><span class="line">	processing_class=tokenizer, </span><br><span class="line">	train_dataset=train_dataset,</span><br><span class="line">	eval_dataset=test_dataset,</span><br><span class="line">)</span><br><span class="line">trainer.train()</span><br></pre></td></tr></table></figure></div>

<p>以下是acclerate config</p>
<div class="code-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">compute_environment:</span> <span class="string">LOCAL_MACHINE</span></span><br><span class="line"><span class="attr">debug:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">distributed_type:</span> <span class="string">MULTI_GPU</span></span><br><span class="line"><span class="attr">downcast_bf16:</span> <span class="string">'no'</span></span><br><span class="line"><span class="attr">enable_cpu_affinity:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">gpu_ids:</span> <span class="number">4</span><span class="string">,5,6,7</span></span><br><span class="line"><span class="attr">machine_rank:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">main_training_function:</span> <span class="string">main</span></span><br><span class="line"><span class="attr">mixed_precision:</span> <span class="string">bf16</span></span><br><span class="line"><span class="attr">num_machines:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">num_processes:</span> <span class="number">4</span></span><br><span class="line"><span class="attr">rdzv_backend:</span> <span class="string">static</span></span><br><span class="line"><span class="attr">same_network:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">tpu_env:</span> []</span><br><span class="line"><span class="attr">tpu_use_cluster:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">tpu_use_sudo:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">use_cpu:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure></div>

<p>建议除非服务器配置类似，还是自己执行 accelerate config 创建配置</p>
<p>执行命令</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">accelerate launch --config_file config.yaml train_dpo.py</span><br></pre></td></tr></table></figure></div>

<p>需要自己调整下 max_length, 我用以下代码检视合理的长度限制</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">chosen_lengths = [<span class="built_in">len</span>(tokenizer.apply_chat_template(item[<span class="string">'chosen'</span>])) <span class="keyword">for</span> item <span class="keyword">in</span> train_dataset]</span><br><span class="line">rejected_lengths = [<span class="built_in">len</span>(tokenizer.apply_chat_template(item[<span class="string">'rejected'</span>])) <span class="keyword">for</span> item <span class="keyword">in</span> train_dataset]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"chosen 平均长度: <span class="subst">{<span class="built_in">sum</span>(chosen_lengths)/<span class="built_in">len</span>(chosen_lengths):<span class="number">.2</span>f}</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"rejected 平均长度: <span class="subst">{<span class="built_in">sum</span>(rejected_lengths)/<span class="built_in">len</span>(rejected_lengths):<span class="number">.2</span>f}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">plt.plot(chosen_lengths, label=<span class="string">'Chosen Lengths'</span>, alpha=<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> q <span class="keyword">in</span> [<span class="number">25</span>, <span class="number">50</span>, <span class="number">75</span>, <span class="number">80</span>, <span class="number">85</span>, <span class="number">90</span>, <span class="number">95</span>]:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">f"<span class="subst">{q}</span>th percentile:"</span>, np.percentile(chosen_lengths, q))</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p><img lazyload="" src="/images/loading.svg" data-src="/images/DPO_trainer_exp/image-20250716170439870.png" alt="image-20250716170439870"></p>
<p>这个图里是完整数据集的长度，结果可能看起来虚高，平均1500，实际没那么高，最好用百分位数看下</p>
<div class="code-container" data-rel="Markdown"><figure class="iseeu highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">25th percentile: 220.0</span><br><span class="line">50th percentile: 399.0</span><br><span class="line">75th percentile: 609.0</span><br><span class="line">80th percentile: 671.0</span><br><span class="line">85th percentile: 748.0</span><br><span class="line">90th percentile: 854.0</span><br><span class="line">95th percentile: 1009.0</span><br></pre></td></tr></table></figure></div>

<p>大部分数据都是 1000 以下，太长的就截断算了。</p>
<div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">plt.hist(chosen_lengths, bins=<span class="number">100</span>, alpha=<span class="number">0.7</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Length'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Frequency'</span>)</span><br><span class="line">plt.title(<span class="string">'Histogram of Chosen Lengths'</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure></div>

<p>用统计柱状图显示更合理点。</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/DPO_trainer_exp/image-20250716170901956.png" alt="image-20250716170901956"></p>
<h2 id="训练结果"><a href="#训练结果" class="headerlink" title="训练结果"></a>训练结果</h2><h3 id="10k数据"><a href="#10k数据" class="headerlink" title="10k数据"></a>10k数据</h3><p><img lazyload="" src="/images/loading.svg" data-src="/images/DPO_trainer_exp/exp_10k_1.png" alt="W&B Chart 7_16_2025, 10_55_36 AM"></p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/DPO_trainer_exp/exp_10k_2.png" alt="W&B Chart 7_16_2025, 10_55_04 AM"></p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/DPO_trainer_exp/exp_10k_3.png" alt="W&B Chart 7_16_2025, 10_56_02 AM"></p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/DPO_trainer_exp/exp_10k_4.png" alt="W&B Chart 7_16_2025, 10_55_55 AM"></p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/DPO_trainer_exp/exp_10k_5.png" alt="W&B Chart 7_16_2025, 10_55_46 AM"></p>
<p>效果在第1个epoch结束时变得很明显，之后reward acc就一直在0.95以上，可惜的是 chosen 的 reward 没有比一开始的值大，rejected 的 reward 明显降了，感觉 loss 对 rejected 的作用挺大的，但对 chosen 的提升不明显。我只用了部分数据, 10k/62k，在四卡4090上跑了20min。</p>
<p>虽然训练集上 acc 很高，但实际测试集不是很高。</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/DPO_trainer_exp/exp_10k_6.png" alt="W&B Chart 7_16_2025, 4_48_44 PM"></p>
<h3 id="62k数据"><a href="#62k数据" class="headerlink" title="62k数据"></a>62k数据</h3><p><img lazyload="" src="/images/loading.svg" data-src="/images/DPO_trainer_exp/exp_62k_1.png" alt="W&B Chart 16_07_2025, 22_09_29"></p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/DPO_trainer_exp/exp_62k_2.png" alt="W&B Chart 16_07_2025, 22_08_56"></p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/DPO_trainer_exp/exp_62k_3.png" alt="W&B Chart 16_07_2025, 22_09_09"></p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/DPO_trainer_exp/exp_62k_4.png" alt="W&B Chart 16_07_2025, 22_09_15"></p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/DPO_trainer_exp/exp_62k_5.png" alt="W&B Chart 16_07_2025, 22_09_22"></p>
<p>评估结果上看和10k数据没有多大差别</p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/DPO_trainer_exp/exp_62k_6.png" alt="W&B Chart 16_07_2025, 22_11_02"></p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/DPO_trainer_exp/exp_62k_7.png" alt="W&B Chart 16_07_2025, 22_10_24"></p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/DPO_trainer_exp/exp_62k_8.png" alt="W&B Chart 16_07_2025, 22_10_38"></p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/DPO_trainer_exp/exp_62k_9.png" alt="W&B Chart 16_07_2025, 22_10_46"></p>
<p><img lazyload="" src="/images/loading.svg" data-src="/images/DPO_trainer_exp/exp_62k_10.png" alt="W&B Chart 16_07_2025, 22_10_57"></p>
<p>可能0.5B能力有限吧，reward acc 都没有破 70%</p>

		</div>

		

		

		

		
		<div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
			
			<div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="prev" rel="prev" href="/2025/07/31/Reinforcement_learning/GRPO_length_reward/">
					<span class="left arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-left"></i>
					</span>
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item">GRPO-trainer-HF 长度奖励的文本压缩任务</span>
						<span class="post-nav-item">Prev posts</span>
					</span>
				</a>
			</div>
			
			
			<div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="next" rel="next" href="/2025/07/13/LLM-basic-series/memory_optimization/">
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item">cuda 显存占用优化</span>
						<span class="post-nav-item">Next posts</span>
					</span>
					<span class="right arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-right"></i>
					</span>
				</a>
			</div>
			
		</div>
		


		
		<div class="comment-container px-2 sm:px-6 md:px-8 pb-8">
			<div class="comments-container mt-10 w-full ">
    <div id="comment-anchor" class="w-full h-2.5"></div>
    <div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">
        Comments
    </div>
    

        
            
    <div id="waline"></div>
    <script type="module" data-swup-reload-script>
      import { init } from '/js/libs/waline.mjs';

      function loadWaline() {
        init({
          el: '#waline',
          serverURL: 'https://example.example.com',
          lang: 'zh-CN',
          dark: 'body[class~="dark-mode"]',
          reaction: false,
          requiredMeta: ['nick', 'mail'],
          emoji: [],
          
          
        });
      }

      if (typeof swup !== 'undefined') {
        loadWaline();
      } else {
        window.addEventListener('DOMContentLoaded', loadWaline);
      }
    </script>



        
    
</div>

		</div>
		
	</div>

	
	<div class="toc-content-container">
		<div class="post-toc-wrap">
	<div class="post-toc">
		<div class="toc-title">On this page</div>
		<div class="page-title">DPO trainer - by trl</div>
		<ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%81%8F%E5%A5%BD%E6%95%B0%E6%8D%AE%E9%9B%86-preference-dataset"><span class="nav-text">偏好数据集 preference dataset</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%92%8C%E8%84%9A%E6%9C%AC"><span class="nav-text">代码和脚本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%AD%E7%BB%83%E7%BB%93%E6%9E%9C"><span class="nav-text">训练结果</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10k%E6%95%B0%E6%8D%AE"><span class="nav-text">10k数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#62k%E6%95%B0%E6%8D%AE"><span class="nav-text">62k数据</span></a></li></ol></li></ol>

	</div>
</div>
	</div>
	
</div>
			</div>

			
		</div>

		<div class="main-content-footer">
			<footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
            2025&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">Peng Xia</a>
            
                
                <p class="post-count space-x-0.5">
                    <span>
                        46 posts in total
                    </span>
                    
                        <span>
                            150.4k words in total
                        </span>
                    
                </p>
            
        </div>
        
            <script data-swup-reload-script src="https://cn.vercount.one/js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">VISITOR COUNT</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">TOTAL PAGE VIEWS</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.8.2</a></span>
        </div>
        
        
        
        
        
    </div>  
</footer>
		</div>
	</div>

	
	<div class="post-tools">
		<div class="post-tools-container">
	<ul class="article-tools-list">
		<!-- TOC aside toggle -->
		
		<li class="right-bottom-tools page-aside-toggle">
			<i class="fa-regular fa-outdent"></i>
		</li>
		

		<!-- go comment -->
		
		<li class="go-comment">
			<i class="fa-regular fa-comments"></i>
		</li>
		
	</ul>
</div>
	</div>
	

	<div class="right-side-tools-container">
		<div class="side-tools-container">
	<ul class="hidden-tools-list">
		<li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-plus"></i>
		</li>

		<li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-minus"></i>
		</li>

		<li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
			<i class="fa-regular fa-moon"></i>
		</li>

		<!-- rss -->
		

		

		<li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
			<i class="fa-regular fa-arrow-down"></i>
		</li>
	</ul>

	<ul class="visible-tools-list">
		<li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
			<i class="fa-regular fa-cog fa-spin"></i>
		</li>
		
		<li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
			<i class="arrow-up fas fa-arrow-up"></i>
			<span class="percent"></span>
		</li>
		
		
	</ul>
</div>
	</div>

	<div class="image-viewer-container">
	<img src="">
</div>

	
	<div class="search-pop-overlay">
	<div class="popup search-popup">
		<div class="search-header">
			<span class="search-input-field-pre">
				<i class="fa-solid fa-keyboard"></i>
			</span>
			<div class="search-input-container">
				<input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input">
			</div>
			<span class="popup-btn-close">
				<i class="fa-solid fa-times"></i>
			</span>
		</div>
		<div id="search-result">
			<div id="no-result">
				<i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
			</div>
		</div>
	</div>
</div>
	

</main>



<script src="/js/build/libs/Swup.min.js"></script>

<script src="/js/build/libs/SwupSlideTheme.min.js"></script>

<script src="/js/build/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/build/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/build/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/build/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>




	
<script src="/js/build/tools/imageViewer.js" type="module"></script>

<script src="/js/build/utils.js" type="module"></script>

<script src="/js/build/main.js" type="module"></script>

<script src="/js/build/layouts/navbarShrink.js" type="module"></script>

<script src="/js/build/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/build/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/build/layouts/categoryList.js" type="module"></script>



    
<script src="/js/build/tools/localSearch.js" type="module"></script>




    
<script src="/js/build/tools/codeBlock.js" type="module"></script>




    
<script src="/js/build/layouts/lazyload.js" type="module"></script>






  
<script src="/js/build/libs/Typed.min.js"></script>

  
<script src="/js/build/plugins/typed.js" type="module"></script>








    
<script src="/js/build/libs/anime.min.js"></script>





    
<script src="/js/build/tools/tocToggle.js" type="module" data-swup-reload-script=""></script>

<script src="/js/build/layouts/toc.js" type="module" data-swup-reload-script=""></script>

<script src="/js/build/plugins/tabs.js" type="module" data-swup-reload-script=""></script>




<script src="/js/build/libs/moment-with-locales.min.js" data-swup-reload-script=""></script>


<script src="/js/build/layouts/essays.js" type="module" data-swup-reload-script=""></script>





	
</body>

</html>